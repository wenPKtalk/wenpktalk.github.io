
<!DOCTYPE html>
<html lang="en">
    
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="Summary">
    <title>Archives: 2024/3 - Summary</title>
    <meta name="author" content="Topsion">
    
    
    
    <script type="application/ld+json">{}</script>
    <meta name="description" content="The whole problem with the world is that fools and fanatics are always so certain of themselves, and wiser people so full of doubts.(è¿™ä¸ªä¸–ç•Œçš„é—®é¢˜åœ¨äºèªæ˜äººå……æ»¡ç–‘æƒ‘è€Œå‚»å­å´åšä¿¡ä¸ç–‘)">
<meta property="og:type" content="blog">
<meta property="og:title" content="Summary">
<meta property="og:url" content="http://example.com/archives/2024/03/index.html">
<meta property="og:site_name" content="Summary">
<meta property="og:description" content="The whole problem with the world is that fools and fanatics are always so certain of themselves, and wiser people so full of doubts.(è¿™ä¸ªä¸–ç•Œçš„é—®é¢˜åœ¨äºèªæ˜äººå……æ»¡ç–‘æƒ‘è€Œå‚»å­å´åšä¿¡ä¸ç–‘)">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="Topsion">
<meta name="twitter:card" content="summary">
    
    
        
    
    
        <meta property="og:image" content="http://example.com/assets/images/avatar.jpg"/>
    
    
    
    
    <!--STYLES-->
    
<link rel="stylesheet" href="/assets/css/style-yaeygdlgk8x4rqd5mp0jrkosoe3fmfokggmiu05rmpel4wjoxmvp5s6gestz.min.css">

    <!--STYLES END-->
    

    

    
</head>

    <body>
        <div id="blog">
            <!-- Define author's picture -->


    
        
            
        
    

<header id="header" data-behavior="1">
    <i id="btn-open-sidebar" class="fa fa-lg fa-bars"></i>
    <div class="header-title">
        <a
            class="header-title-link"
            href="/"
            aria-label=""
        >
            Summary
        </a>
    </div>
    
        
            <a
                class="header-right-picture "
                href="#about"
                aria-label="Open the link: /#about"
            >
        
        
            <img class="header-picture" src="/assets/images/avatar.jpg" alt="Author&#39;s picture"/>
        
        </a>
    
</header>

            <!-- Define author's picture -->



        
    

<nav id="sidebar" data-behavior="1">
    <div class="sidebar-container">
        
            <div class="sidebar-profile">
                <a
                    href="/#about"
                    aria-label="Read more about the author"
                >
                    <img class="sidebar-profile-picture" src="/assets/images/avatar.jpg" alt="Author&#39;s picture"/>
                </a>
                <h4 class="sidebar-profile-name">Topsion</h4>
                
                    <h5 class="sidebar-profile-bio"><p>Fullstack Developer</p>
</h5>
                
            </div>
        
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/"
                            
                            rel="noopener"
                            title="Home"
                        >
                        <i class="sidebar-button-icon fa fa-home" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Home</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/all-categories"
                            
                            rel="noopener"
                            title="Categories"
                        >
                        <i class="sidebar-button-icon fa fa-bookmark" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Categories</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/all-tags"
                            
                            rel="noopener"
                            title="Tags"
                        >
                        <i class="sidebar-button-icon fa fa-tags" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Tags</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/all-archives"
                            
                            rel="noopener"
                            title="Archives"
                        >
                        <i class="sidebar-button-icon fa fa-archive" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Archives</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link open-algolia-search"
                            href="#search"
                            
                            rel="noopener"
                            title="Search"
                        >
                        <i class="sidebar-button-icon fa fa-search" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Search</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="#about"
                            
                            rel="noopener"
                            title="About"
                        >
                        <i class="sidebar-button-icon fa fa-question" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">About</span>
                    </a>
            </li>
            
        </ul>
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="https://github.com/wenPKtalk"
                            
                                target="_blank"
                            
                            rel="noopener"
                            title="GitHub"
                        >
                        <i class="sidebar-button-icon fab fa-github" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">GitHub</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="https://stackoverflow.com/users/15967860/topsion"
                            
                                target="_blank"
                            
                            rel="noopener"
                            title="Stack Overflow"
                        >
                        <i class="sidebar-button-icon fab fa-stack-overflow" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Stack Overflow</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="https://www.linkedin.com/feed/"
                            
                                target="_blank"
                            
                            rel="noopener"
                            title="LinkedIn"
                        >
                        <i class="sidebar-button-icon fab fa-linkedin" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">LinkedIn</span>
                    </a>
            </li>
            
        </ul>
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/atom.xml"
                            
                            rel="noopener"
                            title="RSS"
                        >
                        <i class="sidebar-button-icon fa fa-rss" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">RSS</span>
                    </a>
            </li>
            
        </ul>
        
    </div>
</nav>

            
            <div id="main" data-behavior="1"
                 class="
                        hasCoverMetaIn
                        ">
                
    <section class="postShorten-group main-content-wrap">
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title">
                    
                        <a
                            class="link-unstyled"
                            href="/2024/03/04/Postgres%E6%8A%80%E5%B7%A7/"
                            aria-label=": PostgresæŠ€å·§"
                        >
                            PostgresæŠ€å·§
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time datetime="2024-03-04T15:09:27+00:00">
	
		    Mar 04, 2024
    	
    </time>
    
</div>

            </div>
            
                <div class="postShorten-content">
                    <h2 id="Lock"><a href="#Lock" class="headerlink" title="Lock"></a>Lock</h2><h3 id="æŸ¥æ‰¾ç©ºé—²ä¸”å¯èƒ½è¢«é”å®šçš„è¿›ç¨‹ã€‚"><a href="#æŸ¥æ‰¾ç©ºé—²ä¸”å¯èƒ½è¢«é”å®šçš„è¿›ç¨‹ã€‚" class="headerlink" title="æŸ¥æ‰¾ç©ºé—²ä¸”å¯èƒ½è¢«é”å®šçš„è¿›ç¨‹ã€‚"></a>æŸ¥æ‰¾ç©ºé—²ä¸”å¯èƒ½è¢«é”å®šçš„è¿›ç¨‹ã€‚</h3><blockquote>
<p>è¿™ä¸ªæŸ¥è¯¢æŸ¥çœ‹pg_stat_activityè§†å›¾ï¼ŒæŸ¥æ‰¾é‚£äº›æ´»è·ƒä½†æ˜¯ç­‰å¾…äº‹ä»¶æˆ–ç­‰å¾…äº‹ä»¶ç±»å‹ä¸ä¸ºç©ºçš„è¿›ç¨‹ã€‚</p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">		pid,</span><br><span class="line">		datname,</span><br><span class="line">		usename,</span><br><span class="line">		application_name,</span><br><span class="line">		client_addr,</span><br><span class="line">		client_port,</span><br><span class="line">		to_char (now (), <span class="string">&#x27;YYYY-MM-DD HH24:MI:SS&#x27;</span>) <span class="keyword">as</span> now,</span><br><span class="line">		to_char (now () <span class="operator">-</span> xact_start, <span class="string">&#x27;DD HH24:MI:SS MS&#x27;</span>) <span class="keyword">as</span> xact_time,</span><br><span class="line">		to_char (now () <span class="operator">-</span> query_start, <span class="string">&#x27;DD HH24:MI:SS MS&#x27;</span>) <span class="keyword">as</span> query_time,</span><br><span class="line">		state,</span><br><span class="line">		to_char (now () <span class="operator">-</span> state_change, <span class="string">&#x27;DD HH24:MI:SS MS&#x27;</span>) <span class="keyword">as</span> state_time,</span><br><span class="line">		wait_event,</span><br><span class="line">		wait_event_type,</span><br><span class="line">		<span class="keyword">left</span> (query, <span class="number">40</span>)</span><br><span class="line">	  <span class="keyword">FROM</span></span><br><span class="line">		pg_stat_activity</span><br><span class="line">	  <span class="keyword">WHERE</span></span><br><span class="line">		state <span class="operator">!=</span> <span class="string">&#x27;idle&#x27;</span></span><br><span class="line">		<span class="keyword">and</span> pid <span class="operator">!=</span> pg_backend_pid ()</span><br><span class="line">	  <span class="keyword">ORDER</span> <span class="keyword">BY</span></span><br><span class="line">		query_time <span class="keyword">desc</span>;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="æ‰¾åˆ°å…·æœ‰ç­‰å¾…äº‹ä»¶çš„è¿›ç¨‹ï¼Œå‘æŒæœ‰åˆå§‹é”çš„PIDæ±‡æ€»"><a href="#æ‰¾åˆ°å…·æœ‰ç­‰å¾…äº‹ä»¶çš„è¿›ç¨‹ï¼Œå‘æŒæœ‰åˆå§‹é”çš„PIDæ±‡æ€»" class="headerlink" title="æ‰¾åˆ°å…·æœ‰ç­‰å¾…äº‹ä»¶çš„è¿›ç¨‹ï¼Œå‘æŒæœ‰åˆå§‹é”çš„PIDæ±‡æ€»"></a>æ‰¾åˆ°å…·æœ‰ç­‰å¾…äº‹ä»¶çš„è¿›ç¨‹ï¼Œå‘æŒæœ‰åˆå§‹é”çš„PIDæ±‡æ€»</h3><blockquote>
<p>This query looks at at the pg_stat_activity and pg_locks view showing the pid, state, wait_event, and lock mode, as well as blocking pids.<br>è¿™ä¸ªæŸ¥è¯¢æŸ¥çœ‹äº† pg_stat_activity å’Œ pg_locks è§†å›¾ï¼Œæ˜¾ç¤ºäº† pidã€stateã€wait_event å’Œ lock modeï¼Œä»¥åŠé˜»å¡çš„ pidã€‚</p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">WITH</span> sos <span class="keyword">AS</span> (</span><br><span class="line">			<span class="keyword">SELECT</span> array_cat(<span class="built_in">array_agg</span>(pid),</span><br><span class="line">				   <span class="built_in">array_agg</span>((pg_blocking_pids(pid))[array_length(pg_blocking_pids(pid),<span class="number">1</span>)])) pids</span><br><span class="line">			<span class="keyword">FROM</span> pg_locks</span><br><span class="line">			<span class="keyword">WHERE</span> <span class="keyword">NOT</span> granted</span><br><span class="line">		)</span><br><span class="line">		<span class="keyword">SELECT</span> a.pid, a.usename, a.datname, a.state,</span><br><span class="line">			   a.wait_event_type <span class="operator">||</span> <span class="string">&#x27;: &#x27;</span> <span class="operator">||</span> a.wait_event <span class="keyword">AS</span> wait_event,</span><br><span class="line">			   <span class="built_in">current_timestamp</span><span class="operator">-</span>a.state_change time_in_state,</span><br><span class="line">			   <span class="built_in">current_timestamp</span><span class="operator">-</span>a.xact_start time_in_xact,</span><br><span class="line">			   l.relation::regclass relname,</span><br><span class="line">			   l.locktype, l.mode, l.page, l.tuple,</span><br><span class="line">			   pg_blocking_pids(l.pid) blocking_pids,</span><br><span class="line">			   (pg_blocking_pids(l.pid))[array_length(pg_blocking_pids(l.pid),<span class="number">1</span>)] last_session,</span><br><span class="line">			   <span class="built_in">coalesce</span>((pg_blocking_pids(l.pid))[<span class="number">1</span>]<span class="operator">||</span><span class="string">&#x27;.&#x27;</span><span class="operator">||</span><span class="built_in">coalesce</span>(<span class="keyword">case</span> <span class="keyword">when</span> locktype<span class="operator">=</span><span class="string">&#x27;transactionid&#x27;</span> <span class="keyword">then</span> <span class="number">1</span> <span class="keyword">else</span> array_length(pg_blocking_pids(l.pid),<span class="number">1</span>)<span class="operator">+</span><span class="number">1</span> <span class="keyword">end</span>,<span class="number">0</span>),a.pid<span class="operator">||</span><span class="string">&#x27;.0&#x27;</span>) lock_depth,</span><br><span class="line">			   a.query</span><br><span class="line">		<span class="keyword">FROM</span> pg_stat_activity a</span><br><span class="line">			 <span class="keyword">JOIN</span> sos s <span class="keyword">on</span> (a.pid <span class="operator">=</span> <span class="keyword">any</span>(s.pids))</span><br><span class="line">			 <span class="keyword">LEFT</span> <span class="keyword">OUTER</span> <span class="keyword">JOIN</span> pg_locks l <span class="keyword">on</span> (a.pid <span class="operator">=</span> l.pid <span class="keyword">and</span> <span class="keyword">not</span> l.granted)</span><br><span class="line">		<span class="keyword">ORDER</span> <span class="keyword">BY</span> lock_depth;</span><br></pre></td></tr></table></figure>

<h3 id="Set-a-lock-timeout"><a href="#Set-a-lock-timeout" class="headerlink" title="Set a lock timeout"></a>Set a lock timeout</h3><blockquote>
<p>It can be a good idea to set a lock_timeout within a session so that it will cancel the transaction and relinquish any locks it was holding after a certain period of time.<br>åœ¨ä¼šè¯ä¸­è®¾ç½®ä¸€ä¸ªé”å®šè¶…æ—¶å¯èƒ½æ˜¯ä¸ªå¥½ä¸»æ„ï¼Œè¿™æ ·åœ¨ä¸€æ®µæ—¶é—´åå®ƒä¼šå–æ¶ˆäº‹åŠ¡å¹¶é‡Šæ”¾ä»»ä½•å®ƒæŒæœ‰çš„é”ã€‚</p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">SYSTEM</span> <span class="keyword">SET</span> lock_timeout <span class="operator">=</span> <span class="string">&#x27;10s&#x27;</span>;</span><br></pre></td></tr></table></figure>

<h2 id="Logging"><a href="#Logging" class="headerlink" title="Logging"></a>Logging</h2><h3 id="è®¾ç½®log-min-duration-statementæ¥è®°å½•æ…¢æŸ¥è¯¢ã€‚"><a href="#è®¾ç½®log-min-duration-statementæ¥è®°å½•æ…¢æŸ¥è¯¢ã€‚" class="headerlink" title="è®¾ç½®log_min_duration_statementæ¥è®°å½•æ…¢æŸ¥è¯¢ã€‚"></a>è®¾ç½®log_min_duration_statementæ¥è®°å½•æ…¢æŸ¥è¯¢ã€‚</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> database postgres <span class="keyword">SET</span> log_min_duration_statement <span class="operator">=</span> <span class="string">&#x27;250ms&#x27;</span>;</span><br></pre></td></tr></table></figure>

<h3 id="æ§åˆ¶è®°å½•å“ªäº›ç±»å‹çš„è¯­å¥"><a href="#æ§åˆ¶è®°å½•å“ªäº›ç±»å‹çš„è¯­å¥" class="headerlink" title="æ§åˆ¶è®°å½•å“ªäº›ç±»å‹çš„è¯­å¥"></a>æ§åˆ¶è®°å½•å“ªäº›ç±»å‹çš„è¯­å¥</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> DATABASE postgres <span class="keyword">SET</span> log_statement <span class="operator">=</span> <span class="string">&#x27;all&#x27;</span>;</span><br></pre></td></tr></table></figure>

<h3 id="ç­‰å¾…é”æ—¶è®°å½•"><a href="#ç­‰å¾…é”æ—¶è®°å½•" class="headerlink" title="ç­‰å¾…é”æ—¶è®°å½•"></a>ç­‰å¾…é”æ—¶è®°å½•</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> DATABASE postgres <span class="keyword">SET</span> log_lock_waits <span class="operator">=</span> <span class="string">&#x27;on&#x27;</span>;</span><br></pre></td></tr></table></figure>

<h2 id="PERFORMANCE"><a href="#PERFORMANCE" class="headerlink" title="PERFORMANCE"></a>PERFORMANCE</h2><h3 id="ä½¿ç”¨è¯­å¥è¶…æ—¶æ¥æ§åˆ¶è¿è¡Œè¶…æ—¶çš„æŸ¥è¯¢ã€‚"><a href="#ä½¿ç”¨è¯­å¥è¶…æ—¶æ¥æ§åˆ¶è¿è¡Œè¶…æ—¶çš„æŸ¥è¯¢ã€‚" class="headerlink" title="ä½¿ç”¨è¯­å¥è¶…æ—¶æ¥æ§åˆ¶è¿è¡Œè¶…æ—¶çš„æŸ¥è¯¢ã€‚"></a>ä½¿ç”¨è¯­å¥è¶…æ—¶æ¥æ§åˆ¶è¿è¡Œè¶…æ—¶çš„æŸ¥è¯¢ã€‚</h3><blockquote>
<p>Setting a statement timeout prevents queries from running longer than the specified time. You can set a statement timeout on the database, user, or session level. We recommend you set a global timeout on Postgres and then override that one specific users or sessions that need a longer allowed time to run.<br>è®¾ç½®è¯­å¥è¶…æ—¶æ—¶é—´å¯ä»¥é˜²æ­¢æŸ¥è¯¢è¿è¡Œæ—¶é—´è¶…è¿‡æŒ‡å®šçš„æ—¶é—´ã€‚æ‚¨å¯ä»¥åœ¨æ•°æ®åº“ã€ç”¨æˆ·æˆ–ä¼šè¯çº§åˆ«ä¸Šè®¾ç½®è¯­å¥è¶…æ—¶æ—¶é—´ã€‚æˆ‘ä»¬å»ºè®®æ‚¨åœ¨Postgresä¸Šè®¾ç½®ä¸€ä¸ªå…¨å±€è¶…æ—¶æ—¶é—´ï¼Œç„¶åé’ˆå¯¹éœ€è¦æ›´é•¿è¿è¡Œæ—¶é—´çš„ç‰¹å®šç”¨æˆ·æˆ–ä¼šè¯è¿›è¡Œè¦†ç›–è®¾ç½®ã€‚</p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> DATABASE mydatabase <span class="keyword">SET</span> statement_timeout <span class="operator">=</span> <span class="string">&#x27;60s&#x27;</span>;</span><br></pre></td></tr></table></figure>

<h3 id="ä½¿ç”¨pg-stat-statements-éœ€è¦å®‰è£…-æ¥æŸ¥æ‰¾ä½¿ç”¨æœ€å¤šèµ„æºçš„æŸ¥è¯¢å’Œè¿›ç¨‹ã€‚"><a href="#ä½¿ç”¨pg-stat-statements-éœ€è¦å®‰è£…-æ¥æŸ¥æ‰¾ä½¿ç”¨æœ€å¤šèµ„æºçš„æŸ¥è¯¢å’Œè¿›ç¨‹ã€‚" class="headerlink" title="ä½¿ç”¨pg_stat_statements[éœ€è¦å®‰è£…]æ¥æŸ¥æ‰¾ä½¿ç”¨æœ€å¤šèµ„æºçš„æŸ¥è¯¢å’Œè¿›ç¨‹ã€‚"></a>ä½¿ç”¨pg_stat_statements[éœ€è¦å®‰è£…]æ¥æŸ¥æ‰¾ä½¿ç”¨æœ€å¤šèµ„æºçš„æŸ¥è¯¢å’Œè¿›ç¨‹ã€‚</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- å®‰è£…pg_stat_statements</span></span><br><span class="line"><span class="comment">-- Create the extension</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> EXTENSION pg_stat_statements;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- Change in config</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">system</span> <span class="keyword">set</span> shared_preload_libraries<span class="operator">=</span><span class="string">&#x27;pg_stat_statements&#x27;</span>;</span><br><span class="line">Restart</span><br><span class="line"></span><br><span class="line"><span class="comment">-- systemctl restart postgresql</span></span><br><span class="line"><span class="comment">-- Verify changes applied or not.</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> pg_file_Settings <span class="keyword">where</span> name<span class="operator">=</span><span class="string">&#x27;shared_preload_libraries&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">	total_exec_time,</span><br><span class="line">	mean_exec_time <span class="keyword">as</span> avg_ms,</span><br><span class="line">	calls,</span><br><span class="line">	query</span><br><span class="line"><span class="keyword">FROM</span> pg_stat_statements</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> mean_exec_time <span class="keyword">DESC</span></span><br><span class="line">LIMIT <span class="number">10</span>;</span><br></pre></td></tr></table></figure>

<h3 id="ç›‘è§†Postgresä¸­çš„è¿æ¥"><a href="#ç›‘è§†Postgresä¸­çš„è¿æ¥" class="headerlink" title="ç›‘è§†Postgresä¸­çš„è¿æ¥"></a>ç›‘è§†Postgresä¸­çš„è¿æ¥</h3><blockquote>
<p>This query will provide the number of connection based on type.<br>æ­¤æŸ¥è¯¢å°†æ ¹æ®ç±»å‹æä¾›è¿æ¥æ•°é‡ã€‚</p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="built_in">count</span>(<span class="operator">*</span>),</span><br><span class="line">	   state</span><br><span class="line"><span class="keyword">FROM</span> pg_stat_activity</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> state;</span><br></pre></td></tr></table></figure>

<h3 id="æŸ¥è¯¢ç‰¹å®šè¡¨çš„å¤§å°"><a href="#æŸ¥è¯¢ç‰¹å®šè¡¨çš„å¤§å°" class="headerlink" title="æŸ¥è¯¢ç‰¹å®šè¡¨çš„å¤§å°"></a>æŸ¥è¯¢ç‰¹å®šè¡¨çš„å¤§å°</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> pg_relation_size(<span class="string">&#x27;table_name&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- For prettier formatting you can wrap with:</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> pg_size_pretty(pg_relation_size(<span class="string">&#x27;table_name&#x27;</span>));</span><br></pre></td></tr></table></figure>

<h3 id="æŸ¥è¯¢æ‰€æœ‰è¡¨çš„å¤§å°"><a href="#æŸ¥è¯¢æ‰€æœ‰è¡¨çš„å¤§å°" class="headerlink" title="æŸ¥è¯¢æ‰€æœ‰è¡¨çš„å¤§å°"></a>æŸ¥è¯¢æ‰€æœ‰è¡¨çš„å¤§å°</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> relname <span class="keyword">AS</span> relation,</span><br><span class="line">       pg_size_pretty (</span><br><span class="line">         pg_total_relation_size (C .oid)</span><br><span class="line">       ) <span class="keyword">AS</span> total_size</span><br><span class="line"><span class="keyword">FROM</span> pg_class C</span><br><span class="line"><span class="keyword">LEFT</span> <span class="keyword">JOIN</span> pg_namespace N <span class="keyword">ON</span> (N.oid <span class="operator">=</span> C .relnamespace)</span><br><span class="line"><span class="keyword">WHERE</span> nspname <span class="keyword">NOT</span> <span class="keyword">IN</span> (</span><br><span class="line">        <span class="string">&#x27;pg_catalog&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;information_schema&#x27;</span></span><br><span class="line">      )</span><br><span class="line">  <span class="keyword">AND</span> C .relkind <span class="operator">&lt;&gt;</span> <span class="string">&#x27;i&#x27;</span></span><br><span class="line">  <span class="keyword">AND</span> nspname <span class="operator">!</span><span class="operator">~</span> <span class="string">&#x27;^pg_toast&#x27;</span></span><br><span class="line">  <span class="keyword">ORDER</span> <span class="keyword">BY</span> pg_total_relation_size (C .oid) <span class="keyword">DESC</span></span><br></pre></td></tr></table></figure>

<h3 id="æ£€æŸ¥æœªä½¿ç”¨çš„ç´¢å¼•ã€‚"><a href="#æ£€æŸ¥æœªä½¿ç”¨çš„ç´¢å¼•ã€‚" class="headerlink" title="æ£€æŸ¥æœªä½¿ç”¨çš„ç´¢å¼•ã€‚"></a>æ£€æŸ¥æœªä½¿ç”¨çš„ç´¢å¼•ã€‚</h3><blockquote>
<p>Will return the unused indexes in descending order of size. Keep in mind you want to also check replicas before dropping indexes.</p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> schemaname <span class="operator">||</span> <span class="string">&#x27;.&#x27;</span> <span class="operator">||</span> relname <span class="keyword">AS</span> <span class="keyword">table</span>,</span><br><span class="line">       indexrelname <span class="keyword">AS</span> index,</span><br><span class="line">       pg_size_pretty(pg_relation_size(i.indexrelid)) <span class="keyword">AS</span> &quot;index size&quot;,</span><br><span class="line">       idx_scan <span class="keyword">as</span> &quot;index scans&quot;</span><br><span class="line"><span class="keyword">FROM</span> pg_stat_user_indexes ui</span><br><span class="line"><span class="keyword">JOIN</span> pg_index i <span class="keyword">ON</span> ui.indexrelid <span class="operator">=</span> i.indexrelid</span><br><span class="line"><span class="keyword">WHERE</span> <span class="keyword">NOT</span> indisunique</span><br><span class="line">  <span class="keyword">AND</span> idx_scan <span class="operator">&lt;</span> <span class="number">50</span></span><br><span class="line">  <span class="keyword">AND</span> pg_relation_size(relid) <span class="operator">&gt;</span> <span class="number">5</span> <span class="operator">*</span> <span class="number">8192</span></span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> </span><br><span class="line">  pg_relation_size(i.indexrelid) <span class="operator">/</span> <span class="built_in">nullif</span>(idx_scan, <span class="number">0</span>) <span class="keyword">DESC</span> <span class="keyword">NULLS FIRST</span>,</span><br><span class="line">  pg_relation_size(i.indexrelid) <span class="keyword">DESC</span>;</span><br></pre></td></tr></table></figure>

<h3 id="è·å–è¡¨æ ¼çš„è¿‘ä¼¼è®¡æ•°"><a href="#è·å–è¡¨æ ¼çš„è¿‘ä¼¼è®¡æ•°" class="headerlink" title="è·å–è¡¨æ ¼çš„è¿‘ä¼¼è®¡æ•°"></a>è·å–è¡¨æ ¼çš„è¿‘ä¼¼è®¡æ•°</h3><blockquote>
<p>Will return the approximate count for a table based on PostgreSQL internal statistics. Useful for large tables where performing a <code>SELECT count(*)</code> is costly on performance.</p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> reltuples::<span class="type">numeric</span> <span class="keyword">as</span> count</span><br><span class="line"><span class="keyword">FROM</span> pg_class</span><br><span class="line"><span class="keyword">WHERE</span> relname<span class="operator">=</span><span class="string">&#x27;table_name&#x27;</span>;</span><br></pre></td></tr></table></figure>

<h3 id="Non-blocking-åˆ›å»ºç´¢å¼•"><a href="#Non-blocking-åˆ›å»ºç´¢å¼•" class="headerlink" title="Non-blocking åˆ›å»ºç´¢å¼•"></a>Non-blocking åˆ›å»ºç´¢å¼•</h3><blockquote>
<p>Adding <code>CONCURRENTLY</code> during index creation, while not permitted in a transaction, will not hold a lock on the table while creating your index.</p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> INDEX CONCURRENTLY foobar <span class="keyword">ON</span> foo (bar);</span><br></pre></td></tr></table></figure>

<h2 id="PSQL"><a href="#PSQL" class="headerlink" title="PSQL"></a>PSQL</h2><h3 id="åœ¨PSQLä¸­è‡ªåŠ¨è®°å½•æŸ¥è¯¢æ—¶é—´"><a href="#åœ¨PSQLä¸­è‡ªåŠ¨è®°å½•æŸ¥è¯¢æ—¶é—´" class="headerlink" title="åœ¨PSQLä¸­è‡ªåŠ¨è®°å½•æŸ¥è¯¢æ—¶é—´"></a>åœ¨PSQLä¸­è‡ªåŠ¨è®°å½•æŸ¥è¯¢æ—¶é—´</h3><blockquote>
<p>å°†è‡ªåŠ¨æ‰“å°å‡ºåœ¨psqlä¸­è¿è¡ŒæŸ¥è¯¢æ‰€èŠ±è´¹çš„æ—¶é—´ã€‚<em>éœ€è¦æ³¨æ„çš„æ˜¯è¿™æ˜¯å¾€è¿”æ—¶é—´ï¼Œè€Œä¸ä»…ä»…æ˜¯æŸ¥è¯¢æ‰§è¡Œæ—¶é—´ã€‚</em></p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">\timing</span><br></pre></td></tr></table></figure>

<h3 id="åœ¨-psql-ä¸­è‡ªåŠ¨æ ¼å¼åŒ–æŸ¥è¯¢ç»“æœ"><a href="#åœ¨-psql-ä¸­è‡ªåŠ¨æ ¼å¼åŒ–æŸ¥è¯¢ç»“æœ" class="headerlink" title="åœ¨ psql ä¸­è‡ªåŠ¨æ ¼å¼åŒ–æŸ¥è¯¢ç»“æœ"></a>åœ¨ psql ä¸­è‡ªåŠ¨æ ¼å¼åŒ–æŸ¥è¯¢ç»“æœ</h3><blockquote>
<p>å°†æ ¹æ®æ‚¨çš„ç»ˆç«¯çª—å£è‡ªåŠ¨é‡æ–°ç»„ç»‡æŸ¥è¯¢è¾“å‡ºï¼Œä»¥ä¾¿æ›´æ˜“è¯»ã€‚</p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">\x auto</span><br></pre></td></tr></table></figure>

<h3 id="ç¼–è¾‘æ‚¨é€‰æ‹©çš„ç¼–è¾‘å™¨ä¸­çš„psqlæŸ¥è¯¢"><a href="#ç¼–è¾‘æ‚¨é€‰æ‹©çš„ç¼–è¾‘å™¨ä¸­çš„psqlæŸ¥è¯¢" class="headerlink" title="ç¼–è¾‘æ‚¨é€‰æ‹©çš„ç¼–è¾‘å™¨ä¸­çš„psqlæŸ¥è¯¢"></a>ç¼–è¾‘æ‚¨é€‰æ‹©çš„ç¼–è¾‘å™¨ä¸­çš„psqlæŸ¥è¯¢</h3><blockquote>
<p>å°†è‡ªåŠ¨åœ¨æ‚¨çš„é»˜è®¤ <code>$EDITOR</code> ä¸­æ‰“å¼€æ‚¨ä¸Šæ¬¡è¿è¡Œçš„æŸ¥è¯¢ã€‚å½“æ‚¨ä¿å­˜å¹¶å…³é—­æ—¶ï¼Œå°†æ‰§è¡Œè¯¥æŸ¥è¯¢ã€‚</p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">\e</span><br></pre></td></tr></table></figure>

<h3 id="ä¸ºnullsè®¾ç½®ä¸€ä¸ªå€¼"><a href="#ä¸ºnullsè®¾ç½®ä¸€ä¸ªå€¼" class="headerlink" title="ä¸ºnullsè®¾ç½®ä¸€ä¸ªå€¼"></a>ä¸ºnullsè®¾ç½®ä¸€ä¸ªå€¼</h3><blockquote>
<p>å°†nullæ¸²æŸ“ä¸ºæ‚¨æŒ‡å®šçš„ä»»ä½•å­—ç¬¦ã€‚å¯¹äºæ›´å®¹æ˜“è§£ænullå’Œç©ºæ–‡æœ¬éå¸¸æ–¹ä¾¿ã€‚</p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">\pset <span class="keyword">null</span> ğŸ‘»</span><br></pre></td></tr></table></figure>

<h3 id="å°†æ‚¨çš„æ¯ä¸ªæ•°æ®åº“çš„æŸ¥è¯¢å†å²ä¿å­˜åœ¨æœ¬åœ°"><a href="#å°†æ‚¨çš„æ¯ä¸ªæ•°æ®åº“çš„æŸ¥è¯¢å†å²ä¿å­˜åœ¨æœ¬åœ°" class="headerlink" title="å°†æ‚¨çš„æ¯ä¸ªæ•°æ®åº“çš„æŸ¥è¯¢å†å²ä¿å­˜åœ¨æœ¬åœ°"></a>å°†æ‚¨çš„æ¯ä¸ªæ•°æ®åº“çš„æŸ¥è¯¢å†å²ä¿å­˜åœ¨æœ¬åœ°</h3><blockquote>
<p>å°†ä¸ºæ¯ä¸ª<strong>DBNAME</strong>è‡ªåŠ¨ä¿å­˜ä¸€ä¸ªå†å²æ–‡ä»¶ã€‚</p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">\<span class="keyword">set</span> HISTFILE <span class="operator">~</span><span class="operator">/</span>.psql_history<span class="operator">-</span> :DBNAME</span><br></pre></td></tr></table></figure>

<h3 id="æ˜¾ç¤ºç”±å†…éƒ¨psqlå‘½ä»¤å‘å‡ºçš„æŸ¥è¯¢"><a href="#æ˜¾ç¤ºç”±å†…éƒ¨psqlå‘½ä»¤å‘å‡ºçš„æŸ¥è¯¢" class="headerlink" title="æ˜¾ç¤ºç”±å†…éƒ¨psqlå‘½ä»¤å‘å‡ºçš„æŸ¥è¯¢"></a>æ˜¾ç¤ºç”±å†…éƒ¨psqlå‘½ä»¤å‘å‡ºçš„æŸ¥è¯¢</h3><blockquote>
<p>åœ¨å‘½ä»¤è¡Œä¸­ä¸º psql æ·»åŠ â€œ-Eâ€ï¼ˆæˆ–â€“echo-hiddenï¼‰é€‰é¡¹ã€‚æ­¤é€‰é¡¹å°†æ˜¾ç¤ºå†…éƒ¨ psql å‘½ä»¤ç”Ÿæˆçš„æŸ¥è¯¢ï¼ˆä¾‹å¦‚â€œ\dt mytableâ€ï¼‰ã€‚è¿™æ˜¯äº†è§£ç³»ç»Ÿç›®å½•çš„æ›´é…·çš„æ–¹æ³•ï¼Œæˆ–è€…å¯ä»¥é‡ç”¨ç”± psql å‘å‡ºçš„æŸ¥è¯¢åœ¨æ‚¨è‡ªå·±çš„å·¥å…·ä¸­ã€‚</p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">psql <span class="operator">-</span>E</span><br></pre></td></tr></table></figure>

<h3 id="è·å–æ•°æ®ï¼Œåªéœ€æ•°æ®ã€‚"><a href="#è·å–æ•°æ®ï¼Œåªéœ€æ•°æ®ã€‚" class="headerlink" title="è·å–æ•°æ®ï¼Œåªéœ€æ•°æ®ã€‚"></a>è·å–æ•°æ®ï¼Œåªéœ€æ•°æ®ã€‚</h3><blockquote>
<p>åœ¨å‘½ä»¤è¡Œä¸­å‘psqlæ·»åŠ â€-qtAâ€é€‰é¡¹ã€‚è¿™äº›é€‰é¡¹å°†ä½¿psqlä»¥å®‰é™æ¨¡å¼(â€œ-qâ€)è¿è¡Œï¼Œä»…è¿”å›å…ƒç»„(â€œ-tâ€)ä»¥ä¸å¯¹é½çš„æ–¹å¼(â€œ-Aâ€)ã€‚ç»“åˆâ€-câ€é€‰é¡¹å‘é€å•ä¸ªæŸ¥è¯¢ï¼Œå¦‚æœæ‚¨åªæƒ³ä»Postgresè·å–æ•°æ®ï¼Œè¿™å¯¹äºæ‚¨çš„è„šæœ¬å¯èƒ½å¾ˆæœ‰ç”¨ã€‚æ¯è¡Œè¿”å›ä¸€è¡Œã€‚</p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">psql <span class="operator">-</span>qtA</span><br></pre></td></tr></table></figure>

<h3 id="ä»¥HTMLè¡¨æ ¼çš„å½¢å¼è·å–ç»“æœ"><a href="#ä»¥HTMLè¡¨æ ¼çš„å½¢å¼è·å–ç»“æœ" class="headerlink" title="ä»¥HTMLè¡¨æ ¼çš„å½¢å¼è·å–ç»“æœ"></a>ä»¥HTMLè¡¨æ ¼çš„å½¢å¼è·å–ç»“æœ</h3><blockquote>
<p>åœ¨å‘½ä»¤è¡Œä¸­ä¸ºpsqlæ·»åŠ â€-qtHâ€é€‰é¡¹ã€‚è¿™äº›é€‰é¡¹å°†ä½¿psqlä»¥å®‰é™æ¨¡å¼è¿è¡Œï¼ˆâ€-qâ€ï¼‰ï¼Œä»…è¿”å›å…ƒç»„ï¼ˆâ€-tâ€ï¼‰ä»¥HTMLè¡¨æ ¼å½¢å¼ï¼ˆâ€-Hâ€ï¼‰ã€‚ç»“åˆâ€-câ€é€‰é¡¹å‘é€å•ä¸ªæŸ¥è¯¢ï¼Œå¯ä»¥å¿«é€Ÿå°†æŸ¥è¯¢ç»“æœåµŒå…¥åˆ°HTMLé¡µé¢ä¸­ã€‚</p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">psql <span class="operator">-</span>qtH</span><br></pre></td></tr></table></figure>

<h3 id="æœç´¢ä»¥å‰çš„æŸ¥è¯¢ä½¿ç”¨-Ctrl-R"><a href="#æœç´¢ä»¥å‰çš„æŸ¥è¯¢ä½¿ç”¨-Ctrl-R" class="headerlink" title="æœç´¢ä»¥å‰çš„æŸ¥è¯¢ä½¿ç”¨ Ctrl + R"></a>æœç´¢ä»¥å‰çš„æŸ¥è¯¢ä½¿ç”¨ Ctrl + R</h3><blockquote>
<p>æŒ‰ä¸‹Ctrl + Rå°†å¯åŠ¨æœç´¢ä¼šè¯ï¼Œç„¶åæ‚¨å¯ä»¥å¼€å§‹é”®å…¥æŸ¥è¯¢æˆ–å‘½ä»¤çš„ä¸€éƒ¨åˆ†ï¼Œä»¥æ‰¾åˆ°å¹¶å†æ¬¡è¿è¡Œå®ƒã€‚å¦‚æœæ‚¨ä½¿ç”¨æ³¨é‡Šæ ‡è®°ç‰¹å®šæŸ¥è¯¢ï¼Œè¿™å¯ä»¥å¸®åŠ©ç¨åè¿›è¡Œæœç´¢ã€‚</p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(reverse<span class="operator">-</span>i<span class="operator">-</span><span class="keyword">search</span>)</span><br></pre></td></tr></table></figure>

<h3 id="æ¸…é™¤plsqlå±å¹•"><a href="#æ¸…é™¤plsqlå±å¹•" class="headerlink" title="æ¸…é™¤plsqlå±å¹•"></a>æ¸…é™¤plsqlå±å¹•</h3><blockquote>
<p>å°†æ¸…é™¤å½“å‰ psql ä¼šè¯ä¸­çš„å±å¹•</p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">\<span class="operator">!</span> clear</span><br></pre></td></tr></table></figure>

<h3 id="æŒç»­ä½¿ç”¨watchå‘½ä»¤è¿è¡ŒæŸ¥è¯¢"><a href="#æŒç»­ä½¿ç”¨watchå‘½ä»¤è¿è¡ŒæŸ¥è¯¢" class="headerlink" title="æŒç»­ä½¿ç”¨watchå‘½ä»¤è¿è¡ŒæŸ¥è¯¢"></a>æŒç»­ä½¿ç”¨watchå‘½ä»¤è¿è¡ŒæŸ¥è¯¢</h3><blockquote>
<p>æ¯2ç§’å°†è‡ªåŠ¨è¿è¡Œä¸Šæ¬¡çš„æŸ¥è¯¢å¹¶æ˜¾ç¤ºè¾“å‡ºã€‚æ‚¨ä¹Ÿå¯ä»¥åœ¨watchåæŒ‡å®šè¦è¿è¡Œçš„æŸ¥è¯¢ã€‚</p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">\watch</span><br></pre></td></tr></table></figure>

<h3 id="åœ¨äº¤äº’æ¨¡å¼ä¸‹ï¼Œå½“å‡ºç°é”™è¯¯æ—¶å›æ»šåˆ°ä¸Šä¸€ä¸ªè¯­å¥ã€‚"><a href="#åœ¨äº¤äº’æ¨¡å¼ä¸‹ï¼Œå½“å‡ºç°é”™è¯¯æ—¶å›æ»šåˆ°ä¸Šä¸€ä¸ªè¯­å¥ã€‚" class="headerlink" title="åœ¨äº¤äº’æ¨¡å¼ä¸‹ï¼Œå½“å‡ºç°é”™è¯¯æ—¶å›æ»šåˆ°ä¸Šä¸€ä¸ªè¯­å¥ã€‚"></a>åœ¨äº¤äº’æ¨¡å¼ä¸‹ï¼Œå½“å‡ºç°é”™è¯¯æ—¶å›æ»šåˆ°ä¸Šä¸€ä¸ªè¯­å¥ã€‚</h3><blockquote>
<p>å½“æ‚¨åœ¨äº¤äº’æ¨¡å¼é‡åˆ°é”™è¯¯æ—¶ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨å›æ»šåˆ°å‰ä¸€æ¡å‘½ä»¤ä¹‹å‰çš„çŠ¶æ€ï¼Œä½¿æ‚¨å¯ä»¥åƒé¢„æœŸçš„é‚£æ ·ç»§ç»­å·¥ä½œã€‚</p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">\<span class="keyword">set</span> ON_ERROR_ROLLBACK interactive</span><br></pre></td></tr></table></figure>

<h3 id="ç›´æ¥ä»psqlå¯¼å‡ºCSV"><a href="#ç›´æ¥ä»psqlå¯¼å‡ºCSV" class="headerlink" title="ç›´æ¥ä»psqlå¯¼å‡ºCSV"></a>ç›´æ¥ä»psqlå¯¼å‡ºCSV</h3><blockquote>
<p>å½“ä½¿ç”¨æŸ¥è¯¢æ—¶æä¾›<code>--csv</code>å€¼ï¼Œè¯¥å‘½ä»¤å°†è¿è¡Œç‰¹å®šæŸ¥è¯¢å¹¶å°†CSVè¿”å›åˆ°æ ‡å‡†è¾“å‡ºã€‚</p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">psql <span class="operator">&lt;</span>connection<span class="operator">-</span>string<span class="operator">&gt;</span> <span class="comment">--csv -c &#x27;select * from test;&#x27;</span></span><br></pre></td></tr></table></figure>

<h3 id="åœ¨psqlä¸­è¿è¡Œæ¥è‡ªæ–‡ä»¶çš„æŸ¥è¯¢"><a href="#åœ¨psqlä¸­è¿è¡Œæ¥è‡ªæ–‡ä»¶çš„æŸ¥è¯¢" class="headerlink" title="åœ¨psqlä¸­è¿è¡Œæ¥è‡ªæ–‡ä»¶çš„æŸ¥è¯¢"></a>åœ¨psqlä¸­è¿è¡Œæ¥è‡ªæ–‡ä»¶çš„æŸ¥è¯¢</h3><blockquote>
<p>åœ¨ psql ä¸­æ‰§è¡ŒæŒ‡å®šçš„æ–‡ä»¶ã€‚</p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">\i filename</span><br></pre></td></tr></table></figure>

<h3 id="åœ¨-psql-ä¸­æä¾›æ¸…æ™°çš„è¾¹æ¡†"><a href="#åœ¨-psql-ä¸­æä¾›æ¸…æ™°çš„è¾¹æ¡†" class="headerlink" title="åœ¨ psql ä¸­æä¾›æ¸…æ™°çš„è¾¹æ¡†"></a>åœ¨ psql ä¸­æä¾›æ¸…æ™°çš„è¾¹æ¡†</h3><blockquote>
<p>åœ¨psqlä¸­ï¼Œå½“ä½ æŸ¥è¯¢ç»“æœè¾“å‡ºæ—¶ï¼Œä¼šç»™ç»“æœåŠ ä¸Šè¾¹æ¡†ã€‚</p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">\pset border <span class="number">2</span></span><br></pre></td></tr></table></figure>

<h2 id="Refer"><a href="#Refer" class="headerlink" title="Refer"></a>Refer</h2><p><a target="_blank" rel="noopener" href="https://www.crunchydata.com/postgres-tips">https://www.crunchydata.com/postgres-tips</a></p>

                    
                        


                    
                    
                        <p>
                            <a
                                href="/2024/03/04/Postgres%E6%8A%80%E5%B7%A7/#post-footer"
                                class="postShorten-excerpt_link link"
                                aria-label=""
                            >
                                Comment and share
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    <div class="pagination-bar">
    <ul class="pagination">
        
        
        <li class="pagination-number">page 1 of 1</li>
    </ul>
</div>

</section>



                <footer id="footer" class="main-content-wrap">
    <span class="copyrights">
        Copyrights &copy; 2025 Topsion. All Rights Reserved.
    </span>
</footer>

            </div>
            
        </div>
        


    
        
    

<div id="about">
    <div id="about-card">
        <div id="about-btn-close">
            <i class="fa fa-times"></i>
        </div>
        
            <img id="about-card-picture" src="/assets/images/avatar.jpg" alt="Author&#39;s picture"/>
        
            <h4 id="about-card-name">Topsion</h4>
        
            <div id="about-card-bio"><p>Fullstack Developer</p>
</div>
        
        
            <div id="about-card-job">
                <i class="fa fa-briefcase"></i>
                <br/>
                <p>Coder</p>

            </div>
        
        
            <div id="about-card-location">
                <i class="fa fa-map-marker-alt"></i>
                <br/>
                Xi&#39;an China
            </div>
        
    </div>
</div>

        
        
<div id="cover" style="background-image:url('/assets/images/cover.jpg');"></div>
        <!--SCRIPTS-->

<script src="/assets/js/script-q2wtdh1f7oaxzdmuuvsc1uyl8fnwcg5dz7kgztdayssvj6qd6o7u5zwralwk.min.js"></script>

<!--SCRIPTS END-->





    </body>
</html>
