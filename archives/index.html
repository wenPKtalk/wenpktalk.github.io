
<!DOCTYPE html>
<html lang="en">
    
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="Summary">
    <title>Archives - Summary</title>
    <meta name="author" content="Topsion">
    
    
    
    <script type="application/ld+json">{}</script>
    <meta name="description" content="The whole problem with the world is that fools and fanatics are always so certain of themselves, and wiser people so full of doubts.(这个世界的问题在于聪明人充满疑惑而傻子却坚信不疑)">
<meta property="og:type" content="blog">
<meta property="og:title" content="Summary">
<meta property="og:url" content="http://example.com/archives/index.html">
<meta property="og:site_name" content="Summary">
<meta property="og:description" content="The whole problem with the world is that fools and fanatics are always so certain of themselves, and wiser people so full of doubts.(这个世界的问题在于聪明人充满疑惑而傻子却坚信不疑)">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="Topsion">
<meta name="twitter:card" content="summary">
    
    
        
    
    
        <meta property="og:image" content="http://example.com/assets/images/avatar.jpg"/>
    
    
    
    
    <!--STYLES-->
    
<link rel="stylesheet" href="/assets/css/style-yaeygdlgk8x4rqd5mp0jrkosoe3fmfokggmiu05rmpel4wjoxmvp5s6gestz.min.css">

    <!--STYLES END-->
    

    

    
</head>

    <body>
        <div id="blog">
            <!-- Define author's picture -->


    
        
            
        
    

<header id="header" data-behavior="1">
    <i id="btn-open-sidebar" class="fa fa-lg fa-bars"></i>
    <div class="header-title">
        <a
            class="header-title-link"
            href="/"
            aria-label=""
        >
            Summary
        </a>
    </div>
    
        
            <a
                class="header-right-picture "
                href="#about"
                aria-label="Open the link: /#about"
            >
        
        
            <img class="header-picture" src="/assets/images/avatar.jpg" alt="Author&#39;s picture"/>
        
        </a>
    
</header>

            <!-- Define author's picture -->



        
    

<nav id="sidebar" data-behavior="1">
    <div class="sidebar-container">
        
            <div class="sidebar-profile">
                <a
                    href="/#about"
                    aria-label="Read more about the author"
                >
                    <img class="sidebar-profile-picture" src="/assets/images/avatar.jpg" alt="Author&#39;s picture"/>
                </a>
                <h4 class="sidebar-profile-name">Topsion</h4>
                
                    <h5 class="sidebar-profile-bio"><p>Fullstack Developer</p>
</h5>
                
            </div>
        
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/"
                            
                            rel="noopener"
                            title="Home"
                        >
                        <i class="sidebar-button-icon fa fa-home" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Home</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/all-categories"
                            
                            rel="noopener"
                            title="Categories"
                        >
                        <i class="sidebar-button-icon fa fa-bookmark" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Categories</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/all-tags"
                            
                            rel="noopener"
                            title="Tags"
                        >
                        <i class="sidebar-button-icon fa fa-tags" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Tags</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/all-archives"
                            
                            rel="noopener"
                            title="Archives"
                        >
                        <i class="sidebar-button-icon fa fa-archive" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Archives</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link open-algolia-search"
                            href="#search"
                            
                            rel="noopener"
                            title="Search"
                        >
                        <i class="sidebar-button-icon fa fa-search" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Search</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="#about"
                            
                            rel="noopener"
                            title="About"
                        >
                        <i class="sidebar-button-icon fa fa-question" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">About</span>
                    </a>
            </li>
            
        </ul>
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="https://github.com/wenPKtalk"
                            
                                target="_blank"
                            
                            rel="noopener"
                            title="GitHub"
                        >
                        <i class="sidebar-button-icon fab fa-github" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">GitHub</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="https://stackoverflow.com/users/15967860/topsion"
                            
                                target="_blank"
                            
                            rel="noopener"
                            title="Stack Overflow"
                        >
                        <i class="sidebar-button-icon fab fa-stack-overflow" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Stack Overflow</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="https://www.linkedin.com/feed/"
                            
                                target="_blank"
                            
                            rel="noopener"
                            title="LinkedIn"
                        >
                        <i class="sidebar-button-icon fab fa-linkedin" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">LinkedIn</span>
                    </a>
            </li>
            
        </ul>
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/atom.xml"
                            
                            rel="noopener"
                            title="RSS"
                        >
                        <i class="sidebar-button-icon fa fa-rss" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">RSS</span>
                    </a>
            </li>
            
        </ul>
        
    </div>
</nav>

            
            <div id="main" data-behavior="1"
                 class="
                        hasCoverMetaIn
                        ">
                
    <section class="postShorten-group main-content-wrap">
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title">
                    
                        <a
                            class="link-unstyled"
                            href="/2025/08/25/%E6%9E%B6%E6%9E%84%E9%80%89%E6%8B%A9%E5%8D%95%E4%BD%93%E8%BF%98%E6%98%AF%E5%BE%AE%E6%9C%8D%E5%8A%A1/"
                            aria-label=": 架构选择单体还是微服务"
                        >
                            架构选择单体还是微服务
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time datetime="2025-08-25T23:20:28+00:00">
	
		    Aug 25, 2025
    	
    </time>
    
        <span>in </span>
        
    <a class="category-link" href="/categories/Architecture/">Architecture</a>


    
</div>

            </div>
            
                <div class="postShorten-content">
                    <blockquote>
<p>Java Microservices is one of the hottest skills in the current job market.</p>
</blockquote>
<h2 id="What-issues-need-to-be-considered-when-choosing-the-right-architecture-style"><a href="#What-issues-need-to-be-considered-when-choosing-the-right-architecture-style" class="headerlink" title="What issues need to be considered when choosing the right architecture style?"></a>What issues need to be considered when choosing the right architecture style?</h2><ol>
<li>Monolith vs Microservices differences and when to choose which.</li>
<li>How to design a microservice from scratch.</li>
<li>API Gateway pattern and its advantages.</li>
<li>Inter-service communication: REST vs Messaging.</li>
<li>Circuit Breaker pattern and its implementation using Reslience4j.</li>
<li>Load balancing in microservices using Spring Cloud Load Balancer.</li>
<li>How Spring Cloud Config helps in centralized configuration management.</li>
<li>Service discovery using Eureka or Consul.</li>
<li>Feign Client vs WebClient: Which one to use and why.</li>
<li>Event-driven architecture and kafka integration.</li>
<li>Database per service vs Shared Database: Pros and cons.</li>
<li>Saga Pattern for distributed transactions in microservices.</li>
<li>JWT-based authentication and OAuth2 in microservices.</li>
<li>How to handle security in an API Gateway.</li>
<li>Observability: Logging, tracing, and monitoring best practices.</li>
<li>Role of Prometheus and Grafana in microservices monitoring.</li>
<li>Kubernetes deployment strategies for microservices.</li>
<li>When to use WebFlux for reactive microservices.</li>
<li>CQRS and Event Sourcing: When and why to use them.</li>
<li>Infrastructure: CI/CD for microsercies.</li>
</ol>

                    
                        


                    
                    
                        <p>
                            <a
                                href="/2025/08/25/%E6%9E%B6%E6%9E%84%E9%80%89%E6%8B%A9%E5%8D%95%E4%BD%93%E8%BF%98%E6%98%AF%E5%BE%AE%E6%9C%8D%E5%8A%A1/#post-footer"
                                class="postShorten-excerpt_link link"
                                aria-label=""
                            >
                                Comment and share
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title">
                    
                        <a
                            class="link-unstyled"
                            href="/2025/05/20/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%9A%84%E6%A6%82%E5%BF%B5/"
                            aria-label=": 操作系统中术语的相关概念"
                        >
                            操作系统中术语的相关概念
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time datetime="2025-05-20T14:25:18+00:00">
	
		    May 20, 2025
    	
    </time>
    
</div>

            </div>
            
                <div class="postShorten-content">
                    <p>操作系统中25 个关键术语及其简要定义，涵盖了操作系统中的核心概念。以下是总结：</p>
<ol>
<li><strong>进程与线程</strong>：进程是运行中的程序实例，拥有独立内存和资源；线程是进程内的最小执行单位，共享进程内存。</li>
<li><strong>上下文切换与调度</strong>：上下文切换是 CPU 从一个进程/线程切换到另一个；调度由操作系统决定进程/线程的 CPU 时间分配。</li>
<li><strong>内存管理</strong>：包括虚拟内存（允许程序使用超出物理内存的内存）、分页（将内存分为固定大小块）、分段（逻辑划分内存为代码、数据、栈等）、交换（在内存满时将数据移到磁盘）。</li>
<li><strong>内核与用户空间</strong>：内核是操作系统核心，控制内存、进程、I/O；用户空间运行用户程序，受限访问，内核有完全权限。</li>
<li><strong>中断与系统调用</strong>：中断是通知 CPU 处理紧急事件的信号；系统调用是程序请求操作系统执行底层操作。</li>
<li><strong>I/O 与文件系统</strong>：I/O 缓冲暂时存储数据以提升性能；文件描述符是操作系统对打开文件或套接字的引用；文件系统管理磁盘上的数据存储与访问。</li>
<li><strong>并发与同步问题</strong>：死锁是进程互相等待资源导致无法继续；竞争条件是系统输出依赖于不可控事件时序。</li>
<li><strong>信号与进程控制</strong>：信号用于通知进程事件（如终止或中断）；Fork &amp; Exec 在 Unix 中用于创建新进程和运行程序。</li>
<li><strong>后台进程与内存问题</strong>：守护进程/服务是无需用户交互的后台进程；内存泄漏是分配的内存未释放导致系统变慢；僵尸进程是已终止但仍留在进程表中的进程。</li>
<li><strong>孤儿进程与启动</strong>：孤儿进程是父进程退出后被 init（PID 1）收养的进程；引导加载程序是系统启动时加载操作系统的底层程序。</li>
<li><strong>文件系统挂载</strong>：挂载是将文件系统（如 USB 或外部磁盘）附加到主文件系统树的过程。</li>
</ol>
<p>对应英文：<br><img src="https://cdn.jsdelivr.net/gh/wenPKtalk/pictures/wenPKtalk/pictures/2025-05-20/20250520143256-2025-05-20.png" alt="20250520143256-2025-05-20"></p>

                    
                        


                    
                    
                        <p>
                            <a
                                href="/2025/05/20/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%9A%84%E6%A6%82%E5%BF%B5/#post-footer"
                                class="postShorten-excerpt_link link"
                                aria-label=""
                            >
                                Comment and share
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title">
                    
                        <a
                            class="link-unstyled"
                            href="/2025/04/07/Design-Pattern-Summary/"
                            aria-label=": Design Pattern Summary"
                        >
                            Design Pattern Summary
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time datetime="2025-04-07T15:23:23+00:00">
	
		    Apr 07, 2025
    	
    </time>
    
</div>

            </div>
            
                <div class="postShorten-content">
                    <h2 id="设计模式概览"><a href="#设计模式概览" class="headerlink" title="设计模式概览"></a>设计模式概览</h2><h3 id="1-Singleton（单例模式）"><a href="#1-Singleton（单例模式）" class="headerlink" title="1. Singleton（单例模式）"></a>1. Singleton（单例模式）</h3><p>类别：创建型（Creational）<br>说明：确保一个类只有一个实例，并提供全局访问点。<br>使用场景：当需要确保只有一个实例时（例如，数据库连接、配置管理）。<br>独特性：限制实例化为单一对象。<br>常见用例：日志记录、线程池、缓存、配置设置。<br>UML图：<br><img src="https://cdn.jsdelivr.net/gh/wenPKtalk/pictures/wenPKtalk/pictures/2025-04-07/20250407152734-2025-04-07.png" alt="20250407152734-2025-04-07"></p>
<h3 id="2-Factory-Method（工厂方法模式）"><a href="#2-Factory-Method（工厂方法模式）" class="headerlink" title="2. Factory Method（工厂方法模式）"></a>2. Factory Method（工厂方法模式）</h3><p>类别：创建型<br>说明：提供一个接口用于创建对象，但让子类决定创建对象的具体类型。<br>使用场景：当对象创建逻辑需要集中管理且动态时。<br>独特性：将对象创建逻辑封装在一个方法中。<br>常见用例：框架、库、依赖注入。<br>UML图：<br><img src="https://cdn.jsdelivr.net/gh/wenPKtalk/pictures/wenPKtalk/pictures/2025-04-07/20250407172852-2025-04-07.png" alt="20250407172852-2025-04-07"></p>
<h3 id="3-Abstract-Factory（抽象工厂模式）"><a href="#3-Abstract-Factory（抽象工厂模式）" class="headerlink" title="3. Abstract Factory（抽象工厂模式）"></a>3. Abstract Factory（抽象工厂模式）</h3><p>类别：创建型<br>说明：创建一组相关或依赖对象的接口，而无需指定具体类。<br>使用场景：当需要动态创建多个相关对象家族时。<br>独特性：封装多个工厂方法。<br>常见用例：跨平台UI工具包、插件架构、创建复杂对象（例如文档、UI组件、HTTP请求）。<br>UML图：<br><img src="https://cdn.jsdelivr.net/gh/wenPKtalk/pictures/wenPKtalk/pictures/2025-04-07/20250407173021-2025-04-07.png" alt="20250407173021-2025-04-07"></p>
<h3 id="4-Builder（建造者模式）"><a href="#4-Builder（建造者模式）" class="headerlink" title="4. Builder（建造者模式）"></a>4. Builder（建造者模式）</h3><p>类别：创建型<br>说明：将对象的构造过程与其表示分离，允许分步创建。<br>使用场景：当对象构造逻辑复杂时。<br>独特性：允许分步构建对象。<br>常见用例：游戏开发（例如克隆敌人）、对象池。<br>UML图：<br><img src="https://cdn.jsdelivr.net/gh/wenPKtalk/pictures/wenPKtalk/pictures/2025-04-07/20250407173147-2025-04-07.png" alt="20250407173147-2025-04-07"></p>
<h3 id="5-Prototype（原型模式）"><a href="#5-Prototype（原型模式）" class="headerlink" title="5. Prototype（原型模式）"></a>5. Prototype（原型模式）</h3><p>类别：创建型<br>说明：通过复制原型实例来创建对象。<br>使用场景：当对象创建成本高且克隆更高效时。<br>独特性：通过克隆现有对象创建。<br>常见用例：游戏开发（例如克隆敌人）、对象池。<br>UML图：<br><img src="https://cdn.jsdelivr.net/gh/wenPKtalk/pictures/wenPKtalk/pictures/2025-04-07/20250407173247-2025-04-07.png" alt="20250407173247-2025-04-07"></p>
<h3 id="6-Adapter（适配器模式）"><a href="#6-Adapter（适配器模式）" class="headerlink" title="6. Adapter（适配器模式）"></a>6. Adapter（适配器模式）</h3><p>类别：结构型（Structural）<br>说明：允许不兼容的接口协同工作。<br>使用场景：当需要整合遗留代码或第三方API时。<br>独特性：作为不兼容接口之间的桥梁。<br>常见用例：连接遗留系统、API兼容性。<br>UML图：<br><img src="https://cdn.jsdelivr.net/gh/wenPKtalk/pictures/wenPKtalk/pictures/2025-04-07/20250407173343-2025-04-07.png" alt="20250407173343-2025-04-07"></p>
<h3 id="7-Decorator（装饰者模式）"><a href="#7-Decorator（装饰者模式）" class="headerlink" title="7. Decorator（装饰者模式）"></a>7. Decorator（装饰者模式）</h3><p>类别：结构型<br>说明：动态地为对象添加行为，而无需修改其类。<br>使用场景：当需要动态扩展功能时。<br>独特性：包装对象以添加行为。<br>常见用例：日志记录、缓存、权限、安全包装。<br>UML图：<br><img src="https://cdn.jsdelivr.net/gh/wenPKtalk/pictures/wenPKtalk/pictures/2025-04-07/20250407173502-2025-04-07.png" alt="20250407173502-2025-04-07"></p>
<h3 id="8-Facade（外观模式）"><a href="#8-Facade（外观模式）" class="headerlink" title="8. Facade（外观模式）"></a>8. Facade（外观模式）</h3><p>类别：结构型<br>说明：为子系统中的一组接口提供统一的接口。<br>使用场景：当需要简化复杂子系统供客户端使用时。<br>独特性：隐藏复杂性，提供简单接口。<br>常见用例：API网关、复杂库、应用程序。<br>UML图：<br><img src="https://cdn.jsdelivr.net/gh/wenPKtalk/pictures/wenPKtalk/pictures/2025-04-07/20250407173619-2025-04-07.png" alt="20250407173619-2025-04-07"></p>
<h3 id="9-Proxy（代理模式）"><a href="#9-Proxy（代理模式）" class="headerlink" title="9. Proxy（代理模式）"></a>9. Proxy（代理模式）</h3><p>类别：结构型<br>说明：为另一个对象提供代理或占位符以控制访问。<br>使用场景：当需要控制对象访问时（例如，延迟初始化、安全、远程访问）。<br>独特性：作为受控访问的中间人。<br>常见用例：延迟加载、安全代理、远程代理。<br>UML图：<br><img src="https://cdn.jsdelivr.net/gh/wenPKtalk/pictures/wenPKtalk/pictures/2025-04-07/20250407173704-2025-04-07.png" alt="20250407173704-2025-04-07"></p>
<h3 id="10-Bridge（桥接模式）"><a href="#10-Bridge（桥接模式）" class="headerlink" title="10. Bridge（桥接模式）"></a>10. Bridge（桥接模式）</h3><p>类别：结构型<br>说明：将抽象与实现解耦，使两者可以独立变化。<br>使用场景：当抽象和实现需要独立扩展时。<br>独特性：分离抽象与实现。<br>常见用例：跨平台GUI框架、设备驱动。<br>UML图：<br><img src="https://cdn.jsdelivr.net/gh/wenPKtalk/pictures/wenPKtalk/pictures/2025-04-07/20250407173746-2025-04-07.png" alt="20250407173746-2025-04-07"></p>
<h3 id="11-Composite（组合模式）"><a href="#11-Composite（组合模式）" class="headerlink" title="11. Composite（组合模式）"></a>11. Composite（组合模式）</h3><p>类别：结构型<br>说明：允许以统一方式处理单个对象和对象组合。<br>使用场景：当处理树形结构时，组件和组合需要一致处理。<br>独特性：表示部分-整体层次。<br>常见用例：文件系统、UI元素。<br>UML图：<br><img src="https://cdn.jsdelivr.net/gh/wenPKtalk/pictures/wenPKtalk/pictures/2025-04-07/20250407173857-2025-04-07.png" alt="20250407173857-2025-04-07"></p>
<h3 id="12-Observer（观察者模式）"><a href="#12-Observer（观察者模式）" class="headerlink" title="12. Observer（观察者模式）"></a>12. Observer（观察者模式）</h3><p>类别：行为型（Behavioral）<br>说明：定义对象间一对多的依赖关系，当状态变化时通知所有依赖对象。<br>使用场景：当多个对象需要对状态变化做出反应时。<br>独特性：封装事件驱动通信。<br>常见用例：事件处理、UI框架、发布-订阅系统。<br>UML图：<br><img src="https://cdn.jsdelivr.net/gh/wenPKtalk/pictures/wenPKtalk/pictures/2025-04-07/20250407173955-2025-04-07.png" alt="20250407173955-2025-04-07"></p>
<h3 id="13-Strategy（策略模式）"><a href="#13-Strategy（策略模式）" class="headerlink" title="13. Strategy（策略模式）"></a>13. Strategy（策略模式）</h3><p>类别：行为型<br>说明：定义一组算法家族，使其可互换。<br>使用场景：当需要在运行时选择行为时。<br>独特性：封装可互换算法。<br>常见用例：排序算法、验证策略。<br>UML图：<br><img src="https://cdn.jsdelivr.net/gh/wenPKtalk/pictures/wenPKtalk/pictures/2025-04-07/20250407174040-2025-04-07.png" alt="20250407174040-2025-04-07"></p>
<h3 id="14-Command（命令模式）"><a href="#14-Command（命令模式）" class="headerlink" title="14. Command（命令模式）"></a>14. Command（命令模式）</h3><p>类别：行为型<br>说明：将请求封装为对象，允许参数化客户端。<br>使用场景：当需要撤销/重做功能或排队请求时。<br>独特性：将请求封装为对象。<br>常见用例：事务系统、撤销/重做、远程操作。<br>UML图：<br><img src="https://cdn.jsdelivr.net/gh/wenPKtalk/pictures/wenPKtalk/pictures/2025-04-07/20250407174120-2025-04-07.png" alt="20250407174120-2025-04-07"></p>
<h3 id="15-State（状态模式）"><a href="#15-State（状态模式）" class="headerlink" title="15. State（状态模式）"></a>15. State（状态模式）</h3><p>类别：行为型<br>说明：允许对象在其内部状态改变时改变行为。<br>使用场景：当对象行为随状态变化时。<br>独特性：封装状态特定行为。<br>常见用例：状态机、工作流管理。<br>UML图：<br><img src="https://cdn.jsdelivr.net/gh/wenPKtalk/pictures/wenPKtalk/pictures/2025-04-07/20250407174208-2025-04-07.png" alt="20250407174208-2025-04-07"></p>
<h3 id="16-Mediator（中介者模式）"><a href="#16-Mediator（中介者模式）" class="headerlink" title="16. Mediator（中介者模式）"></a>16. Mediator（中介者模式）</h3><p>类别：行为型<br>说明：定义一个对象，封装对象间的交互。<br>使用场景：当需要减少对象间的直接依赖时。<br>独特性：集中通信。<br>常见用例：聊天室、事件处理、消息系统。<br><img src="https://cdn.jsdelivr.net/gh/wenPKtalk/pictures/wenPKtalk/pictures/2025-04-07/20250407174241-2025-04-07.png" alt="20250407174241-2025-04-07"></p>
<h3 id="17-Chain-of-Responsibility（责任链模式）"><a href="#17-Chain-of-Responsibility（责任链模式）" class="headerlink" title="17. Chain of Responsibility（责任链模式）"></a>17. Chain of Responsibility（责任链模式）</h3><p>类别：行为型<br>说明：将请求沿处理者链传递，直到一个处理者处理它。<br>使用场景：当请求处理者需要动态处理时。<br>独特性：允许动态处理者委托。<br>常见用例：日志框架、事件传播。<br><img src="https://cdn.jsdelivr.net/gh/wenPKtalk/pictures/wenPKtalk/pictures/2025-04-07/20250407174319-2025-04-07.png" alt="20250407174319-2025-04-07"></p>
<h3 id="18-Template-Method（模板方法模式）"><a href="#18-Template-Method（模板方法模式）" class="headerlink" title="18. Template Method（模板方法模式）"></a>18. Template Method（模板方法模式）</h3><p>类别：行为型<br>说明：定义算法骨架，子类按步骤填充。<br>使用场景：当需要强制执行一系列步骤但允许灵活性时。<br>独特性：封装算法结构。<br>常见用例：框架、算法定制。<br>UML图：<br><img src="https://cdn.jsdelivr.net/gh/wenPKtalk/pictures/wenPKtalk/pictures/2025-04-07/20250407174354-2025-04-07.png" alt="20250407174354-2025-04-07"></p>
<p>工厂模式名称和别名的由来</p>
<ol>
<li>简单工厂（Simple Factory）<br>名称由来：被称为“简单”是因为它是最基础的工厂模式，逻辑简单，集中在一个类中。<br>别名：有时称为“静态工厂”（Static Factory），因为创建方法通常是静态的。<br>原因：它不属于GoF的23种模式，但因其简单性和实用性被广泛使用。</li>
<li>工厂方法（Factory Method）<br>名称由来：强调“方法”这一核心概念，工厂方法模式通过定义一个方法（factoryMethod()）来创建对象，具体实现由子类决定。<br>别名：有时称为“虚拟构造器”（Virtual Constructor），因为它通过多态性“构造”对象。<br>原因：通过方法的多态性实现对象的创建，符合面向对象设计原则。</li>
<li>抽象工厂（Abstract Factory）<br>名称由来：被称为“抽象”是因为它定义了一个抽象接口（或抽象类）来创建一组对象，具体工厂实现由子类提供。<br>别名：有时称为“工具包”（Kit），因为它提供了一套创建相关对象的工具。<br>原因：它抽象了产品家族的创建，适合需要创建一组相关对象的场景。<br>总结<br>工厂模式对比：<br>简单工厂：最简单，但扩展性差，适合小型系统。<br>工厂方法：关注单一产品，扩展性好，符合开放-封闭原则。<br>抽象工厂：处理产品家族，适合复杂对象创建场景。<br>名称由来：工厂模式名称反映了其核心特点（简单性、方法、抽象性），别名则源于其功能或实现方式（如静态工厂、虚拟构造器、工具包）。<br>UML图：通过类图展示了每种设计模式的结构和关系，帮助理解其实现方式和适用场景。</li>
</ol>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>创建型模式（Singleton, Factory Method, Abstract Factory, Builder, Prototype）：关注对象创建，解决实例化问题，适合需要动态或复杂对象创建的场景。<br>结构型模式（Adapter, Decorator, Facade, Proxy, Bridge, Composite）：关注对象和类的组织，简化结构或扩展功能，适合处理复杂系统或接口兼容性。<br>行为型模式（Observer, Strategy, Command, State, Mediator, Chain of Responsibility, Template Method）：关注对象间的交互和职责分配，适合动态行为或事件驱动系统。</p>

                    
                        


                    
                    
                        <p>
                            <a
                                href="/2025/04/07/Design-Pattern-Summary/#post-footer"
                                class="postShorten-excerpt_link link"
                                aria-label=""
                            >
                                Comment and share
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title">
                    
                        <a
                            class="link-unstyled"
                            href="/2025/04/03/Create-a-custom-Extension-based-on-Mockito-and-inject-mock-field/"
                            aria-label=": Create a custom Extension based on Mockito and inject mock field"
                        >
                            Create a custom Extension based on Mockito and inject mock field
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time datetime="2025-04-03T22:17:41+00:00">
	
		    Apr 03, 2025
    	
    </time>
    
</div>

            </div>
            
                <div class="postShorten-content">
                    <h1 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h1><blockquote>
<p>在Spring 使用注入依赖bean的时候，可能既有使用@Autowired 的字段注入，也可能使用构造器注入。如此场景，在写单元测试的时候使用@Mock的Field就是null了。这是由于Mockito初始化@InjectMocks的被<br>测试对象时的策略会采用合适的构造器进行实例化，着用@Mock的Field在使用时就是null.</p>
</blockquote>
<h1 id="示例代码"><a href="#示例代码" class="headerlink" title="示例代码"></a>示例代码</h1><p>OldService.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="meta">@RequiredArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OldService</span> &#123;</span><br><span class="line"> </span><br><span class="line">  <span class="meta">@Autowired</span></span><br><span class="line">  <span class="keyword">private</span> OldService2 oldService;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//add new dependency bean</span></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">final</span> NewService newService; </span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">save</span><span class="params">(SomeObject someObj)</span> &#123;</span><br><span class="line">    <span class="type">SomeObject</span> <span class="variable">newObject</span> <span class="operator">=</span> oldService.handleSome(someObj);</span><br><span class="line">    newService.save(newObject);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>OldServiceTest.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ExtendWith(MockitoExtension.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OldServiceTest</span> &#123;</span><br><span class="line">  <span class="meta">@InjectMocks</span></span><br><span class="line">  <span class="keyword">private</span> OldService oldService;</span><br><span class="line"> </span><br><span class="line">  <span class="meta">@Mock</span></span><br><span class="line">  <span class="keyword">private</span> OldService2 oldService;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Mock</span></span><br><span class="line">  <span class="keyword">private</span> NewService newService;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Test</span></span><br><span class="line">  <span class="keyword">void</span> <span class="title function_">should_save_but_oldService_will_NPE</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="comment">//will NPE</span></span><br><span class="line">    <span class="keyword">when</span>(oldService.handleSome(someObj)).thenReturn(newObject)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>


<h1 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h1><p>自定义CustomInjectionExtension.java 处理字段注入的mock</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br></pre></td><td class="code"><pre><span class="line">    <span class="keyword">import</span> org.junit.jupiter.api.extension.BeforeEachCallback;</span><br><span class="line">    <span class="keyword">import</span> org.junit.jupiter.api.extension.ExtensionContext;</span><br><span class="line">    <span class="keyword">import</span> org.mockito.InjectMocks;</span><br><span class="line">    <span class="keyword">import</span> org.mockito.Mock;</span><br><span class="line">    <span class="keyword">import</span> org.mockito.Mockito;</span><br><span class="line">    <span class="keyword">import</span> org.mockito.Spy;</span><br><span class="line">    <span class="keyword">import</span> java.lang.reflect.Constructor;</span><br><span class="line">    <span class="keyword">import</span> java.lang.reflect.Field;</span><br><span class="line">    <span class="keyword">import</span> java.lang.reflect.Parameter;</span><br><span class="line">    <span class="keyword">import</span> java.util.*;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * JUnit 5 extension that enhances Mockito&#x27;s dependency injection capabilities.</span></span><br><span class="line"><span class="comment">     * This extension locates fields annotated with <span class="doctag">@InjectMocks</span> and injects <span class="doctag">@Mock</span>/<span class="doctag">@Spy</span> objects</span></span><br><span class="line"><span class="comment">     * into them, handling null instances and constructor injection automatically.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CustomInjectionExtension</span> <span class="keyword">implements</span> <span class="title class_">BeforeEachCallback</span> &#123;</span><br><span class="line">    </span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">beforeEach</span><span class="params">(ExtensionContext context)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">            <span class="type">Object</span> <span class="variable">testInstance</span> <span class="operator">=</span> context.getRequiredTestInstance();</span><br><span class="line">    </span><br><span class="line">            <span class="comment">// Find and process the field with @InjectMocks annotation</span></span><br><span class="line">            <span class="type">Field</span> <span class="variable">injectMocksField</span> <span class="operator">=</span> findInjectMocksField(testInstance);</span><br><span class="line">            <span class="type">Object</span> <span class="variable">injectMocksInstance</span> <span class="operator">=</span> getOrCreateInjectMocksInstance(testInstance, injectMocksField);</span><br><span class="line">    </span><br><span class="line">            <span class="comment">// Perform dependency injection</span></span><br><span class="line">            injectDependencies(testInstance, injectMocksInstance, injectMocksField.getType());</span><br><span class="line">        &#125;</span><br><span class="line">    </span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * Finds the field annotated with <span class="doctag">@InjectMocks</span> in the test class.</span></span><br><span class="line"><span class="comment">         *</span></span><br><span class="line"><span class="comment">         * <span class="doctag">@param</span> testInstance the test class instance</span></span><br><span class="line"><span class="comment">         * <span class="doctag">@return</span> the field annotated with <span class="doctag">@InjectMocks</span></span></span><br><span class="line"><span class="comment">         * <span class="doctag">@throws</span> RuntimeException if no field with <span class="doctag">@InjectMocks</span> is found</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="keyword">private</span> Field <span class="title function_">findInjectMocksField</span><span class="params">(Object testInstance)</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> Arrays.stream(testInstance.getClass().getDeclaredFields())</span><br><span class="line">                    .filter(field -&gt; field.isAnnotationPresent(InjectMocks.class))</span><br><span class="line">                    .findFirst()</span><br><span class="line">                    .orElseThrow(() -&gt; <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;No @InjectMocks annotation found in test class&quot;</span>));</span><br><span class="line">        &#125;</span><br><span class="line">    </span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * Gets the existing <span class="doctag">@InjectMocks</span> instance or creates a new one if null.</span></span><br><span class="line"><span class="comment">         *</span></span><br><span class="line"><span class="comment">         * <span class="doctag">@param</span> testInstance the test class instance</span></span><br><span class="line"><span class="comment">         * <span class="doctag">@param</span> injectMocksField the field annotated with <span class="doctag">@InjectMocks</span></span></span><br><span class="line"><span class="comment">         * <span class="doctag">@return</span> the instance of the class to inject mocks into</span></span><br><span class="line"><span class="comment">         * <span class="doctag">@throws</span> Exception if instance creation fails</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="keyword">private</span> Object <span class="title function_">getOrCreateInjectMocksInstance</span><span class="params">(Object testInstance, Field injectMocksField)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">            injectMocksField.setAccessible(<span class="literal">true</span>);</span><br><span class="line">            <span class="type">Object</span> <span class="variable">injectMocksInstance</span> <span class="operator">=</span> injectMocksField.get(testInstance);</span><br><span class="line">    </span><br><span class="line">            <span class="keyword">if</span> (injectMocksInstance == <span class="literal">null</span>) &#123;</span><br><span class="line">                Map&lt;Class&lt;?&gt;, Object&gt; mocksByType = collectMockObjects(testInstance);</span><br><span class="line">                injectMocksInstance = createInstanceViaConstructor(injectMocksField.getType(), mocksByType);</span><br><span class="line">                injectMocksField.set(testInstance, injectMocksInstance);</span><br><span class="line">            &#125;</span><br><span class="line">    </span><br><span class="line">            <span class="keyword">return</span> injectMocksInstance;</span><br><span class="line">        &#125;</span><br><span class="line">    </span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * Collects all mock objects from the test class instance.</span></span><br><span class="line"><span class="comment">         *</span></span><br><span class="line"><span class="comment">         * <span class="doctag">@param</span> testInstance the test class instance</span></span><br><span class="line"><span class="comment">         * <span class="doctag">@return</span> map of mock objects by their type</span></span><br><span class="line"><span class="comment">         * <span class="doctag">@throws</span> IllegalAccessException if field access fails</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="keyword">private</span> Map&lt;Class&lt;?&gt;, Object&gt; collectMockObjects(Object testInstance) <span class="keyword">throws</span> IllegalAccessException &#123;</span><br><span class="line">            Map&lt;Class&lt;?&gt;, Object&gt; mocksByType = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">    </span><br><span class="line">            <span class="keyword">for</span> (Field field : testInstance.getClass().getDeclaredFields()) &#123;</span><br><span class="line">                <span class="keyword">if</span> (field.isAnnotationPresent(Mock.class) || field.isAnnotationPresent(Spy.class)) &#123;</span><br><span class="line">                    field.setAccessible(<span class="literal">true</span>);</span><br><span class="line">                    <span class="type">Object</span> <span class="variable">mockObject</span> <span class="operator">=</span> field.get(testInstance);</span><br><span class="line">    </span><br><span class="line">                    <span class="comment">// Create mock object if null</span></span><br><span class="line">                    <span class="keyword">if</span> (mockObject == <span class="literal">null</span>) &#123;</span><br><span class="line">                        mockObject = createMockObject(field);</span><br><span class="line">                        field.set(testInstance, mockObject);</span><br><span class="line">                    &#125;</span><br><span class="line">    </span><br><span class="line">                    mocksByType.put(field.getType(), mockObject);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">    </span><br><span class="line">            <span class="keyword">return</span> mocksByType;</span><br><span class="line">        &#125;</span><br><span class="line">    </span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * Creates a mock or spy object based on field annotations.</span></span><br><span class="line"><span class="comment">         *</span></span><br><span class="line"><span class="comment">         * <span class="doctag">@param</span> field the field to create a mock for</span></span><br><span class="line"><span class="comment">         * <span class="doctag">@return</span> created mock or spy object</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="keyword">private</span> Object <span class="title function_">createMockObject</span><span class="params">(Field field)</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (field.isAnnotationPresent(Mock.class)) &#123;</span><br><span class="line">                <span class="keyword">return</span> Mockito.mock(field.getType());</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> Mockito.spy(field.getType());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    </span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * Creates an instance of the target class by finding and using an appropriate constructor.</span></span><br><span class="line"><span class="comment">         *</span></span><br><span class="line"><span class="comment">         * <span class="doctag">@param</span> targetClass the class to instantiate</span></span><br><span class="line"><span class="comment">         * <span class="doctag">@param</span> availableMocks map of available mock objects by type</span></span><br><span class="line"><span class="comment">         * <span class="doctag">@return</span> the created instance</span></span><br><span class="line"><span class="comment">         * <span class="doctag">@throws</span> RuntimeException if instance creation fails</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="keyword">private</span> Object <span class="title function_">createInstanceViaConstructor</span><span class="params">(Class&lt;?&gt; targetClass, Map&lt;Class&lt;?&gt;, Object&gt; availableMocks)</span> &#123;</span><br><span class="line">            Constructor&lt;?&gt;[] constructors = targetClass.getDeclaredConstructors();</span><br><span class="line">            Arrays.sort(constructors, (c1, c2) -&gt; c2.getParameterCount() - c1.getParameterCount());</span><br><span class="line">    </span><br><span class="line">            <span class="keyword">for</span> (Constructor&lt;?&gt; constructor : constructors) &#123;</span><br><span class="line">                constructor.setAccessible(<span class="literal">true</span>);</span><br><span class="line">                Object[] constructorArgs = prepareConstructorArguments(constructor, availableMocks);</span><br><span class="line">    </span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    <span class="keyword">return</span> constructor.newInstance(constructorArgs);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                    <span class="comment">// Continue to next constructor if this one fails</span></span><br><span class="line">                    <span class="keyword">continue</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">    </span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(String.format(</span><br><span class="line">                    <span class="string">&quot;Could not instantiate %s. No suitable constructor found that can be called with available mocks.&quot;</span>,</span><br><span class="line">                    targetClass.getSimpleName()));</span><br><span class="line">        &#125;</span><br><span class="line">    </span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * Prepares arguments for a constructor by matching parameter types with available mocks.</span></span><br><span class="line"><span class="comment">         *</span></span><br><span class="line"><span class="comment">         * <span class="doctag">@param</span> constructor the constructor to prepare arguments for</span></span><br><span class="line"><span class="comment">         * <span class="doctag">@param</span> availableMocks map of available mock objects by type</span></span><br><span class="line"><span class="comment">         * <span class="doctag">@return</span> array of constructor arguments</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="keyword">private</span> Object[] prepareConstructorArguments(Constructor&lt;?&gt; constructor, Map&lt;Class&lt;?&gt;, Object&gt; availableMocks) &#123;</span><br><span class="line">            Parameter[] parameters = constructor.getParameters();</span><br><span class="line">            Object[] args = <span class="keyword">new</span> <span class="title class_">Object</span>[parameters.length];</span><br><span class="line">    </span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; parameters.length; i++) &#123;</span><br><span class="line">                Class&lt;?&gt; paramType = parameters[i].getType();</span><br><span class="line">                args[i] = findOrCreateMockForType(paramType, availableMocks);</span><br><span class="line">            &#125;</span><br><span class="line">    </span><br><span class="line">            <span class="keyword">return</span> args;</span><br><span class="line">        &#125;</span><br><span class="line">    </span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * Finds an existing mock for the given type or creates a new one.</span></span><br><span class="line"><span class="comment">         *</span></span><br><span class="line"><span class="comment">         * <span class="doctag">@param</span> requiredType the type to find or create a mock for</span></span><br><span class="line"><span class="comment">         * <span class="doctag">@param</span> availableMocks map of available mock objects by type</span></span><br><span class="line"><span class="comment">         * <span class="doctag">@return</span> a mock object compatible with the required type</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="keyword">private</span> Object <span class="title function_">findOrCreateMockForType</span><span class="params">(Class&lt;?&gt; requiredType, Map&lt;Class&lt;?&gt;, Object&gt; availableMocks)</span> &#123;</span><br><span class="line">            <span class="comment">// Try exact type match</span></span><br><span class="line">            <span class="type">Object</span> <span class="variable">mock</span> <span class="operator">=</span> availableMocks.get(requiredType);</span><br><span class="line">            <span class="keyword">if</span> (mock != <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> mock;</span><br><span class="line">            &#125;</span><br><span class="line">    </span><br><span class="line">            <span class="comment">// Try assignable types (interfaces, superclasses)</span></span><br><span class="line">            mock = availableMocks.entrySet().stream()</span><br><span class="line">                    .filter(entry -&gt; requiredType.isAssignableFrom(entry.getKey()))</span><br><span class="line">                    .map(Map.Entry::getValue)</span><br><span class="line">                    .findFirst()</span><br><span class="line">                    .orElse(<span class="literal">null</span>);</span><br><span class="line">    </span><br><span class="line">            <span class="keyword">if</span> (mock != <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> mock;</span><br><span class="line">            &#125;</span><br><span class="line">    </span><br><span class="line">            <span class="comment">// Create new mock if no match found</span></span><br><span class="line">            mock = Mockito.mock(requiredType);</span><br><span class="line">            availableMocks.put(requiredType, mock);</span><br><span class="line">            <span class="keyword">return</span> mock;</span><br><span class="line">        &#125;</span><br><span class="line">    </span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * Injects mock dependencies into the target instance.</span></span><br><span class="line"><span class="comment">         *</span></span><br><span class="line"><span class="comment">         * <span class="doctag">@param</span> testInstance the test class instance</span></span><br><span class="line"><span class="comment">         * <span class="doctag">@param</span> targetInstance the instance to inject mocks into</span></span><br><span class="line"><span class="comment">         * <span class="doctag">@param</span> targetClass the class of the target instance</span></span><br><span class="line"><span class="comment">         * <span class="doctag">@throws</span> Exception if injection fails</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">injectDependencies</span><span class="params">(Object testInstance, Object targetInstance, Class&lt;?&gt; targetClass)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">            Map&lt;Class&lt;?&gt;, Object&gt; mocksByType = collectMockObjects(testInstance);</span><br><span class="line">    </span><br><span class="line">            <span class="keyword">for</span> (Map.Entry&lt;Class&lt;?&gt;, Object&gt; entry : mocksByType.entrySet()) &#123;</span><br><span class="line">                Class&lt;?&gt; mockType = entry.getKey();</span><br><span class="line">                <span class="type">Object</span> <span class="variable">mockObject</span> <span class="operator">=</span> entry.getValue();</span><br><span class="line">    </span><br><span class="line">                injectMockIntoCompatibleFields(targetInstance, mockType, mockObject);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    </span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Injects a mock object into all compatible fields of the target instance.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> targetInstance the instance to inject mocks into</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> mockType the type of the mock object</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> mockObject the mock object to inject</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> IllegalAccessException if field access fails</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">injectMockIntoCompatibleFields</span><span class="params">(Object targetInstance, Class&lt;?&gt; mockType, Object mockObject)</span></span><br><span class="line">            <span class="keyword">throws</span> IllegalAccessException &#123;</span><br><span class="line">        Class&lt;?&gt; targetClass = targetInstance.getClass();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (Field field : getAllFields(targetClass)) &#123;</span><br><span class="line">            <span class="keyword">if</span> (isTypeCompatible(field.getType(), mockType)) &#123;</span><br><span class="line">                field.setAccessible(<span class="literal">true</span>);</span><br><span class="line">                <span class="keyword">if</span> (field.get(targetInstance) == <span class="literal">null</span>) &#123;</span><br><span class="line">                    field.set(targetInstance, mockObject);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Checks if two types are compatible for injection.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> fieldType the type of the field</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> mockType the type of the mock</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> true if the types are compatible, false otherwise</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> <span class="title function_">isTypeCompatible</span><span class="params">(Class&lt;?&gt; fieldType, Class&lt;?&gt; mockType)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> fieldType.isAssignableFrom(mockType) || mockType.isAssignableFrom(fieldType);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Gets all fields from a class and its superclasses.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> clazz the class to get fields from</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> array of all fields</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> Field[] getAllFields(Class&lt;?&gt; clazz) &#123;</span><br><span class="line">        List&lt;Field&gt; allFields = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        Class&lt;?&gt; currentClass = clazz;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> (currentClass != <span class="literal">null</span>) &#123;</span><br><span class="line">            allFields.addAll(Arrays.asList(currentClass.getDeclaredFields()));</span><br><span class="line">            currentClass = currentClass.getSuperclass();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> allFields.toArray(<span class="keyword">new</span> <span class="title class_">Field</span>[<span class="number">0</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>OldServiceTest.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ExtendWith(&#123;MockitoExtension.class, CustomInjectionExtension.class&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OldServiceTest</span> &#123;</span><br><span class="line">  <span class="meta">@InjectMocks</span></span><br><span class="line">  <span class="keyword">private</span> OldService oldService;</span><br><span class="line"> </span><br><span class="line">  <span class="meta">@Mock</span></span><br><span class="line">  <span class="keyword">private</span> OldService2 oldService;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Mock</span></span><br><span class="line">  <span class="keyword">private</span> NewService newService;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Test</span></span><br><span class="line">  <span class="keyword">void</span> <span class="title function_">should_save_but_oldService_will_NPE</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="comment">//will Fixed</span></span><br><span class="line">    <span class="keyword">when</span>(oldService.handleSome(someObj)).thenReturn(newObject)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



                    
                        


                    
                    
                        <p>
                            <a
                                href="/2025/04/03/Create-a-custom-Extension-based-on-Mockito-and-inject-mock-field/#post-footer"
                                class="postShorten-excerpt_link link"
                                aria-label=""
                            >
                                Comment and share
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title">
                    
                        <a
                            class="link-unstyled"
                            href="/2024/12/17/The-meaning-of-parameters-in-java-ThreadPoolExecutor/"
                            aria-label=": The meaning of parameters in java ThreadPoolExecutor"
                        >
                            The meaning of parameters in java ThreadPoolExecutor
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time datetime="2024-12-17T14:45:54+00:00">
	
		    Dec 17, 2024
    	
    </time>
    
        <span>in </span>
        
    <a class="category-link" href="/categories/Java/">Java</a>


    
</div>

            </div>
            
                <div class="postShorten-content">
                    <p>corePoolSize: the number of threads to keep in the pool, even if they are idle, unless allowCoreThreadTimeOut is set<br>maximumPoolSize: the maximum number of threads to allow in the pool keepAliveTime when the number of threads is greater than the core, this is the maximum time that excess idle threads will wait for new tasks before terminating.<br>unit : the time unit for the keepAliveTime argument<br>workQueue: the queue to use for holding tasks before they are executed. This queue will hold only the Runnable tasks submitted by the execute method.<br>handler: the handler to use when execution is blocked because the thread bounds and queue capacities are reache</p>
<ol>
<li>corePoolSize（核心线程数）</li>
</ol>
<p>线程池中会始终保持的最小线程数<br>即使这些线程处于空闲状态，也不会被销毁（除非设置了allowCoreThreadTimeOut为true）<br>这些线程响应速度最快，因为不需要创建新线程</p>
<ol start="2">
<li>maximumPoolSize（最大线程数）</li>
</ol>
<p>线程池允许创建的最大线程数<br>当工作队列满了，且当前线程数小于maximumPoolSize时，会创建新线程<br>超过这个数量的任务会触发拒绝策略</p>
<ol start="3">
<li>keepAliveTime（空闲线程存活时间）</li>
</ol>
<p>非核心线程空闲超过这个时间后会被销毁<br>如果allowCoreThreadTimeOut为true，核心线程也会受这个参数影响<br>用于减少资源浪费</p>
<ol start="4">
<li>unit（时间单位）</li>
</ol>
<p>keepAliveTime的时间单位<br>可以是SECONDS、MINUTES等TimeUnit枚举值</p>
<ol start="5">
<li>workQueue（工作队列）</li>
</ol>
<p>用于存放待执行的任务<br>常用队列类型：</p>
<p>ArrayBlockingQueue：有界队列<br>LinkedBlockingQueue：无界队列<br>SynchronousQueue：无缓冲的等待队列<br>PriorityBlockingQueue：优先级队列</p>
<ol start="6">
<li>handler（拒绝策略）</li>
</ol>
<p>当队列满且线程数达到maximumPoolSize时的处理策略<br>默认策略类型：</p>
<p>AbortPolicy：抛出异常（默认）<br>CallerRunsPolicy：在调用者线程执行<br>DiscardPolicy：直接丢弃<br>DiscardOldestPolicy：丢弃最早的任务</p>
<p><img src="https://cdn.jsdelivr.net/gh/wenPKtalk/pictures/wenPKtalk/pictures/2025-04-07/20250407150030-2025-04-07.png" alt="Process UML"></p>
<p>planUML描述如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line">@startuml</span><br><span class="line">title ThreadPoolExecutor执行流程</span><br><span class="line"></span><br><span class="line">skinparam backgroundColor #FFFFFF</span><br><span class="line">skinparam handwritten false</span><br><span class="line"></span><br><span class="line">start</span><br><span class="line"></span><br><span class="line">:提交新任务;</span><br><span class="line"></span><br><span class="line">if (当前线程数 &lt; 核心线程数?) then (是)</span><br><span class="line">  :创建新的核心线程;</span><br><span class="line">  :执行任务;</span><br><span class="line">else (否)</span><br><span class="line">  if (工作队列未满?) then (是)</span><br><span class="line">    :将任务放入工作队列;</span><br><span class="line">    note right</span><br><span class="line">      队列类型:</span><br><span class="line">      - ArrayBlockingQueue (有界)</span><br><span class="line">      - LinkedBlockingQueue (无界)</span><br><span class="line">      - SynchronousQueue (同步)</span><br><span class="line">      - PriorityBlockingQueue (优先级)</span><br><span class="line">    end note</span><br><span class="line">  else (否)</span><br><span class="line">    if (当前线程数 &lt; 最大线程数?) then (是)</span><br><span class="line">      :创建新的临时线程;</span><br><span class="line">      note right</span><br><span class="line">        临时线程在空闲超过</span><br><span class="line">        keepAliveTime后销毁</span><br><span class="line">      end note</span><br><span class="line">      :执行任务;</span><br><span class="line">    else (否)</span><br><span class="line">      :执行拒绝策略;</span><br><span class="line">      note right</span><br><span class="line">        拒绝策略:</span><br><span class="line">        - AbortPolicy (默认)</span><br><span class="line">        - CallerRunsPolicy</span><br><span class="line">        - DiscardPolicy</span><br><span class="line">        - DiscardOldestPolicy</span><br><span class="line">      end note</span><br><span class="line">    endif</span><br><span class="line">  endif</span><br><span class="line">endif</span><br><span class="line"></span><br><span class="line">fork</span><br><span class="line">  :核心线程池;</span><br><span class="line">  note right: 保持运行</span><br><span class="line">fork again</span><br><span class="line">  :临时线程池;</span><br><span class="line">  note right: 空闲超时销毁</span><br><span class="line">fork again</span><br><span class="line">  :等待队列;</span><br><span class="line">  note right: 任务缓存</span><br><span class="line">end fork</span><br><span class="line"></span><br><span class="line">stop</span><br><span class="line"></span><br><span class="line">legend right</span><br><span class="line">  参数说明:</span><br><span class="line">  ====</span><br><span class="line">  corePoolSize: 核心线程数</span><br><span class="line">  maximumPoolSize: 最大线程数</span><br><span class="line">  keepAliveTime: 空闲线程存活时间</span><br><span class="line">  workQueue: 工作队列</span><br><span class="line">  handler: 拒绝策略</span><br><span class="line">endlegend</span><br><span class="line"></span><br><span class="line">@enduml</span><br></pre></td></tr></table></figure>
                    
                        


                    
                    
                        <p>
                            <a
                                href="/2024/12/17/The-meaning-of-parameters-in-java-ThreadPoolExecutor/#post-footer"
                                class="postShorten-excerpt_link link"
                                aria-label=""
                            >
                                Comment and share
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title">
                    
                        <a
                            class="link-unstyled"
                            href="/2024/09/12/OrbStack-%E5%AE%89%E8%A3%85mongo5%E9%81%87%E5%88%B0%E7%9A%84%E9%94%99%E8%AF%AF%E5%92%8C%E8%A7%A3%E5%86%B3%E6%96%B9%E6%B3%95/"
                            aria-label=": OrbStack 安装mongo5遇到的错误和解决方法"
                        >
                            OrbStack 安装mongo5遇到的错误和解决方法
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time datetime="2024-09-12T18:04:17+00:00">
	
		    Sep 12, 2024
    	
    </time>
    
        <span>in </span>
        
    <a class="category-link" href="/categories/devOps/">devOps</a>


    
</div>

            </div>
            
                <div class="postShorten-content">
                    <h3 id="Macos-m2上使用OrbStack-docker-安装mongo5-0"><a href="#Macos-m2上使用OrbStack-docker-安装mongo5-0" class="headerlink" title="Macos m2上使用OrbStack docker 安装mongo5.0+"></a>Macos m2上使用OrbStack docker 安装mongo5.0+</h3><h3 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h3><p>macOS(m2) 从 desktop-docker 切换到OrbStack，使用mongo6.0镜像利用如下docker-compose.yml启动的时候会报错</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&#x27;3&#x27;</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">mongo:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">mongo:6.0</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">mongo</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;27017:27017&quot;</span> </span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">~/orbDocker/mongo/configdb:/data/configdb</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">~/orbDocker/mongo/db:/data/db</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="attr">MONGO_INITDB_ROOT_USERNAME:</span> <span class="string">root</span></span><br><span class="line">      <span class="attr">MONGO_INITDB_ROOT_PASSWORD:</span> <span class="string">root</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><code>docker-compose up</code></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[+] Running 0/0</span><br><span class="line"> ⠋ Network mongo_default  Creating                                                                                                                       0.1s</span><br><span class="line">[+] Running 2/2d orphan containers ([mongo-mongo-express-1]) for this project. If you removed or renamed this service in your compose file, you can run this c ✔ Network mongo_default  Created                                                                                                                        0.1s</span><br><span class="line"> ✔ Container mongo        Created                                                                                                                        0.1s</span><br><span class="line">Attaching to mongo</span><br><span class="line">mongo  |</span><br><span class="line">mongo  | WARNING: MongoDB 5.0+ requires a CPU with AVX support, and your current system does not appear to have that!</span><br><span class="line">mongo  |   see https://jira.mongodb.org/browse/SERVER-54407</span><br><span class="line">mongo  |   see also https://www.mongodb.com/community/forums/t/mongodb-5-0-cpu-intel-g4650-compatibility/116610/2</span><br><span class="line">mongo  |   see also https://github.com/docker-library/mongo/issues/485#issuecomment-891991814</span><br><span class="line">mongo  |</span><br><span class="line">mongo  | /usr/local/bin/docker-entrypoint.sh: line 416:    28 Illegal instruction     &quot;$&#123;mongodHackedArgs[@]&#125;&quot; --fork</span><br><span class="line">mongo exited with code 132</span><br></pre></td></tr></table></figure>



<p>修复给docker-compose.yml配置<code>platform: linux/arm64</code></p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&#x27;3&#x27;</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">mongo:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">mongo:6.0</span></span><br><span class="line">    <span class="attr">platform:</span> <span class="string">linux/arm64</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">mongo</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;27017:27017&quot;</span> </span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">~/orbDocker/mongo/configdb:/data/configdb</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">~/orbDocker/mongo/db:/data/db</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="attr">MONGO_INITDB_ROOT_USERNAME:</span> <span class="string">root</span></span><br><span class="line">      <span class="attr">MONGO_INITDB_ROOT_PASSWORD:</span> <span class="string">root</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
                    
                        


                    
                    
                        <p>
                            <a
                                href="/2024/09/12/OrbStack-%E5%AE%89%E8%A3%85mongo5%E9%81%87%E5%88%B0%E7%9A%84%E9%94%99%E8%AF%AF%E5%92%8C%E8%A7%A3%E5%86%B3%E6%96%B9%E6%B3%95/#post-footer"
                                class="postShorten-excerpt_link link"
                                aria-label=""
                            >
                                Comment and share
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title">
                    
                        <a
                            class="link-unstyled"
                            href="/2024/04/07/postgres-%E7%B4%A2%E5%BC%95%E7%B1%BB%E5%9E%8B/"
                            aria-label=": postgres 索引类型"
                        >
                            postgres 索引类型
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time datetime="2024-04-07T16:26:46+00:00">
	
		    Apr 07, 2024
    	
    </time>
    
</div>

            </div>
            
                <div class="postShorten-content">
                    <h3 id="Postgres提供的索引类型"><a href="#Postgres提供的索引类型" class="headerlink" title="Postgres提供的索引类型"></a>Postgres提供的索引类型</h3><p>B+Tree, Hash, GIN, GiST, BRIN</p>

                    
                        


                    
                    
                        <p>
                            <a
                                href="/2024/04/07/postgres-%E7%B4%A2%E5%BC%95%E7%B1%BB%E5%9E%8B/#post-footer"
                                class="postShorten-excerpt_link link"
                                aria-label=""
                            >
                                Comment and share
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title">
                    
                        <a
                            class="link-unstyled"
                            href="/2024/03/04/Postgres%E6%8A%80%E5%B7%A7/"
                            aria-label=": Postgres技巧"
                        >
                            Postgres技巧
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time datetime="2024-03-04T15:09:27+00:00">
	
		    Mar 04, 2024
    	
    </time>
    
</div>

            </div>
            
                <div class="postShorten-content">
                    <h2 id="Lock"><a href="#Lock" class="headerlink" title="Lock"></a>Lock</h2><h3 id="查找空闲且可能被锁定的进程。"><a href="#查找空闲且可能被锁定的进程。" class="headerlink" title="查找空闲且可能被锁定的进程。"></a>查找空闲且可能被锁定的进程。</h3><blockquote>
<p>这个查询查看pg_stat_activity视图，查找那些活跃但是等待事件或等待事件类型不为空的进程。</p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">		pid,</span><br><span class="line">		datname,</span><br><span class="line">		usename,</span><br><span class="line">		application_name,</span><br><span class="line">		client_addr,</span><br><span class="line">		client_port,</span><br><span class="line">		to_char (now (), <span class="string">&#x27;YYYY-MM-DD HH24:MI:SS&#x27;</span>) <span class="keyword">as</span> now,</span><br><span class="line">		to_char (now () <span class="operator">-</span> xact_start, <span class="string">&#x27;DD HH24:MI:SS MS&#x27;</span>) <span class="keyword">as</span> xact_time,</span><br><span class="line">		to_char (now () <span class="operator">-</span> query_start, <span class="string">&#x27;DD HH24:MI:SS MS&#x27;</span>) <span class="keyword">as</span> query_time,</span><br><span class="line">		state,</span><br><span class="line">		to_char (now () <span class="operator">-</span> state_change, <span class="string">&#x27;DD HH24:MI:SS MS&#x27;</span>) <span class="keyword">as</span> state_time,</span><br><span class="line">		wait_event,</span><br><span class="line">		wait_event_type,</span><br><span class="line">		<span class="keyword">left</span> (query, <span class="number">40</span>)</span><br><span class="line">	  <span class="keyword">FROM</span></span><br><span class="line">		pg_stat_activity</span><br><span class="line">	  <span class="keyword">WHERE</span></span><br><span class="line">		state <span class="operator">!=</span> <span class="string">&#x27;idle&#x27;</span></span><br><span class="line">		<span class="keyword">and</span> pid <span class="operator">!=</span> pg_backend_pid ()</span><br><span class="line">	  <span class="keyword">ORDER</span> <span class="keyword">BY</span></span><br><span class="line">		query_time <span class="keyword">desc</span>;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="找到具有等待事件的进程，向持有初始锁的PID汇总"><a href="#找到具有等待事件的进程，向持有初始锁的PID汇总" class="headerlink" title="找到具有等待事件的进程，向持有初始锁的PID汇总"></a>找到具有等待事件的进程，向持有初始锁的PID汇总</h3><blockquote>
<p>This query looks at at the pg_stat_activity and pg_locks view showing the pid, state, wait_event, and lock mode, as well as blocking pids.<br>这个查询查看了 pg_stat_activity 和 pg_locks 视图，显示了 pid、state、wait_event 和 lock mode，以及阻塞的 pid。</p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">WITH</span> sos <span class="keyword">AS</span> (</span><br><span class="line">			<span class="keyword">SELECT</span> array_cat(<span class="built_in">array_agg</span>(pid),</span><br><span class="line">				   <span class="built_in">array_agg</span>((pg_blocking_pids(pid))[array_length(pg_blocking_pids(pid),<span class="number">1</span>)])) pids</span><br><span class="line">			<span class="keyword">FROM</span> pg_locks</span><br><span class="line">			<span class="keyword">WHERE</span> <span class="keyword">NOT</span> granted</span><br><span class="line">		)</span><br><span class="line">		<span class="keyword">SELECT</span> a.pid, a.usename, a.datname, a.state,</span><br><span class="line">			   a.wait_event_type <span class="operator">||</span> <span class="string">&#x27;: &#x27;</span> <span class="operator">||</span> a.wait_event <span class="keyword">AS</span> wait_event,</span><br><span class="line">			   <span class="built_in">current_timestamp</span><span class="operator">-</span>a.state_change time_in_state,</span><br><span class="line">			   <span class="built_in">current_timestamp</span><span class="operator">-</span>a.xact_start time_in_xact,</span><br><span class="line">			   l.relation::regclass relname,</span><br><span class="line">			   l.locktype, l.mode, l.page, l.tuple,</span><br><span class="line">			   pg_blocking_pids(l.pid) blocking_pids,</span><br><span class="line">			   (pg_blocking_pids(l.pid))[array_length(pg_blocking_pids(l.pid),<span class="number">1</span>)] last_session,</span><br><span class="line">			   <span class="built_in">coalesce</span>((pg_blocking_pids(l.pid))[<span class="number">1</span>]<span class="operator">||</span><span class="string">&#x27;.&#x27;</span><span class="operator">||</span><span class="built_in">coalesce</span>(<span class="keyword">case</span> <span class="keyword">when</span> locktype<span class="operator">=</span><span class="string">&#x27;transactionid&#x27;</span> <span class="keyword">then</span> <span class="number">1</span> <span class="keyword">else</span> array_length(pg_blocking_pids(l.pid),<span class="number">1</span>)<span class="operator">+</span><span class="number">1</span> <span class="keyword">end</span>,<span class="number">0</span>),a.pid<span class="operator">||</span><span class="string">&#x27;.0&#x27;</span>) lock_depth,</span><br><span class="line">			   a.query</span><br><span class="line">		<span class="keyword">FROM</span> pg_stat_activity a</span><br><span class="line">			 <span class="keyword">JOIN</span> sos s <span class="keyword">on</span> (a.pid <span class="operator">=</span> <span class="keyword">any</span>(s.pids))</span><br><span class="line">			 <span class="keyword">LEFT</span> <span class="keyword">OUTER</span> <span class="keyword">JOIN</span> pg_locks l <span class="keyword">on</span> (a.pid <span class="operator">=</span> l.pid <span class="keyword">and</span> <span class="keyword">not</span> l.granted)</span><br><span class="line">		<span class="keyword">ORDER</span> <span class="keyword">BY</span> lock_depth;</span><br></pre></td></tr></table></figure>

<h3 id="Set-a-lock-timeout"><a href="#Set-a-lock-timeout" class="headerlink" title="Set a lock timeout"></a>Set a lock timeout</h3><blockquote>
<p>It can be a good idea to set a lock_timeout within a session so that it will cancel the transaction and relinquish any locks it was holding after a certain period of time.<br>在会话中设置一个锁定超时可能是个好主意，这样在一段时间后它会取消事务并释放任何它持有的锁。</p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">SYSTEM</span> <span class="keyword">SET</span> lock_timeout <span class="operator">=</span> <span class="string">&#x27;10s&#x27;</span>;</span><br></pre></td></tr></table></figure>

<h2 id="Logging"><a href="#Logging" class="headerlink" title="Logging"></a>Logging</h2><h3 id="设置log-min-duration-statement来记录慢查询。"><a href="#设置log-min-duration-statement来记录慢查询。" class="headerlink" title="设置log_min_duration_statement来记录慢查询。"></a>设置log_min_duration_statement来记录慢查询。</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> database postgres <span class="keyword">SET</span> log_min_duration_statement <span class="operator">=</span> <span class="string">&#x27;250ms&#x27;</span>;</span><br></pre></td></tr></table></figure>

<h3 id="控制记录哪些类型的语句"><a href="#控制记录哪些类型的语句" class="headerlink" title="控制记录哪些类型的语句"></a>控制记录哪些类型的语句</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> DATABASE postgres <span class="keyword">SET</span> log_statement <span class="operator">=</span> <span class="string">&#x27;all&#x27;</span>;</span><br></pre></td></tr></table></figure>

<h3 id="等待锁时记录"><a href="#等待锁时记录" class="headerlink" title="等待锁时记录"></a>等待锁时记录</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> DATABASE postgres <span class="keyword">SET</span> log_lock_waits <span class="operator">=</span> <span class="string">&#x27;on&#x27;</span>;</span><br></pre></td></tr></table></figure>

<h2 id="PERFORMANCE"><a href="#PERFORMANCE" class="headerlink" title="PERFORMANCE"></a>PERFORMANCE</h2><h3 id="使用语句超时来控制运行超时的查询。"><a href="#使用语句超时来控制运行超时的查询。" class="headerlink" title="使用语句超时来控制运行超时的查询。"></a>使用语句超时来控制运行超时的查询。</h3><blockquote>
<p>Setting a statement timeout prevents queries from running longer than the specified time. You can set a statement timeout on the database, user, or session level. We recommend you set a global timeout on Postgres and then override that one specific users or sessions that need a longer allowed time to run.<br>设置语句超时时间可以防止查询运行时间超过指定的时间。您可以在数据库、用户或会话级别上设置语句超时时间。我们建议您在Postgres上设置一个全局超时时间，然后针对需要更长运行时间的特定用户或会话进行覆盖设置。</p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> DATABASE mydatabase <span class="keyword">SET</span> statement_timeout <span class="operator">=</span> <span class="string">&#x27;60s&#x27;</span>;</span><br></pre></td></tr></table></figure>

<h3 id="使用pg-stat-statements-需要安装-来查找使用最多资源的查询和进程。"><a href="#使用pg-stat-statements-需要安装-来查找使用最多资源的查询和进程。" class="headerlink" title="使用pg_stat_statements[需要安装]来查找使用最多资源的查询和进程。"></a>使用pg_stat_statements[需要安装]来查找使用最多资源的查询和进程。</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 安装pg_stat_statements</span></span><br><span class="line"><span class="comment">-- Create the extension</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> EXTENSION pg_stat_statements;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- Change in config</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">system</span> <span class="keyword">set</span> shared_preload_libraries<span class="operator">=</span><span class="string">&#x27;pg_stat_statements&#x27;</span>;</span><br><span class="line">Restart</span><br><span class="line"></span><br><span class="line"><span class="comment">-- systemctl restart postgresql</span></span><br><span class="line"><span class="comment">-- Verify changes applied or not.</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> pg_file_Settings <span class="keyword">where</span> name<span class="operator">=</span><span class="string">&#x27;shared_preload_libraries&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">	total_exec_time,</span><br><span class="line">	mean_exec_time <span class="keyword">as</span> avg_ms,</span><br><span class="line">	calls,</span><br><span class="line">	query</span><br><span class="line"><span class="keyword">FROM</span> pg_stat_statements</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> mean_exec_time <span class="keyword">DESC</span></span><br><span class="line">LIMIT <span class="number">10</span>;</span><br></pre></td></tr></table></figure>

<h3 id="监视Postgres中的连接"><a href="#监视Postgres中的连接" class="headerlink" title="监视Postgres中的连接"></a>监视Postgres中的连接</h3><blockquote>
<p>This query will provide the number of connection based on type.<br>此查询将根据类型提供连接数量。</p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="built_in">count</span>(<span class="operator">*</span>),</span><br><span class="line">	   state</span><br><span class="line"><span class="keyword">FROM</span> pg_stat_activity</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> state;</span><br></pre></td></tr></table></figure>

<h3 id="查询特定表的大小"><a href="#查询特定表的大小" class="headerlink" title="查询特定表的大小"></a>查询特定表的大小</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> pg_relation_size(<span class="string">&#x27;table_name&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- For prettier formatting you can wrap with:</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> pg_size_pretty(pg_relation_size(<span class="string">&#x27;table_name&#x27;</span>));</span><br></pre></td></tr></table></figure>

<h3 id="查询所有表的大小"><a href="#查询所有表的大小" class="headerlink" title="查询所有表的大小"></a>查询所有表的大小</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> relname <span class="keyword">AS</span> relation,</span><br><span class="line">       pg_size_pretty (</span><br><span class="line">         pg_total_relation_size (C .oid)</span><br><span class="line">       ) <span class="keyword">AS</span> total_size</span><br><span class="line"><span class="keyword">FROM</span> pg_class C</span><br><span class="line"><span class="keyword">LEFT</span> <span class="keyword">JOIN</span> pg_namespace N <span class="keyword">ON</span> (N.oid <span class="operator">=</span> C .relnamespace)</span><br><span class="line"><span class="keyword">WHERE</span> nspname <span class="keyword">NOT</span> <span class="keyword">IN</span> (</span><br><span class="line">        <span class="string">&#x27;pg_catalog&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;information_schema&#x27;</span></span><br><span class="line">      )</span><br><span class="line">  <span class="keyword">AND</span> C .relkind <span class="operator">&lt;&gt;</span> <span class="string">&#x27;i&#x27;</span></span><br><span class="line">  <span class="keyword">AND</span> nspname <span class="operator">!</span><span class="operator">~</span> <span class="string">&#x27;^pg_toast&#x27;</span></span><br><span class="line">  <span class="keyword">ORDER</span> <span class="keyword">BY</span> pg_total_relation_size (C .oid) <span class="keyword">DESC</span></span><br></pre></td></tr></table></figure>

<h3 id="检查未使用的索引。"><a href="#检查未使用的索引。" class="headerlink" title="检查未使用的索引。"></a>检查未使用的索引。</h3><blockquote>
<p>Will return the unused indexes in descending order of size. Keep in mind you want to also check replicas before dropping indexes.</p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> schemaname <span class="operator">||</span> <span class="string">&#x27;.&#x27;</span> <span class="operator">||</span> relname <span class="keyword">AS</span> <span class="keyword">table</span>,</span><br><span class="line">       indexrelname <span class="keyword">AS</span> index,</span><br><span class="line">       pg_size_pretty(pg_relation_size(i.indexrelid)) <span class="keyword">AS</span> &quot;index size&quot;,</span><br><span class="line">       idx_scan <span class="keyword">as</span> &quot;index scans&quot;</span><br><span class="line"><span class="keyword">FROM</span> pg_stat_user_indexes ui</span><br><span class="line"><span class="keyword">JOIN</span> pg_index i <span class="keyword">ON</span> ui.indexrelid <span class="operator">=</span> i.indexrelid</span><br><span class="line"><span class="keyword">WHERE</span> <span class="keyword">NOT</span> indisunique</span><br><span class="line">  <span class="keyword">AND</span> idx_scan <span class="operator">&lt;</span> <span class="number">50</span></span><br><span class="line">  <span class="keyword">AND</span> pg_relation_size(relid) <span class="operator">&gt;</span> <span class="number">5</span> <span class="operator">*</span> <span class="number">8192</span></span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> </span><br><span class="line">  pg_relation_size(i.indexrelid) <span class="operator">/</span> <span class="built_in">nullif</span>(idx_scan, <span class="number">0</span>) <span class="keyword">DESC</span> <span class="keyword">NULLS FIRST</span>,</span><br><span class="line">  pg_relation_size(i.indexrelid) <span class="keyword">DESC</span>;</span><br></pre></td></tr></table></figure>

<h3 id="获取表格的近似计数"><a href="#获取表格的近似计数" class="headerlink" title="获取表格的近似计数"></a>获取表格的近似计数</h3><blockquote>
<p>Will return the approximate count for a table based on PostgreSQL internal statistics. Useful for large tables where performing a <code>SELECT count(*)</code> is costly on performance.</p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> reltuples::<span class="type">numeric</span> <span class="keyword">as</span> count</span><br><span class="line"><span class="keyword">FROM</span> pg_class</span><br><span class="line"><span class="keyword">WHERE</span> relname<span class="operator">=</span><span class="string">&#x27;table_name&#x27;</span>;</span><br></pre></td></tr></table></figure>

<h3 id="Non-blocking-创建索引"><a href="#Non-blocking-创建索引" class="headerlink" title="Non-blocking 创建索引"></a>Non-blocking 创建索引</h3><blockquote>
<p>Adding <code>CONCURRENTLY</code> during index creation, while not permitted in a transaction, will not hold a lock on the table while creating your index.</p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> INDEX CONCURRENTLY foobar <span class="keyword">ON</span> foo (bar);</span><br></pre></td></tr></table></figure>

<h2 id="PSQL"><a href="#PSQL" class="headerlink" title="PSQL"></a>PSQL</h2><h3 id="在PSQL中自动记录查询时间"><a href="#在PSQL中自动记录查询时间" class="headerlink" title="在PSQL中自动记录查询时间"></a>在PSQL中自动记录查询时间</h3><blockquote>
<p>将自动打印出在psql中运行查询所花费的时间。<em>需要注意的是这是往返时间，而不仅仅是查询执行时间。</em></p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">\timing</span><br></pre></td></tr></table></figure>

<h3 id="在-psql-中自动格式化查询结果"><a href="#在-psql-中自动格式化查询结果" class="headerlink" title="在 psql 中自动格式化查询结果"></a>在 psql 中自动格式化查询结果</h3><blockquote>
<p>将根据您的终端窗口自动重新组织查询输出，以便更易读。</p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">\x auto</span><br></pre></td></tr></table></figure>

<h3 id="编辑您选择的编辑器中的psql查询"><a href="#编辑您选择的编辑器中的psql查询" class="headerlink" title="编辑您选择的编辑器中的psql查询"></a>编辑您选择的编辑器中的psql查询</h3><blockquote>
<p>将自动在您的默认 <code>$EDITOR</code> 中打开您上次运行的查询。当您保存并关闭时，将执行该查询。</p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">\e</span><br></pre></td></tr></table></figure>

<h3 id="为nulls设置一个值"><a href="#为nulls设置一个值" class="headerlink" title="为nulls设置一个值"></a>为nulls设置一个值</h3><blockquote>
<p>将null渲染为您指定的任何字符。对于更容易解析null和空文本非常方便。</p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">\pset <span class="keyword">null</span> 👻</span><br></pre></td></tr></table></figure>

<h3 id="将您的每个数据库的查询历史保存在本地"><a href="#将您的每个数据库的查询历史保存在本地" class="headerlink" title="将您的每个数据库的查询历史保存在本地"></a>将您的每个数据库的查询历史保存在本地</h3><blockquote>
<p>将为每个<strong>DBNAME</strong>自动保存一个历史文件。</p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">\<span class="keyword">set</span> HISTFILE <span class="operator">~</span><span class="operator">/</span>.psql_history<span class="operator">-</span> :DBNAME</span><br></pre></td></tr></table></figure>

<h3 id="显示由内部psql命令发出的查询"><a href="#显示由内部psql命令发出的查询" class="headerlink" title="显示由内部psql命令发出的查询"></a>显示由内部psql命令发出的查询</h3><blockquote>
<p>在命令行中为 psql 添加“-E”（或–echo-hidden）选项。此选项将显示内部 psql 命令生成的查询（例如“\dt mytable”）。这是了解系统目录的更酷的方法，或者可以重用由 psql 发出的查询在您自己的工具中。</p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">psql <span class="operator">-</span>E</span><br></pre></td></tr></table></figure>

<h3 id="获取数据，只需数据。"><a href="#获取数据，只需数据。" class="headerlink" title="获取数据，只需数据。"></a>获取数据，只需数据。</h3><blockquote>
<p>在命令行中向psql添加”-qtA”选项。这些选项将使psql以安静模式(“-q”)运行，仅返回元组(“-t”)以不对齐的方式(“-A”)。结合”-c”选项发送单个查询，如果您只想从Postgres获取数据，这对于您的脚本可能很有用。每行返回一行。</p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">psql <span class="operator">-</span>qtA</span><br></pre></td></tr></table></figure>

<h3 id="以HTML表格的形式获取结果"><a href="#以HTML表格的形式获取结果" class="headerlink" title="以HTML表格的形式获取结果"></a>以HTML表格的形式获取结果</h3><blockquote>
<p>在命令行中为psql添加”-qtH”选项。这些选项将使psql以安静模式运行（”-q”），仅返回元组（”-t”）以HTML表格形式（”-H”）。结合”-c”选项发送单个查询，可以快速将查询结果嵌入到HTML页面中。</p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">psql <span class="operator">-</span>qtH</span><br></pre></td></tr></table></figure>

<h3 id="搜索以前的查询使用-Ctrl-R"><a href="#搜索以前的查询使用-Ctrl-R" class="headerlink" title="搜索以前的查询使用 Ctrl + R"></a>搜索以前的查询使用 Ctrl + R</h3><blockquote>
<p>按下Ctrl + R将启动搜索会话，然后您可以开始键入查询或命令的一部分，以找到并再次运行它。如果您使用注释标记特定查询，这可以帮助稍后进行搜索。</p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(reverse<span class="operator">-</span>i<span class="operator">-</span><span class="keyword">search</span>)</span><br></pre></td></tr></table></figure>

<h3 id="清除plsql屏幕"><a href="#清除plsql屏幕" class="headerlink" title="清除plsql屏幕"></a>清除plsql屏幕</h3><blockquote>
<p>将清除当前 psql 会话中的屏幕</p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">\<span class="operator">!</span> clear</span><br></pre></td></tr></table></figure>

<h3 id="持续使用watch命令运行查询"><a href="#持续使用watch命令运行查询" class="headerlink" title="持续使用watch命令运行查询"></a>持续使用watch命令运行查询</h3><blockquote>
<p>每2秒将自动运行上次的查询并显示输出。您也可以在watch后指定要运行的查询。</p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">\watch</span><br></pre></td></tr></table></figure>

<h3 id="在交互模式下，当出现错误时回滚到上一个语句。"><a href="#在交互模式下，当出现错误时回滚到上一个语句。" class="headerlink" title="在交互模式下，当出现错误时回滚到上一个语句。"></a>在交互模式下，当出现错误时回滚到上一个语句。</h3><blockquote>
<p>当您在交互模式遇到错误时，系统会自动回滚到前一条命令之前的状态，使您可以像预期的那样继续工作。</p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">\<span class="keyword">set</span> ON_ERROR_ROLLBACK interactive</span><br></pre></td></tr></table></figure>

<h3 id="直接从psql导出CSV"><a href="#直接从psql导出CSV" class="headerlink" title="直接从psql导出CSV"></a>直接从psql导出CSV</h3><blockquote>
<p>当使用查询时提供<code>--csv</code>值，该命令将运行特定查询并将CSV返回到标准输出。</p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">psql <span class="operator">&lt;</span>connection<span class="operator">-</span>string<span class="operator">&gt;</span> <span class="comment">--csv -c &#x27;select * from test;&#x27;</span></span><br></pre></td></tr></table></figure>

<h3 id="在psql中运行来自文件的查询"><a href="#在psql中运行来自文件的查询" class="headerlink" title="在psql中运行来自文件的查询"></a>在psql中运行来自文件的查询</h3><blockquote>
<p>在 psql 中执行指定的文件。</p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">\i filename</span><br></pre></td></tr></table></figure>

<h3 id="在-psql-中提供清晰的边框"><a href="#在-psql-中提供清晰的边框" class="headerlink" title="在 psql 中提供清晰的边框"></a>在 psql 中提供清晰的边框</h3><blockquote>
<p>在psql中，当你查询结果输出时，会给结果加上边框。</p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">\pset border <span class="number">2</span></span><br></pre></td></tr></table></figure>

<h2 id="Refer"><a href="#Refer" class="headerlink" title="Refer"></a>Refer</h2><p><a target="_blank" rel="noopener" href="https://www.crunchydata.com/postgres-tips">https://www.crunchydata.com/postgres-tips</a></p>

                    
                        


                    
                    
                        <p>
                            <a
                                href="/2024/03/04/Postgres%E6%8A%80%E5%B7%A7/#post-footer"
                                class="postShorten-excerpt_link link"
                                aria-label=""
                            >
                                Comment and share
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title">
                    
                        <a
                            class="link-unstyled"
                            href="/2024/01/25/%E7%90%86%E8%A7%A3https/"
                            aria-label=": 理解https"
                        >
                            理解https
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time datetime="2024-01-25T17:05:17+00:00">
	
		    Jan 25, 2024
    	
    </time>
    
</div>

            </div>
            
                <div class="postShorten-content">
                    
                    
                        


                    
                    
                        <p>
                            <a
                                href="/2024/01/25/%E7%90%86%E8%A7%A3https/#post-footer"
                                class="postShorten-excerpt_link link"
                                aria-label=""
                            >
                                Comment and share
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title">
                    
                        <a
                            class="link-unstyled"
                            href="/2023/07/02/Java%E5%A4%9A%E7%89%88%E6%9C%AC%E7%AE%A1%E7%90%86%E5%B7%A5%E5%85%B7SDKMAN/"
                            aria-label=": Java多版本管理工具SDKMAN"
                        >
                            Java多版本管理工具SDKMAN
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time datetime="2023-07-02T00:05:06+00:00">
	
		    Jul 02, 2023
    	
    </time>
    
</div>

            </div>
            
                <div class="postShorten-content">
                    <blockquote>
<p>作为一名Javaer领到电脑的第一件事就是需要配置Java环境，以及切换不同的JDK版本来进行日常开发，Node开发有nvm，python开发有pyenv, Java也提供了响应的工具sdkman（Linux, Unix, MacOS）。同时sdkman也可以管理Scala、Gradle、Maven等等软件不同的版本。</p>
</blockquote>
<h2 id="安装-SDKMan-要开始使用-SDKMan，"><a href="#安装-SDKMan-要开始使用-SDKMan，" class="headerlink" title="安装 SDKMan 要开始使用 SDKMan，"></a>安装 SDKMan 要开始使用 SDKMan，</h2><p>首先需要在你的系统上安装它。SDKMan 支持 Windows、macOS 和 Linux 等操作系统。 </p>
<h3 id="在-macOS-和-Linux-上安装"><a href="#在-macOS-和-Linux-上安装" class="headerlink" title="在 macOS 和 Linux 上安装"></a>在 macOS 和 Linux 上安装</h3><p>在终端中执行以下命令来安装 SDKMan： </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">curl -s <span class="string">&quot;https://get.sdkman.io&quot;</span> | bash </span><br><span class="line"><span class="comment"># 或者 </span></span><br><span class="line">curl -s <span class="string">&quot;https://get.sdkman.io&quot;</span> | ZSH</span><br></pre></td></tr></table></figure>

<p>执行</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">source</span> <span class="string">&quot;<span class="variable">$HOME</span>/.sdkman/bin/sdkman-init.sh&quot;</span></span><br><span class="line">$ sdk version</span><br><span class="line"><span class="comment"># 如下，如果显示版本则代表成功</span></span><br><span class="line">  sdkman 5.18.2</span><br></pre></td></tr></table></figure>

<h3 id="在-Windows-上安装"><a href="#在-Windows-上安装" class="headerlink" title="在 Windows 上安装"></a>在 Windows 上安装</h3><p>在 Windows 上，你可以使用 Git Bash 或 Cygwin 等工具来安装和使用 SDKMan。首先，下载并安装 Git Bash 或 Cygwin，并确保它们在系统的 PATH 环境变量中。然后，在 Git Bash 或 Cygwin 终端中执行以下命令来安装 SDKMan：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -s <span class="string">&quot;https://get.sdkman.io&quot;</span> | bash</span><br></pre></td></tr></table></figure>

<h2 id="使用-SDKMan"><a href="#使用-SDKMan" class="headerlink" title="使用 SDKMan"></a>使用 SDKMan</h2><p>一旦你安装好了 SDKMan，就可以开始使用它来管理你的开发工具了。</p>
<h3 id="安装工具"><a href="#安装工具" class="headerlink" title="安装工具"></a>安装工具</h3><p>使用 SDKMan 安装一个开发工具非常简单。比如，要安装最新版本的 Java，只需要在终端中执行以下命令：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sdk lis java <span class="comment">#显示出java所有版本</span></span><br><span class="line">sdk install java 17.0.3-oracle</span><br></pre></td></tr></table></figure>

<h3 id="切换版本"><a href="#切换版本" class="headerlink" title="切换版本"></a>切换版本</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sdk use java 17.0.3-oracle</span><br></pre></td></tr></table></figure>

<h3 id="升级工具"><a href="#升级工具" class="headerlink" title="升级工具"></a>升级工具</h3><p>SDKMan 也提供了升级已安装工具的功能。要升级某个已安装的工具，只需要执行以下命令：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sdk upgrade &lt;tool&gt;</span><br></pre></td></tr></table></figure>

<p>其中 <code>&lt;tool&gt;</code> 是你想要升级的工具名称，比如 <code>java</code>、<code>scala</code>等。</p>
<h3 id="列出可用版本"><a href="#列出可用版本" class="headerlink" title="列出可用版本"></a>列出可用版本</h3><p>如果你想查看某个工具的所有可用版本，可以使用以下命令：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sdk list &lt;tool&gt;</span><br></pre></td></tr></table></figure>

<p>这将列出该工具所有可用的版本号供你选择。</p>
<h3 id="删除工具"><a href="#删除工具" class="headerlink" title="删除工具"></a>删除工具</h3><p>如果你想删除某个已安装的工具，可以使用以下命令：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sdk uninstall &lt;tool&gt; &lt;version&gt;</span><br></pre></td></tr></table></figure>

<p>其中 <code>&lt;tool&gt;</code> 是工具的名称，<code>&lt;version&gt;</code> 是要删除的版本号。</p>
<h2 id="结语"><a href="#结语" class="headerlink" title="结语"></a>结语</h2><p>SDKMan 是一个非常实用的开发工具管理工具，可以帮助开发人员轻松安装、升级和切换不同版本的开发工具。它简化了我们在不同项目中使用不同工具版本的过程，让开发变得更加便捷和高效。</p>
<p>如果你还没有尝试过 SDKMan，我强烈推荐你去官方网站（<a target="_blank" rel="noopener" href="https://sdkman.io/%EF%BC%89%E4%BA%86%E8%A7%A3%E6%9B%B4%E5%A4%9A%E4%BF%A1%E6%81%AF%EF%BC%8C%E5%B9%B6%E5%9C%A8%E4%BD%A0%E7%9A%84%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83%E4%B8%AD%E5%AE%89%E8%A3%85%E5%92%8C%E4%BD%BF%E7%94%A8%E5%AE%83%E3%80%82%E7%9B%B8%E4%BF%A1%E5%AE%83%E4%BC%9A%E6%88%90%E4%B8%BA%E4%BD%A0%E7%9A%84%E5%A5%BD%E5%B8%AE%E6%89%8B%EF%BC%81">https://sdkman.io/）了解更多信息，并在你的开发环境中安装和使用它。相信它会成为你的好帮手！</a></p>
<p>ChatGpt真强大这篇文章是它写的。</p>

                    
                        


                    
                    
                        <p>
                            <a
                                href="/2023/07/02/Java%E5%A4%9A%E7%89%88%E6%9C%AC%E7%AE%A1%E7%90%86%E5%B7%A5%E5%85%B7SDKMAN/#post-footer"
                                class="postShorten-excerpt_link link"
                                aria-label=""
                            >
                                Comment and share
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    <div class="pagination-bar">
    <ul class="pagination">
        
        
          <li class="pagination-next">
            <a
                class="btn btn--default btn--small"
                href="/archives/page/2/"
                aria-label="OLDER POSTS"
            >
              <span>OLDER POSTS</span>
              <i class="fa fa-angle-right text-base icon-ml"></i>
            </a>
          </li>
        
        <li class="pagination-number">page 1 of 5</li>
    </ul>
</div>

</section>



                <footer id="footer" class="main-content-wrap">
    <span class="copyrights">
        Copyrights &copy; 2025 Topsion. All Rights Reserved.
    </span>
</footer>

            </div>
            
        </div>
        


    
        
    

<div id="about">
    <div id="about-card">
        <div id="about-btn-close">
            <i class="fa fa-times"></i>
        </div>
        
            <img id="about-card-picture" src="/assets/images/avatar.jpg" alt="Author&#39;s picture"/>
        
            <h4 id="about-card-name">Topsion</h4>
        
            <div id="about-card-bio"><p>Fullstack Developer</p>
</div>
        
        
            <div id="about-card-job">
                <i class="fa fa-briefcase"></i>
                <br/>
                <p>Coder</p>

            </div>
        
        
            <div id="about-card-location">
                <i class="fa fa-map-marker-alt"></i>
                <br/>
                Xi&#39;an China
            </div>
        
    </div>
</div>

        
        
<div id="cover" style="background-image:url('/assets/images/cover.jpg');"></div>
        <!--SCRIPTS-->

<script src="/assets/js/script-q2wtdh1f7oaxzdmuuvsc1uyl8fnwcg5dz7kgztdayssvj6qd6o7u5zwralwk.min.js"></script>

<!--SCRIPTS END-->





    </body>
</html>
