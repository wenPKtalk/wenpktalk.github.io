
<!DOCTYPE html>
<html lang="en">
    
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="Summary">
    <title>Category: Architecture - Summary</title>
    <meta name="author" content="Topsion">
    
    
    
    <script type="application/ld+json">{}</script>
    <meta name="description" content="The whole problem with the world is that fools and fanatics are always so certain of themselves, and wiser people so full of doubts.(这个世界的问题在于聪明人充满疑惑而傻子却坚信不疑)">
<meta property="og:type" content="blog">
<meta property="og:title" content="Summary">
<meta property="og:url" content="http://example.com/categories/Architecture/index.html">
<meta property="og:site_name" content="Summary">
<meta property="og:description" content="The whole problem with the world is that fools and fanatics are always so certain of themselves, and wiser people so full of doubts.(这个世界的问题在于聪明人充满疑惑而傻子却坚信不疑)">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="Topsion">
<meta name="twitter:card" content="summary">
    
    
        
    
    
        <meta property="og:image" content="http://example.com/assets/images/avatar.jpg"/>
    
    
    
    
    <!--STYLES-->
    
<link rel="stylesheet" href="/assets/css/style-yaeygdlgk8x4rqd5mp0jrkosoe3fmfokggmiu05rmpel4wjoxmvp5s6gestz.min.css">

    <!--STYLES END-->
    

    

    
</head>

    <body>
        <div id="blog">
            <!-- Define author's picture -->


    
        
            
        
    

<header id="header" data-behavior="1">
    <i id="btn-open-sidebar" class="fa fa-lg fa-bars"></i>
    <div class="header-title">
        <a
            class="header-title-link"
            href="/"
            aria-label=""
        >
            Summary
        </a>
    </div>
    
        
            <a
                class="header-right-picture "
                href="#about"
                aria-label="Open the link: /#about"
            >
        
        
            <img class="header-picture" src="/assets/images/avatar.jpg" alt="Author&#39;s picture"/>
        
        </a>
    
</header>

            <!-- Define author's picture -->



        
    

<nav id="sidebar" data-behavior="1">
    <div class="sidebar-container">
        
            <div class="sidebar-profile">
                <a
                    href="/#about"
                    aria-label="Read more about the author"
                >
                    <img class="sidebar-profile-picture" src="/assets/images/avatar.jpg" alt="Author&#39;s picture"/>
                </a>
                <h4 class="sidebar-profile-name">Topsion</h4>
                
                    <h5 class="sidebar-profile-bio"><p>Fullstack Developer</p>
</h5>
                
            </div>
        
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/"
                            
                            rel="noopener"
                            title="Home"
                        >
                        <i class="sidebar-button-icon fa fa-home" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Home</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/all-categories"
                            
                            rel="noopener"
                            title="Categories"
                        >
                        <i class="sidebar-button-icon fa fa-bookmark" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Categories</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/all-tags"
                            
                            rel="noopener"
                            title="Tags"
                        >
                        <i class="sidebar-button-icon fa fa-tags" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Tags</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/all-archives"
                            
                            rel="noopener"
                            title="Archives"
                        >
                        <i class="sidebar-button-icon fa fa-archive" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Archives</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link open-algolia-search"
                            href="#search"
                            
                            rel="noopener"
                            title="Search"
                        >
                        <i class="sidebar-button-icon fa fa-search" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Search</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="#about"
                            
                            rel="noopener"
                            title="About"
                        >
                        <i class="sidebar-button-icon fa fa-question" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">About</span>
                    </a>
            </li>
            
        </ul>
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="https://github.com/wenPKtalk"
                            
                                target="_blank"
                            
                            rel="noopener"
                            title="GitHub"
                        >
                        <i class="sidebar-button-icon fab fa-github" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">GitHub</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="https://stackoverflow.com/users/15967860/topsion"
                            
                                target="_blank"
                            
                            rel="noopener"
                            title="Stack Overflow"
                        >
                        <i class="sidebar-button-icon fab fa-stack-overflow" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Stack Overflow</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="https://www.linkedin.com/feed/"
                            
                                target="_blank"
                            
                            rel="noopener"
                            title="LinkedIn"
                        >
                        <i class="sidebar-button-icon fab fa-linkedin" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">LinkedIn</span>
                    </a>
            </li>
            
        </ul>
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/atom.xml"
                            
                            rel="noopener"
                            title="RSS"
                        >
                        <i class="sidebar-button-icon fa fa-rss" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">RSS</span>
                    </a>
            </li>
            
        </ul>
        
    </div>
</nav>

            
            <div id="main" data-behavior="1"
                 class="
                        hasCoverMetaIn
                        ">
                
    <section class="postShorten-group main-content-wrap">
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title">
                    
                        <a
                            class="link-unstyled"
                            href="/2025/08/25/%E6%9E%B6%E6%9E%84%E9%80%89%E6%8B%A9%E5%8D%95%E4%BD%93%E8%BF%98%E6%98%AF%E5%BE%AE%E6%9C%8D%E5%8A%A1/"
                            aria-label=": 架构选择单体还是微服务"
                        >
                            架构选择单体还是微服务
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time datetime="2025-08-25T23:20:28+00:00">
	
		    Aug 25, 2025
    	
    </time>
    
        <span>in </span>
        
    <a class="category-link" href="/categories/Architecture/">Architecture</a>


    
</div>

            </div>
            
                <div class="postShorten-content">
                    <blockquote>
<p>Java Microservices is one of the hottest skills in the current job market.</p>
</blockquote>
<h2 id="What-issues-need-to-be-considered-when-choosing-the-right-architecture-style"><a href="#What-issues-need-to-be-considered-when-choosing-the-right-architecture-style" class="headerlink" title="What issues need to be considered when choosing the right architecture style?"></a>What issues need to be considered when choosing the right architecture style?</h2><ol>
<li>Monolith vs Microservices differences and when to choose which.</li>
<li>How to design a microservice from scratch.</li>
<li>API Gateway pattern and its advantages.</li>
<li>Inter-service communication: REST vs Messaging.</li>
<li>Circuit Breaker pattern and its implementation using Reslience4j.</li>
<li>Load balancing in microservices using Spring Cloud Load Balancer.</li>
<li>How Spring Cloud Config helps in centralized configuration management.</li>
<li>Service discovery using Eureka or Consul.</li>
<li>Feign Client vs WebClient: Which one to use and why.</li>
<li>Event-driven architecture and kafka integration.</li>
<li>Database per service vs Shared Database: Pros and cons.</li>
<li>Saga Pattern for distributed transactions in microservices.</li>
<li>JWT-based authentication and OAuth2 in microservices.</li>
<li>How to handle security in an API Gateway.</li>
<li>Observability: Logging, tracing, and monitoring best practices.</li>
<li>Role of Prometheus and Grafana in microservices monitoring.</li>
<li>Kubernetes deployment strategies for microservices.</li>
<li>When to use WebFlux for reactive microservices.</li>
<li>CQRS and Event Sourcing: When and why to use them.</li>
<li>Infrastructure: CI/CD for microsercies.</li>
</ol>

                    
                        


                    
                    
                        <p>
                            <a
                                href="/2025/08/25/%E6%9E%B6%E6%9E%84%E9%80%89%E6%8B%A9%E5%8D%95%E4%BD%93%E8%BF%98%E6%98%AF%E5%BE%AE%E6%9C%8D%E5%8A%A1/#post-footer"
                                class="postShorten-excerpt_link link"
                                aria-label=""
                            >
                                Comment and share
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title">
                    
                        <a
                            class="link-unstyled"
                            href="/2023/06/27/%E7%95%AA%E8%8C%84%E6%9E%B6%E6%9E%84-Tomato-Architecture/"
                            aria-label=": 番茄架构-Tomato Architecture"
                        >
                            番茄架构-Tomato Architecture
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time datetime="2023-06-27T23:07:42+00:00">
	
		    Jun 27, 2023
    	
    </time>
    
        <span>in </span>
        
    <a class="category-link" href="/categories/Architecture/">Architecture</a>


    
</div>

            </div>
            
                <div class="postShorten-content">
                    <blockquote>
<p><strong>番茄架构</strong>是遵循<strong>Common Sense Manifesto</strong>的软件架构的一种方法</p>
</blockquote>
<h3 id="Common-Sense-Manifesto"><a href="#Common-Sense-Manifesto" class="headerlink" title="Common Sense Manifesto"></a>Common Sense Manifesto</h3><ul>
<li>选择适合你的软件的架构而不是流行的的架构： 在盲目追随流行人物的建议之前，要考虑软件最佳实践。</li>
<li>不要过度设计： 努力保持简单，而不是过度工程化，试图猜测未来十年的需求。</li>
<li>进行研究与开发，选择一项技术并拥抱它，而不是为了可替代性而创建抽象层。</li>
<li>确保你的解决方案作为整体工作正常，而不仅仅是单个组件。</li>
</ul>
<h3 id="架构图"><a href="#架构图" class="headerlink" title="架构图"></a>架构图</h3><p><img src="https://cdn.jsdelivr.net/gh/wenPKtalk/pictures@master/blog/20230628/17_58/tomato-architecture.png" alt="tomato-architecture.png"></p>
<h3 id="实施指南（架构核心：关注点分离）："><a href="#实施指南（架构核心：关注点分离）：" class="headerlink" title="实施指南（架构核心：关注点分离）："></a>实施指南（架构核心：关注点分离）：</h3><ol>
<li><h3 id="按功能进行打包"><a href="#按功能进行打包" class="headerlink" title="按功能进行打包"></a>按功能进行打包</h3>将代码按照功能分成不同的包是一种常见的模式，通常会根据技术层次（如 controllers, services, repositories等）进行划分。如果你正在构建一个专注于特定模块或业务能力的微服务，那么这种方法可能是可行的。</li>
</ol>
<p>  如果你正在构建一个单体应用或者模块化单体应用，强烈建议首先按照功能而非技术层进行划分。</p>
<p>  详细信息请阅读链接: <a target="_blank" rel="noopener" href="https://phauer.com/2020/package-by-feature/">https://phauer.com/2020/package-by-feature/</a></p>
<ol start="2">
<li><h3 id="“应用核心”独立于交付机制（Web-Scheduler-Jobs-CLI）"><a href="#“应用核心”独立于交付机制（Web-Scheduler-Jobs-CLI）" class="headerlink" title="“应用核心”独立于交付机制（Web, Scheduler Jobs, CLI）"></a>“应用核心”独立于交付机制（Web, Scheduler Jobs, CLI）</h3><p>应用核心应该公开可以从主方法调用的API。为了实现这一点，“应用核心”不应该依赖于其调用上下文。这意味着“应用核心”不应依赖于任何HTTP/Web层的库。同样，如果你的应用核心被用于定时任务或命令行接口，任何调度逻辑或命令行执行逻辑都不应泄露到应用核心中。</p>
</li>
<li><h3 id="将业务逻辑执行与输入源（Web-Controllers-Message-Listeners-Scheduled-Jobs等）分离"><a href="#将业务逻辑执行与输入源（Web-Controllers-Message-Listeners-Scheduled-Jobs等）分离" class="headerlink" title="将业务逻辑执行与输入源（Web Controllers, Message Listeners, Scheduled Jobs等）分离"></a>将业务逻辑执行与输入源（Web Controllers, Message Listeners, Scheduled Jobs等）分离</h3><p>输入源，如Web Controllers, Message Listeners, Scheduled Jobs等，应该是很薄的一层，在提取请求数据后将实际的业务逻辑执行委托给“应用核心”。</p>
</li>
</ol>
<p>比如：</p>
<p><strong>坏味道：</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CustomerController</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> CustomerService customerService;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@PostMapping(&quot;/api/customers&quot;)</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">createCustomer</span><span class="params">(<span class="meta">@RequestBody</span> Customer customer)</span> &#123;</span><br><span class="line">       <span class="keyword">if</span>(customerService.existsByEmail(customer.getEmail())) &#123;</span><br><span class="line">           <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">EmailAlreadyInUseException</span>(customer.getEmail());</span><br><span class="line">       &#125;</span><br><span class="line">       customer.setCreateAt(Instant.now());</span><br><span class="line">       customerService.save(customer);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>纠正：</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CustomerController</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> CustomerService customerService;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@PostMapping(&quot;/api/customers&quot;)</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">createCustomer</span><span class="params">(<span class="meta">@RequestBody</span> Customer customer)</span> &#123;</span><br><span class="line">       customerService.save(customer);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CustomerService</span> &#123;</span><br><span class="line">   <span class="keyword">private</span> <span class="keyword">final</span> CustomerRepository customerRepository;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">void</span> <span class="title function_">save</span><span class="params">(Customer customer)</span> &#123;</span><br><span class="line">      <span class="keyword">if</span>(customerRepository.existsByEmail(customer.getEmail())) &#123;</span><br><span class="line">         <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">EmailAlreadyInUseException</span>(customer.getEmail());</span><br><span class="line">      &#125;</span><br><span class="line">      customer.setCreateAt(Instant.now());</span><br><span class="line">      customerRepository.save(customer);</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>采用这种方法，无论你是通过REST API调用还是通过CLI创建一个客户，所有的业务逻辑都会集中在应用核心中。</p>
<p><strong>坏味道：</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">OrderProcessingJob</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> OrderService orderService;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Scheduled(cron=&quot;0 * * * * *&quot;)</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">       List&lt;Order&gt; orders = orderService.findPendingOrders();</span><br><span class="line">       <span class="keyword">for</span>(Order order : orders) &#123;</span><br><span class="line">           <span class="built_in">this</span>.processOrder(order);</span><br><span class="line">       &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">processOrder</span><span class="params">(Order order)</span> &#123;</span><br><span class="line">       ...</span><br><span class="line">       ...</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>纠正：</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">OrderProcessingJob</span> &#123;</span><br><span class="line">   <span class="keyword">private</span> <span class="keyword">final</span> OrderService orderService;</span><br><span class="line"></span><br><span class="line">   <span class="meta">@Scheduled(cron=&quot;0 * * * * *&quot;)</span></span><br><span class="line">   <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">      List&lt;Order&gt; orders = orderService.findPendingOrders();</span><br><span class="line">      orderService.processOrders(orders);</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">OrderService</span> &#123;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">processOrders</span><span class="params">(List&lt;Order&gt; orders)</span> &#123;</span><br><span class="line">       ...</span><br><span class="line">       ...</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>采用这种方法，你可以将订单处理逻辑与调度程序解耦，可以在没有通过调度程序触发的情况下独立进行测试。</p>
<ol start="4">
<li><h3 id="不要让“外部服务集成”对“应用核心”产生太大影响"><a href="#不要让“外部服务集成”对“应用核心”产生太大影响" class="headerlink" title="不要让“外部服务集成”对“应用核心”产生太大影响"></a>不要让“外部服务集成”对“应用核心”产生太大影响</h3><p>从应用核心，我们可能需要与数据库、消息代理或第三方Web服务等进行通信。必须注意的是，业务逻辑执行器不应过度依赖于外部服务集成。</p>
<p>例如，假设你正在使用Spring Data JPA进行持久化，而你想从CustomerService中使用分页获取客户。</p>
<p><strong>坏味道：</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CustomerService</span> &#123;</span><br><span class="line">   <span class="keyword">private</span> <span class="keyword">final</span> CustomerRepository customerRepository;</span><br><span class="line"></span><br><span class="line">   PagedResult&lt;Customer&gt; <span class="title function_">getCustomers</span><span class="params">(Integer pageNo)</span> &#123;</span><br><span class="line">      <span class="type">Pageable</span> <span class="variable">pageable</span> <span class="operator">=</span> PageRequest.of(pageNo, PAGE_SIZE, Sort.of(<span class="string">&quot;name&quot;</span>));</span><br><span class="line">      Page&lt;Customer&gt; cusomersPage = customerRepository.findAll(pageable);</span><br><span class="line">      <span class="keyword">return</span> convertToPagedResult(cusomersPage);</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>纠正：</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CustomerService</span> &#123;</span><br><span class="line">   <span class="keyword">private</span> <span class="keyword">final</span> CustomerRepository customerRepository;</span><br><span class="line"></span><br><span class="line">   PagedResult&lt;Customer&gt; <span class="title function_">getCustomers</span><span class="params">(Integer pageNo)</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> customerRepository.findAll(pageNo);</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Repository</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">JpaCustomerRepository</span> &#123;</span><br><span class="line"></span><br><span class="line">   PagedResult&lt;Customer&gt; <span class="title function_">findAll</span><span class="params">(Integer pageNo)</span> &#123;</span><br><span class="line">      <span class="type">Pageable</span> <span class="variable">pageable</span> <span class="operator">=</span> PageRequest.of(pageNo, PAGE_SIZE, Sort.of(<span class="string">&quot;name&quot;</span>));</span><br><span class="line">      <span class="keyword">return</span> ...;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这种方式下，任何持久化库的修改都只会影响到持久化层。</p>
</li>
<li><h3 id="将领域（domain）逻辑处理放在领域对象中"><a href="#将领域（domain）逻辑处理放在领域对象中" class="headerlink" title="将领域（domain）逻辑处理放在领域对象中"></a>将领域（domain）逻辑处理放在领域对象中</h3><p>如果一个方法仅仅影响领域对象中的状态或者是根据领域对象状态计算某些内容的方法，则该方法应该是属于领域对象。</p>
<p><strong>坏味道：</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Cart</span> &#123;</span><br><span class="line">    List&lt;LineItem&gt; items;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CartService</span> &#123;</span><br><span class="line"></span><br><span class="line">   CartDTO <span class="title function_">getCart</span><span class="params">(UUID cartId)</span> &#123;</span><br><span class="line">      <span class="type">Cart</span> <span class="variable">cart</span> <span class="operator">=</span> cartRepository.getCart(cartId);</span><br><span class="line">      <span class="type">BigDecimal</span> <span class="variable">cartTotal</span> <span class="operator">=</span> <span class="built_in">this</span>.calculateCartTotal(cart);</span><br><span class="line">      ...</span><br><span class="line">   &#125;</span><br><span class="line">   </span><br><span class="line">   <span class="keyword">private</span> BigDecimal <span class="title function_">calculateCartTotal</span><span class="params">(Cart cart)</span> &#123;</span><br><span class="line">      ...</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>纠正：</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Cart</span> &#123;</span><br><span class="line">    List&lt;LineItem&gt; items;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">public</span> BigDecimal <span class="title function_">getTotal</span><span class="params">()</span> &#123;</span><br><span class="line">      ...</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CartService</span> &#123;</span><br><span class="line"></span><br><span class="line">   CartDTO <span class="title function_">getCart</span><span class="params">(UUID cartId)</span> &#123;</span><br><span class="line">      <span class="type">Cart</span> <span class="variable">cart</span> <span class="operator">=</span> cartRepository.getCart(cartId);</span><br><span class="line">      <span class="type">BigDecimal</span> <span class="variable">cartTotal</span> <span class="operator">=</span> cart.getTotal();</span><br><span class="line">      ...</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><h3 id="不要创建没有必要的接口"><a href="#不要创建没有必要的接口" class="headerlink" title="不要创建没有必要的接口"></a>不要创建没有必要的接口</h3><p>不要创建接口并希望有一天我们可以为此接口添加另一个实现。如果那一天真的到来，那么利用我们现在拥有的强大的 IDE，只需敲击几下键盘即可提取界面。如果创建接口的原因是为了使用 Mock 实现进行测试，我们有像 Mockito 这样的模拟库，它能够在不实现接口的情况下模拟类。</p>
<p>因此，除非有充分的理由，否则不要创建接口。</p>
</li>
<li><h3 id="拥抱框架强大的功能和灵活性"><a href="#拥抱框架强大的功能和灵活性" class="headerlink" title="拥抱框架强大的功能和灵活性"></a>拥抱框架强大的功能和灵活性</h3><p>通常，创建库和框架是为了满足大多数应用程序所需的常见要求。因此，您应该选择一个库/框架来更快地构建应用程序时。</p>
<p>与其利用所选框架提供的功能和灵活性，不如在所选框架之上创建间接或抽象，并希望有一天您可以将框架切换到其他框架，这通常是一个非常糟糕的主意。</p>
<p>例如，Spring框架为处理数据库事务、缓存、方法级安全性等提供了声明性支持。引入我们自己的类似注释并通过将实际处理委托给框架来重新实现相同的功能支持是不必要的。</p>
<p>相反，最好直接使用框架的注释，或者根据需要使用附加语义来组合注释。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Target(ElementType.TYPE)</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="meta">@Documented</span></span><br><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> UseCase &#123;</span><br><span class="line">   <span class="meta">@AliasFor(</span></span><br><span class="line"><span class="meta">        annotation = Transactional.class</span></span><br><span class="line"><span class="meta">   )</span></span><br><span class="line">   Propagation <span class="title function_">propagation</span><span class="params">()</span> <span class="keyword">default</span> Propagation.REQUIRED;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><h3 id="不仅单元测试，也需要集成测试。"><a href="#不仅单元测试，也需要集成测试。" class="headerlink" title="不仅单元测试，也需要集成测试。"></a>不仅单元测试，也需要集成测试。</h3><p>我们绝对应该编写单元测试来测试单元（业务逻辑），如果需要，可以通过模拟外部依赖项。但更重要的是验证整个功能是否正常工作。</p>
<p>即使我们的单元测试以毫秒为单位运行，我们是否可以放心地投入生产？当然不是。我们应该通过测试实际的外部依赖项（例如数据库或消息代理）来验证整个功能是否正常工作。这让我们更有信心。</p>
<p>我想知道“我们应该拥有完全独立于外部依赖项的核心域”哲学的整个想法来自于使用真实依赖项进行测试非常具有挑战性或根本不可能的时代。</p>
<p>幸运的是，我们现在拥有更好的技术（例如：<a target="_blank" rel="noopener" href="https://testcontainers.com/">testcontainer</a> 运行测试时动态启动依赖的中间件容器技术）来测试真正的依赖关系。使用真正的依赖项进行测试可能会花费稍多的时间，但与好处相比，这是一个可以忽略不计的成本。</p>
</li>
</ol>
<p>学习于原文：<a target="_blank" rel="noopener" href="https://github.com/wenPKtalk/tomato-architecture">https://github.com/wenPKtalk/tomato-architecture</a></p>

                    
                        


                    
                    
                        <p>
                            <a
                                href="/2023/06/27/%E7%95%AA%E8%8C%84%E6%9E%B6%E6%9E%84-Tomato-Architecture/#post-footer"
                                class="postShorten-excerpt_link link"
                                aria-label=""
                            >
                                Comment and share
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title">
                    
                        <a
                            class="link-unstyled"
                            href="/2022/04/11/DDD-%E5%88%9D%E6%8E%A2%E4%B9%8B%E7%9B%B8%E5%85%B3%E6%A6%82%E5%BF%B5/"
                            aria-label=": DDD 初探之相关概念"
                        >
                            DDD 初探之相关概念
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time datetime="2022-04-11T17:59:10+00:00">
	
		    Apr 11, 2022
    	
    </time>
    
        <span>in </span>
        
    <a class="category-link" href="/categories/Architecture/">Architecture</a>


    
</div>

            </div>
            
                <div class="postShorten-content">
                    <h3 id="DDD是什么"><a href="#DDD是什么" class="headerlink" title="DDD是什么"></a>DDD是什么</h3><ol>
<li>DDD并不是一种技术架构，而是一种划分业务领域范围的方法论。</li>
<li>DDD不是一种架构，<strong>而是一种架构方法论</strong>，目的就是将复杂问题领域简单化，帮助我们设计出清晰的领域和边界，可以很好的实现技术架构的演进。</li>
</ol>
<p><strong>DDD 包括战略设计和战术设计两部分。</strong></p>
<ol>
<li><strong>DDD战略部分</strong>：<strong>战略设计主要从业务视角出发</strong>，建立业务领域模型，划分领域边界，建立通用语言的限界上下文，限界上下文可以作为微服务设计的参考边界。</li>
<li><strong>DDD战术部分</strong>：<strong>战术设计则从技术视角出发</strong>，侧重于领域模型的技术实现，完成软件开发和落地，包括：聚合根、实体、值对象、领域服务、应用服务和资源库等代码逻辑的设计和实现。</li>
</ol>
<h3 id="DDD与微服务"><a href="#DDD与微服务" class="headerlink" title="DDD与微服务"></a>DDD与微服务</h3><p><strong>DDD 是一种架构设计方法，微服务是一种架构风格</strong>，两者从本质上都是为了追求高响应力，而从 <strong>业务视角</strong> 去分离应用系统建设复杂度的手段。两者都强调从业务出发，其核心要义是强调根据业务发展，合理划分领域边界，持续调整现有架构，优化现有代码，以保持架构和代码的生命力，也就是我们常说的演进式架构。</p>
<ul>
<li>DDD 主要关注：从业务领域视角划分领域边界，构建通用语言进行高效沟通，通过业务抽象，建立领域模型，维持业务和代码的逻辑一致性。</li>
<li>微服务主要关注：运行时的进程间通信、容错和故障隔离，实现去中心化数据管理和去中心化服务治理，关注微服务的独立开发、测试、构建和部署。</li>
</ul>
<h3 id="实践步骤："><a href="#实践步骤：" class="headerlink" title="实践步骤："></a>实践步骤：</h3><p>第一步：在事件风暴中梳理业务过程中的用户操作、事件以及外部依赖关系等，根据这些要素梳理出领域实体等领域对象。</p>
<p>第二步：根据领域实体之间的业务关联性，将业务紧密相关的实体进行组合形成聚合，同时确定聚合中的聚合根、值对象和实体。在这个图里，聚合之间的边界是第一层边界，它们在同一个微服务实例中运行，这个边界是逻辑边界，所以用虚线表示。</p>
<p>第三步：根据业务及语义边界等因素，将一个或者多个聚合划定在一个限界上下文内，形成领域模型。在这个图里，限界上下文之间的边界是第二层边界，这一层边界可能就是未来微服务的边界，不同限界上下文内的领域逻辑被隔离在不同的微服务实例中运行，物理上相互隔离，所以是物理边界，边界之间用实线来表示。</p>
<p><img src="https://cdn.jsdelivr.net/gh/wenPKtalk/pictures@master/blog/20220411/18_31/image-20220411183114240.png" alt="image-20220411183114240"></p>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>DDD可以理解为：ddd 是一个事件风暴 （分类划分），进而知道组织划分（也就是中台）、系统划分（微服务）、代码划分/设计的思想方法</p>

                    
                        


                    
                    
                        <p>
                            <a
                                href="/2022/04/11/DDD-%E5%88%9D%E6%8E%A2%E4%B9%8B%E7%9B%B8%E5%85%B3%E6%A6%82%E5%BF%B5/#post-footer"
                                class="postShorten-excerpt_link link"
                                aria-label=""
                            >
                                Comment and share
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title">
                    
                        <a
                            class="link-unstyled"
                            href="/2021/11/28/%E4%B8%BA%E4%BB%80%E4%B9%88SOLID%E4%BB%8D%E7%84%B6%E6%98%AF%E7%8E%B0%E4%BB%A3%E8%BD%AF%E4%BB%B6%E6%9E%B6%E6%9E%84%E7%9A%84%E5%9F%BA%E7%9F%B3/"
                            aria-label=": 为什么SOLID仍然是现代软件架构的基石"
                        >
                            为什么SOLID仍然是现代软件架构的基石
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time datetime="2021-11-28T11:26:13+00:00">
	
		    Nov 28, 2021
    	
    </time>
    
        <span>in </span>
        
    <a class="category-link" href="/categories/Architecture/">Architecture</a>


    
</div>

            </div>
            
                <div class="postShorten-content">
                    <h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><p>最近20年软件设计发生了天翻地覆的变化，但是SOLID原则至今仍然是软件设计的最佳实践。</p>
<p>SOLID 原则对于对于创建高质量软件是久经测试的标题。但是在现代多范式编程（函数式编程等）和云计算兴起的年代，它依然能够坚挺吗？我将通过如下文章解释SOLID代表了什么，为什么它依然适用现代软件，并且分享一些例子来解释。</p>
<h2 id="什么是SOLID"><a href="#什么是SOLID" class="headerlink" title="什么是SOLID"></a>什么是SOLID</h2><p>SOLID是Robert C. Martin在2000年提取出来的一系列原则。它被建议去作为面向对象（OO）编程质量的特殊思考方式。总得来讲SOLID在这几个方面：代码如何切分，代码私有和对外暴露，代码之间如何调用提出了建议。我下面将深入研究每个字母（S.O.L.I.D）的原始含义，并且扩展到面向对象编程之外的使用。</p>
<h2 id="有哪些改变？"><a href="#有哪些改变？" class="headerlink" title="有哪些改变？"></a>有哪些改变？</h2><p>21世纪早期，是Java和C++称霸的时期，理所当然我的大学很多课程都使用Java语言来当作训练。Java的流行催生出来了一些书籍，课程 和其它资料使得人们从写代码过度到写出好的代码。</p>
<p>因此，软件工业发生了深远的影响。有几个值得注意的点：</p>
<ul>
<li>**动态类型语言（Dynamically-typed languages） ** 比如 Python，Ruby, 尤其JavaScript 变的和Java一样流行—甚至在某些行业和某类公司已经超过了Java</li>
<li><strong>非面向对象范式（Non-object-oriented paradigms）</strong> 最值得注意的是函数式编程（FP），在这些新语言中也比较常见。甚至Java本身也引入了lambdas！元编程技术（增加和改变对象的方法和特性）等技术也越来越流行。还有拥有“软面向对象”特征的Go语言，它具有静态类型但是没有继承。所有的这些都表明了现代软件中类和集成没有过去重要。</li>
<li><strong>开源软件（Open-source software）</strong> 的扩散。早期，更多的通用软件是闭源（closed-source）人们使用的都是编译后的软件，现在通常人们依赖的软件都是开源的。因此，在编写库是曾经对必不可少的逻辑和数据隐藏不再哪么重要。</li>
<li><strong>微服务和软件即服务（Saas)</strong> 爆炸式地出现。与其将应用程序部署为将所有依赖项链接在一起的大型可执行文件，不如部署一个与其他服务（自己的活第三方提供支持的服务）调用的小型服务。</li>
</ul>
<p>整体来看，SOLID真正关心的许多事情——例如类和接口，数据隐藏性和多态——不再是程序员每天都要处理的事情。</p>
<h2 id="有什么没发生变化？"><a href="#有什么没发生变化？" class="headerlink" title="有什么没发生变化？"></a>有什么没发生变化？</h2><p>现在工业界有很多不一样了，但是也还有一些东西未发生改变。包括：</p>
<ul>
<li><strong>代码是由人类编写和修改的</strong> 。代码被编写一次并且被读很多很多次。所以对内部和外部需要很好的代码说明文档，尤其很好的API文档。</li>
<li><strong>代码被组织成模块</strong>。在某些语言中，这些是类。在其他情况下，他们可能是单独的源文件。在JavaScript中，它们可能是导出对象。无论如何，总是存在某种方式去隔离和组织代码成为独立，有界的单元。因此，总是需要决定如何最好的将代码组织在一起。</li>
<li><strong>代码可以是内部的或者外部的</strong>。一些编写出来的代码是被你自己或者你的团队使用，一些可能会被其它团队甚至其他顾客通过API的方式使用。这也意味着需要某种方式来决定哪些代码是“可见的”哪些是隐藏的。</li>
</ul>
<h2 id="“现代”SOLID"><a href="#“现代”SOLID" class="headerlink" title="“现代”SOLID"></a>“现代”SOLID</h2><p>在接下来的文章中，我将把SOLID中的每一项原则都表述为更一般的描述，并且说明是如何应用在OO，FP，多范式编程中的，并距离说明。在许多情况下，这些原则甚至可以应用在整个服务或者系统中。</p>
<p>需要注意的是我将使用“模块”代指一组代码，可以是类，包，文件等等。</p>
<h2 id="单一职责-（Single-responsibility-principle）"><a href="#单一职责-（Single-responsibility-principle）" class="headerlink" title="单一职责 （Single responsibility principle）"></a>单一职责 （Single responsibility principle）</h2><p><strong>原始定义：</strong>  “一个类改变的原因不会超过一个”</p>
<p>如果您编写的类有很多关注点或“更改的原因”，那么这些关注点中任何一个需要更改，您就需要更改相同的代码。这增加了对一个特性功能的修改就会破坏另外一个特性功能的可能性。</p>
<p>一个例子，如下是一个永远不应该应用在生产环境的Franken-class:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">FrankenClass</span> &#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">savaUserDetail</span><span class="params">(User user)</span> &#123;</span><br><span class="line">    <span class="comment">//...</span></span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">performOrder</span><span class="params">(Order order)</span> &#123;</span><br><span class="line">    <span class="comment">//...</span></span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">shipItem</span><span class="params">(Item item, String address)</span> &#123;</span><br><span class="line">    <span class="comment">//...</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>新的定义：</strong> “每个模块应该做一件事，并且做好”。</p>
<p>这个原则和高内聚（high cohesion）话题紧密联系。本质上，您的代码不应该将很多角色或者用途混在一起。</p>
<p>如下是使用JavaScript的同一示例的函数式编程（FP）版本：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">saveUserDetails</span> = (<span class="params">user</span>) =&gt; &#123;...&#125;</span><br><span class="line"><span class="keyword">const</span> <span class="title function_">performOrder</span> = (<span class="params">order</span>) =&gt; &#123; ...&#125;</span><br><span class="line"><span class="keyword">const</span> <span class="title function_">shipItem</span> = (<span class="params">item, address</span>) =&gt; &#123; ... &#125;</span><br><span class="line"><span class="keyword">export</span> &#123; saveUserDetails, performOrder, shipItem &#125;;</span><br><span class="line"><span class="keyword">import</span> &#123; saveUserDetails, performOrder, shipItem &#125; <span class="keyword">from</span> <span class="string">&quot;allActions&quot;</span>;                   </span><br></pre></td></tr></table></figure>

<p>这也适用在微服务设计；如果你有一个单独服务来处理所有这三个功能，它就会尝试做太多事情。</p>
<h2 id="开闭原则（Open-closed-principle）"><a href="#开闭原则（Open-closed-principle）" class="headerlink" title="开闭原则（Open-closed principle）"></a>开闭原则（Open-closed principle）</h2><p><strong>原始定义：</strong> “软件实体应该对扩展开放，对修改关闭。”</p>
<p>这也是Java语言设计的一部分—你可以创建一个子类来继承一个类，但是不能去修改原始的类。</p>
<p>“对扩展开放”的原因之一是限制了对类作者的依赖——如果你需要改动一个类，你不得不去等待类的原始作者去修改，或者你深入研究这个类后再去修改。更重要的是这个类承担了太多的关注点这将打破单一职责原则。</p>
<p>“对修改关闭”的原因是我们不相信下游的使用者能够完全理解我们所有的“private”私有代码，我们希望保护它免收不熟练的人的修改带来的损害。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Notifier</span> &#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">notify</span><span class="params">(String message)</span> &#123;</span><br><span class="line">    <span class="comment">//send an e-mail</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">LoggingNotifier</span> <span class="keyword">extends</span> <span class="title class_">Notifier</span> &#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">notify</span><span class="params">(String message)</span> &#123;</span><br><span class="line">    <span class="built_in">super</span>.notify(message);<span class="comment">//keep parent behaiver</span></span><br><span class="line">    <span class="comment">//also log the message;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>新定义：</strong> “应该能够在不重写模块的情况下使用和添加模块”。</p>
<p>这在面向对象领域是免费的（AOP）。在函数式编程代码必须明确定义Hook point以允许修改。这事一个示例，其中不仅仅允许使用前后hooks，而且甚至可以通过将函数传递给您的函数来覆盖其基本行为：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//library code</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">saveRecord</span> = (<span class="params">record, save, beforeSave, afterSave</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">defaultSave</span> = (<span class="params">record</span>) =&gt; &#123;</span><br><span class="line">    <span class="comment">//default save function;</span></span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">if</span> (beforeSave) <span class="title function_">beforeSave</span>(record);</span><br><span class="line">  <span class="keyword">if</span> (save) &#123;</span><br><span class="line">    <span class="title function_">save</span>(record);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="title function_">defaultSave</span>(record);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span>(afterSave) <span class="title function_">afterSave</span>(record);</span><br><span class="line">  <span class="comment">//calling code</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//calling code</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">customSave</span> = (<span class="params">record</span>) =&gt; &#123;...&#125;</span><br><span class="line"><span class="title function_">saveRecord</span>(myRecord, customSave);</span><br></pre></td></tr></table></figure>

<h2 id="里氏替换原则"><a href="#里氏替换原则" class="headerlink" title="里氏替换原则"></a>里氏替换原则</h2><p><strong>原始定义：</strong> “如果类型S是T的子类型，那么类型T可以被替换为S类型而不用修改程序的任何所需属性”。</p>
<p>这也是面向对象语言的基础属性。它意味着你可以使用任意子类替换它们的父类。所以你可以对这一个约定充满信心：你可以安全的使用任何 “is a” type T的对象而像T一样去使用。如下例子：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Vehicle</span> &#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getNumberOfWheels</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">4</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Bicycle</span> <span class="keyword">extends</span> <span class="title class_">Vehicle</span> &#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getNumberOfWheels</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">2</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// calling code</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="variable">COST_PER_TIRE</span> <span class="operator">=</span> <span class="number">50</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">tireCost</span><span class="params">(Vehicle vehicle)</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> COST_PER_TIRE * vehicle.getNumberOfWheels();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">Bicycle</span> <span class="variable">bicycle</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Bicycle</span>();</span><br><span class="line">System.out.println(tireCost(bicycle)); <span class="comment">//100</span></span><br></pre></td></tr></table></figure>

<p> <strong>新定义：</strong> 你可以使用一个东西代替另一个东西只要它们声明的行为方式一样。</p>
<p>在动态语言中，重要的是如果你的程序“promises”去做某些事情（例如实现一个接口或者函数），你需要遵守你的“promises”不要给客户端不符合“promises”的东西。</p>
<p>许多动态语言使用“duck typing”（不知道什么意思 <a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Duck_typing">戳这儿</a> ）去达到这一点。本质上，你的function正式或者非正式的声明它期望其输入以特定方式运行并根据该假设运行。</p>
<p>例如Ruby:</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># <span class="doctag">@param</span> input [#to_s]</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">split_lines</span>(<span class="params">input</span>)</span><br><span class="line">  input.to_s.split(<span class="string">&quot;\n&quot;</span>)</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>

<p>在这个例子中，这个function并不在乎输入类型——只关心它有一个to_s函数，它的行为方式与所有to_s函数的行为方式相同：即把输入变成字符串。许多动态语言没有办法去强制这种行为，因此这更像一种纪律问题而不是一种形式化技术。</p>
<p>接下来是函数式编程TypeScript例子，在这个例子中高阶函数引入了一个过滤器输入一个数字返回一个boolean值：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> isEven = (<span class="attr">x</span>: <span class="built_in">number</span>) : <span class="function"><span class="params">boolean</span> =&gt;</span> x % <span class="number">2</span> == <span class="number">0</span>;</span><br><span class="line"><span class="keyword">const</span> isOdd = (<span class="attr">x</span>: <span class="built_in">number</span>) : <span class="function"><span class="params">boolean</span> =&gt;</span> x % <span class="number">2</span> == <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">printFiltered</span> = (<span class="params"><span class="attr">arr</span>: <span class="built_in">number</span>[], <span class="attr">filterFunc</span>: (int) =&gt; <span class="built_in">boolean</span></span>) =&gt; &#123;</span><br><span class="line">  arr.<span class="title function_">forEach</span>(<span class="function">(<span class="params">item</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_">filterFunc</span>(item)) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(item);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> array = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>];</span><br><span class="line"><span class="title function_">printFiltered</span>(array, isEven);</span><br><span class="line"><span class="title function_">printFiltered</span>(array, isOdd);</span><br></pre></td></tr></table></figure>

<h2 id="接口隔离原则（Interface-segregation-principle）"><a href="#接口隔离原则（Interface-segregation-principle）" class="headerlink" title="接口隔离原则（Interface segregation principle）"></a>接口隔离原则（Interface segregation principle）</h2><p><strong>原始定义：</strong> “许多客户端（client-specific）接口要好于一个通用的（general-purpose）接口。”</p>
<p>在面向对象语言中，你可以理解为是为你的类提供了一个“视图”（view）。与其提供给你一个大而全的实现给你的客户端，而是仅使用与该客户端相关的方法在它们之上创建接口，并要求您的客户端使用这些接口。</p>
<p>正如单一职责原则一样，接口隔离原则隔离了系统之间的耦合，并且确保客户端不需要了解它所依赖的无关功能。</p>
<p>如下例子通过SPR测试：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">PrintRequest</span> &#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">createRequest</span><span class="params">()</span> &#123;&#125;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">deleteRequest</span><span class="params">()</span> &#123;&#125;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">workOnRequest</span><span class="params">()</span> &#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这段代码通常只有一个“原因去更改”——它都与打印请求有关，它们都是同一个域的一部分，并且所有三种方法都可能会更改相同的状态。但是，创建请求的客户端不太可能是处理请求的客户端。将这些接口隔离开会更有意义：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> <span class="title class_">PrintRequestModifier</span> &#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">createRequest</span><span class="params">()</span>;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">deleteRequest</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">PrintRequestWorker</span> &#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">workOnRequest</span><span class="params">()</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">PrintRequest</span> <span class="keyword">implements</span> <span class="title class_">PrintRequestModifier</span>, PrintRequestWorker &#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">createRequest</span><span class="params">()</span> &#123;&#125;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">deleteRequest</span><span class="params">()</span> &#123;&#125;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">workOnRequest</span><span class="params">()</span> &#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>新的定义：</strong> “不要向客户端展示它不需要看到的东西。”</p>
<p>只记录你客户端需要知道的内容。这意味着使用文档生成器只输入“public”function 或路由，而“private”没必要输出。</p>
<p>在微服务时代，你可以使用文档或者真正的隔离增加清晰度。例如，你外部客户可能只能以用户身份登录，但你的内部服务可能获取用户列表或者其他属性。你也可以创建一个单独的“仅限外部”用户服务来调用你的主服务，或者你可以只为隐藏内部路由的外部用户输出特定文档。</p>
<h2 id="依赖倒置原则（Dependency-inversion-principle）"><a href="#依赖倒置原则（Dependency-inversion-principle）" class="headerlink" title="依赖倒置原则（Dependency inversion principle）"></a>依赖倒置原则（Dependency inversion principle）</h2><p><strong>原始定义：</strong> “依赖抽象，而不是依赖具体实现”</p>
<p>在面向对象语言中，这意味着客户端应该尽可能依赖接口而不是具体实现类。这确保了代码应该依赖尽可能小的面积——事实上，客户端不必要依赖所有的代码，只需要依赖一个定义代码应该如何表现的契约。和其它原则一样这降低了修改一处而导致破坏了其它功能的风险。下面的例子：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> <span class="title class_">Logger</span> &#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">write</span><span class="params">(String message)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">FileLogger</span> <span class="keyword">implements</span> <span class="title class_">Logger</span> &#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">write</span><span class="params">(String message)</span> &#123;</span><br><span class="line">    <span class="comment">//write to file</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">StandardOutLogger</span> <span class="keyword">implements</span> <span class="title class_">Logger</span> &#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">write</span><span class="params">(String message)</span> &#123;</span><br><span class="line">    <span class="comment">//write to standard out</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// call</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doStuff</span><span class="params">(Logger logger)</span> &#123;</span><br><span class="line">  <span class="comment">//do stuff</span></span><br><span class="line">  logger.write(<span class="string">&quot;some message&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>如果你正在写的代码需要一个logger， 你不想去限制自己仅仅只是去写入文件中，因为你不在乎。你仅仅只需要调用 write方法而让具体实现去输出。</p>
<p><strong>新的定义：</strong> “依赖抽象，而不是具体实现。”</p>
<p>对的，这个例子我将定义保留原样！保持东西依赖抽象依然是重要的，即使现代代码中的抽象机制不像严格的面向对象世界那样强大。</p>
<p>尤其，这和上面讨论的里氏替换原则是一样的。主要的区别是它没有默认实现。因此，该部分中涉及鸭子类型和钩子函数的讨论通用适用于依赖倒置。</p>
<p>你也可以使用抽象对于微服务。比如，你可以将服务之间的直接通信替换为消息总线活队列平台，例如Kafka或者其他消息中间件。这样允许服务将消息发送到单个通用位置，而无需关心哪个特定服务将接收这些消息并执行其任务。</p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>再次重新梳理“现代SOLID”一次：</p>
<ul>
<li>不要惊讶别人读到你的代码。</li>
<li>不要惊讶别人使用你的代码。</li>
<li>不要让阅读你代码的人感到迷惑。</li>
<li>为你的代码使用合理的边界。</li>
<li>使用正确的耦合级别——尘归尘，土归土。</li>
</ul>
<p>好的代码就是好的代码——从未改变，SOLID也是，实践是坚实的基础。</p>
<p><strong>原文连接：</strong>  <a target="_blank" rel="noopener" href="https://stackoverflow.blog/2021/11/01/why-solid-principles-are-still-the-foundation-for-modern-software-architecture/?utm_source=programmingdigest&amp;utm_medium=web&amp;utm_campaign=447">https://stackoverflow.blog/2021/11/01/why-solid-principles-are-still-the-foundation-for-modern-software-architecture/?utm_source=programmingdigest&amp;utm_medium=web&amp;utm_campaign=447</a></p>

                    
                        


                    
                    
                        <p>
                            <a
                                href="/2021/11/28/%E4%B8%BA%E4%BB%80%E4%B9%88SOLID%E4%BB%8D%E7%84%B6%E6%98%AF%E7%8E%B0%E4%BB%A3%E8%BD%AF%E4%BB%B6%E6%9E%B6%E6%9E%84%E7%9A%84%E5%9F%BA%E7%9F%B3/#post-footer"
                                class="postShorten-excerpt_link link"
                                aria-label=""
                            >
                                Comment and share
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title">
                    
                        <a
                            class="link-unstyled"
                            href="/2020/09/24/%E7%90%86%E8%A7%A3RESTful/"
                            aria-label=": 理解RESTful"
                        >
                            理解RESTful
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time datetime="2020-09-24T09:10:41+00:00">
	
		    Sep 24, 2020
    	
    </time>
    
        <span>in </span>
        
    <a class="category-link" href="/categories/Architecture/">Architecture</a>


    
</div>

            </div>
            
                <div class="postShorten-content">
                    <h3 id="纠葛的问题：REST和RPC的对比？"><a href="#纠葛的问题：REST和RPC的对比？" class="headerlink" title="纠葛的问题：REST和RPC的对比？"></a>纠葛的问题：REST和RPC的对比？</h3><p>思想上，概念上，使用范围 RPC和REST都完全不一样，本质上并不是同一类东西，只有部分功能重合。<strong>REST和RPC在思想上存在差异的核心是：抽象目标不一样，也就是面向资源的编程思想和面向过程的编程思想之间的差异。</strong><br>REST：本质上不是一种协议，而是一种风格。</p>
<h3 id="理解REST"><a href="#理解REST" class="headerlink" title="理解REST"></a>理解REST</h3><p>REST 概念的提出来自于罗伊·菲尔丁（Roy Fielding）在 2000 年发表的博士论文：<a target="_blank" rel="noopener" href="https://www.ics.uci.edu/~fielding/pubs/dissertation/top.htm">《Architectural Styles and the Design of Network-based Sorftware Architectures》</a>。</p>
<p>REST全称为：<strong>Representational State Transfer 即表征状态转移。</strong></p>
<h3 id="为何常常使用HTTP搭配REST"><a href="#为何常常使用HTTP搭配REST" class="headerlink" title="为何常常使用HTTP搭配REST"></a>为何常常使用HTTP搭配REST</h3><p><strong>REST实际上是HTT(Hyper Text Transfer，超文本传输)的进一步抽象，就想是接口和实现类之间的关系。（即REST是接口，HTT是实现）</strong>。</p>
<ul>
<li><p>Representation 表征 （对Resource的转换）：</p>
<p>浏览器向客户端请求资源的HTML格式，那么返回的这个HTML我们就可以称之为：表征。也可以理解为MVC模式中的：表示层。</p>
</li>
<li><p>State 状态：</p>
<p>特定语境中产生的上下文信息称之为“状态”。注意Stateful 和 Stateless是针对的服务端没有记录上下文。浏览器每次携带上下文来请求服务端，比如：JWT技术</p>
</li>
<li><p>Transfer 转移:</p>
<p>服务端通过浏览器提供的信息，由当前的表示层转移到新的标识层，这就被成为：表征状态转移。</p>
</li>
</ul>
<h3 id="如何评价一个系统是否符合RESTful-？"><a href="#如何评价一个系统是否符合RESTful-？" class="headerlink" title="如何评价一个系统是否符合RESTful ？"></a>如何评价一个系统是否符合RESTful ？</h3><p>Fielding 认为，一套理想的、完全满足 REST 的系统应该满足以下六个特征。</p>
<ol>
<li><p>服务端与客户端分离（Client-Server）</p>
</li>
<li><p>无状态（Stateless）</p>
<p>REST希望服务器不能负责维护状态，每一次从客户端发送的请求中，应该包括所有必要的上下文信息，会话信息也由客户端保存维护。服务器端依据客户端传递的状态信息来进行业务处理，并且驱动整个应用的状态变迁。提升了系统的可见性、可靠性和可伸缩性（大多数系统达不到这个要求，越复杂，越大型的系统越是如此。）</p>
</li>
<li><p>可缓存（Cacheability）</p>
<p>REST希望客户端和中间的通讯传递者（代理）可以将部分服务端应答缓存起来。通过良好的缓存机制，减少客户端和服务端的交互。</p>
</li>
<li><p>分层系统（Layered System）</p>
<p>不是传统的MVC这样的分层。而是指客户端一般不需要知道是否直接链接到了最终的服务器，或者是链接到了路径上的中间服务器。中间服务器可以通过负载均衡和共享缓存机制，提高系统的可扩展性。这样也便于缓存，伸缩和安全策略的部署。</p>
</li>
<li><p>统一接口（Uniform Interface）</p>
<p>REST希望开发者面向资源编程，<strong>希望软件系统设计重点放放在抽象系统有哪些资源上，而不是抽象系统该有哪些行为上。</strong></p>
<p>举例：</p>
<blockquote>
<p>几乎每个系统都会有登录和注销功能，如果你登录对应的是login() 注销对应于loginout()。那么如果面向资源可以理解成为：登录是PUT session 注销是DELETE session，这样你只需要设计一种“session”资源即可。查询登录用户使用GET session。</p>
</blockquote>
<p>Felding给出三个建议：</p>
<ol>
<li>系统要做到每次请求中都包含资源的ID，所有操作都通过ID完成。</li>
<li>每个资源都应该有自描述信息。</li>
<li>通过超文本来驱动应用状态的转移。</li>
</ol>
</li>
<li><p>按需代码（Code-On-Demand）</p>
</li>
</ol>
<h3 id="RESTful带来的优点"><a href="#RESTful带来的优点" class="headerlink" title="RESTful带来的优点"></a>RESTful带来的优点</h3><ol>
<li><p>降低了服务接口的学习成本</p>
<p>它把资源的标准操作都映射到了标准的HTTP方法上（GET，PUT，POST，DELETE）对每个资源的语义一致。无需额外定义。</p>
</li>
<li><p>资源天然具有集合与层次结构</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET /book/&#123;bookId&#125;/chapter/&#123;chapterNumber&#125;</span><br></pre></td></tr></table></figure>

<p>天热的集合与层次关系。</p>
</li>
<li><p>RESTful绑定于HTTP协议</p>
<p>面向资源编程并不是必须构筑在 HTTP 之上。</p>
<p>但是HTTP 协议已经有效运作了 30 年，与其相关的技术基础设施已是千锤百炼，无比成熟。而它的坏处自然就是，当你想去考虑那些 HTTP 不提供的特性时，就束手无策了。</p>
</li>
</ol>
<h3 id="RESTful缺点"><a href="#RESTful缺点" class="headerlink" title="RESTful缺点"></a>RESTful缺点</h3><ol>
<li><p>面向资源只适合做CRUD，只有面向过程，面向对象编程才能处理真正复杂的业务逻辑。</p>
</li>
<li><p>REST与HTTP完全绑定，不适用于要求高性能传输场景当中。</p>
<p>面向资源编程与协议无关，但是 REST（特指 Fielding 论文中所定义的 REST，而不是泛指面向资源的思想）的确依赖着 HTTP 协议的标准方法、状态码和协议头等各个方面。</p>
</li>
<li><p>REST 不利于事务支持。</p>
</li>
<li><p>REST 没有传输可靠性支持。</p>
<p>应对传输可靠性最简单粗暴的做法，就是把消息再重发一遍。这种简单处理能够成立的前提，是服务具有幂等性（Idempotency），也就是说服务被重复执行多次的效果与执行一次是相等的。</p>
</li>
<li><p>REST 缺乏对资源进行“部分”和“批量”的处理能力。</p>
<p>就是缺少对资源的“部分”操作的支持。要解决批量操作这类问题，目前一种从理论上看还比较优秀的解决方案是GraphQL（但实际使用人数并不多）。GraphQL 是由 Facebook 提出并开源的一种面向资源 API 的数据查询语言。它和 SQL 一样，挂了个“查询语言”的名字，但其实 CRUD 都能做。</p>
</li>
</ol>
<h3 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h3><p>周志明的软件架构课：<a target="_blank" rel="noopener" href="https://time.geekbang.org/column/article/317164">https://time.geekbang.org/column/article/317164</a></p>
<p>李锟谈 Fielding 博士 REST 论文中文版发布：<a target="_blank" rel="noopener" href="https://www.infoq.cn/article/2007/07/dlee-fielding-rest/">https://www.infoq.cn/article/2007/07/dlee-fielding-rest/</a></p>
<p>Fielding论文：<a target="_blank" rel="noopener" href="https://www.ics.uci.edu/~fielding/pubs/dissertation/top.htm">https://www.ics.uci.edu/~fielding/pubs/dissertation/top.htm</a></p>
<h3 id="REST和RPC对比结论："><a href="#REST和RPC对比结论：" class="headerlink" title="REST和RPC对比结论："></a>REST和RPC对比结论：</h3><p>无论是思想上，概念上，还是使用范围上，REST和RPC都不完全一样，本质上并不是同一个类型的东西。充其量是相似，在应用中会存在重合功能。</p>
<ol>
<li>思想上差异：抽象目标不一样，REST是面向资源的编程思想，RPC是面向过程。</li>
<li>概念上：REST并不是一种远程服务调用协议，也可以说它就不是一种协议，只是一种风格。RPC是作为一种远程调用协议的存在。</li>
<li>试用范围：REST和RPC作为主流的两种远程调用方式，在使用上确实有重合之处。</li>
</ol>

                    
                        


                    
                    
                        <p>
                            <a
                                href="/2020/09/24/%E7%90%86%E8%A7%A3RESTful/#post-footer"
                                class="postShorten-excerpt_link link"
                                aria-label=""
                            >
                                Comment and share
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title">
                    
                        <a
                            class="link-unstyled"
                            href="/2020/05/23/%E7%90%86%E8%A7%A3RPC/"
                            aria-label=": 理解RPC"
                        >
                            理解RPC
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time datetime="2020-05-23T09:10:41+00:00">
	
		    May 23, 2020
    	
    </time>
    
        <span>in </span>
        
    <a class="category-link" href="/categories/Architecture/">Architecture</a>


    
</div>

            </div>
            
                <div class="postShorten-content">
                    <h3 id="什么是RPC-Remote-procedure-call"><a href="#什么是RPC-Remote-procedure-call" class="headerlink" title="什么是RPC(Remote procedure call)"></a>什么是RPC(Remote procedure call)</h3><blockquote>
<p>Remote procedure call is the synchronous language-level transfer of control between programs in address spaces whose primary communication is a narrow channel.—— Bruce Jay Nelson，Remote Procedure Call，Xerox PARC，1981</p>
</blockquote>
<p>RPC是一种语言级别的通讯协议，它允许运行于一台计算机上的程序以某种管道作为通讯媒介（即某种网络传输协议），去调用另外一个地址空间（通常为网络上的另外一台计算机）。</p>
<h3 id="所有RPC协议都需要解决哪些问题？"><a href="#所有RPC协议都需要解决哪些问题？" class="headerlink" title="所有RPC协议都需要解决哪些问题？"></a>所有RPC协议都需要解决哪些问题？</h3><p>基于 TCP/IP 网络的、支持 C 语言的 RPC 协议，后来也被称为是ONC RPC（Open Network Computing RPC/Sun RPC）。这两个RPC鼻祖。</p>
<ol>
<li>如何表示数据</li>
<li>如何传递数据</li>
<li>如何标识方法</li>
</ol>
<h4 id="如何表示数据"><a href="#如何表示数据" class="headerlink" title="如何表示数据"></a>如何表示数据</h4><p>将交互双方涉及的数据，转换为某种事先约定好的中立数据流格式来传输，将数据流转换回不同语言中对应的数据类型来使用，<strong>即序列化与反序列化</strong></p>
<h4 id="如何传递数据"><a href="#如何传递数据" class="headerlink" title="如何传递数据"></a>如何传递数据</h4><p>这里“传递数据”通常指的是应用层协议，实际传输一般是基于标准的 TCP、UDP 等传输层协议来完成的。</p>
<h4 id="如何标识方法"><a href="#如何标识方法" class="headerlink" title="如何标识方法"></a>如何标识方法</h4><p>标识调用方法入口，能够找到这个方法。</p>
<h3 id="已经实现的RPC框架"><a href="#已经实现的RPC框架" class="headerlink" title="已经实现的RPC框架"></a>已经实现的RPC框架</h3><p>RPC 框架有明显朝着更高层次（不仅仅负责调用远程服务，还管理远程服务）与插件化方向发展的趋势，不再选择自己去解决表示数据、传递数据和表示方法这三个问题，而是将全部或者一部分问题设计为扩展点，实现核心能力的可配置，再辅以外围功能，如负载均衡、服务注册、可观察性等方面的支持。这一类框架的代表，有 Facebook 的 Thrift 和阿里的 Dubbo（现在两者都是 Apache 的）。尤其是断更多年后重启的 Dubbo 表现得更为明显，它默认有自己的传输协议（Dubbo 协议），同时也支持其他协议，它默认采用 Hessian 2 作为序列化器，如果你有 JSON 的需求，可以替换为 Fastjson；如果你对性能有更高的需求，可以替换为Kryo、FST、Protocol Buffers 等；如果你不想依赖其他包，直接使用 JDK 自带的序列化器也可以。这种设计，就在一定程度上缓解了 RPC 框架必须取舍，难以完美的缺憾。</p>
<p>RMI（Sun/Oracle）、Thrift（Facebook/Apache）、Dubbo（阿里巴巴 /Apache）、gRPC（Google）、Motan2（新浪）、Finagle（Twitter）、brpc（百度）、.NET Remoting（微软）、Arvo（Hadoop）、JSON-RPC 2.0（公开规范，JSON-RPC 工作组）</p>

                    
                        


                    
                    
                        <p>
                            <a
                                href="/2020/05/23/%E7%90%86%E8%A7%A3RPC/#post-footer"
                                class="postShorten-excerpt_link link"
                                aria-label=""
                            >
                                Comment and share
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    <div class="pagination-bar">
    <ul class="pagination">
        
        
        <li class="pagination-number">page 1 of 1</li>
    </ul>
</div>

</section>



                <footer id="footer" class="main-content-wrap">
    <span class="copyrights">
        Copyrights &copy; 2025 Topsion. All Rights Reserved.
    </span>
</footer>

            </div>
            
        </div>
        


    
        
    

<div id="about">
    <div id="about-card">
        <div id="about-btn-close">
            <i class="fa fa-times"></i>
        </div>
        
            <img id="about-card-picture" src="/assets/images/avatar.jpg" alt="Author&#39;s picture"/>
        
            <h4 id="about-card-name">Topsion</h4>
        
            <div id="about-card-bio"><p>Fullstack Developer</p>
</div>
        
        
            <div id="about-card-job">
                <i class="fa fa-briefcase"></i>
                <br/>
                <p>Coder</p>

            </div>
        
        
            <div id="about-card-location">
                <i class="fa fa-map-marker-alt"></i>
                <br/>
                Xi&#39;an China
            </div>
        
    </div>
</div>

        
        
<div id="cover" style="background-image:url('/assets/images/cover.jpg');"></div>
        <!--SCRIPTS-->

<script src="/assets/js/script-q2wtdh1f7oaxzdmuuvsc1uyl8fnwcg5dz7kgztdayssvj6qd6o7u5zwralwk.min.js"></script>

<!--SCRIPTS END-->





    </body>
</html>
