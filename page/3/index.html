
<!DOCTYPE html>
<html lang="en">
    
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="Summary">
    <title>Summary</title>
    <meta name="author" content="Topsion">
    
    
    
    <script type="application/ld+json">{"@context":"http://schema.org","@type":"Website","@id":"http://example.com","author":{"@type":"Person","name":"Topsion","sameAs":["https://github.com/wenPKtalk","https://stackoverflow.com/users/15967860/topsion","https://www.linkedin.com/feed/"],"image":"avatar.jpg"},"name":"Summary","description":"The whole problem with the world is that fools and fanatics are always so certain of themselves, and wiser people so full of doubts.(这个世界的问题在于聪明人充满疑惑而傻子却坚信不疑)","url":"http://example.com"}</script>
    <meta name="description" content="The whole problem with the world is that fools and fanatics are always so certain of themselves, and wiser people so full of doubts.(这个世界的问题在于聪明人充满疑惑而傻子却坚信不疑)">
<meta property="og:type" content="blog">
<meta property="og:title" content="Summary">
<meta property="og:url" content="http://example.com/page/3/index.html">
<meta property="og:site_name" content="Summary">
<meta property="og:description" content="The whole problem with the world is that fools and fanatics are always so certain of themselves, and wiser people so full of doubts.(这个世界的问题在于聪明人充满疑惑而傻子却坚信不疑)">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="Topsion">
<meta name="twitter:card" content="summary">
    
    
        
    
    
        <meta property="og:image" content="http://example.com/assets/images/avatar.jpg"/>
    
    
    
    
    <!--STYLES-->
    
<link rel="stylesheet" href="/assets/css/style-yaeygdlgk8x4rqd5mp0jrkosoe3fmfokggmiu05rmpel4wjoxmvp5s6gestz.min.css">

    <!--STYLES END-->
    

    

    
</head>

    <body>
        <div id="blog">
            <!-- Define author's picture -->


    
        
            
        
    

<header id="header" data-behavior="1">
    <i id="btn-open-sidebar" class="fa fa-lg fa-bars"></i>
    <div class="header-title">
        <a
            class="header-title-link"
            href="/"
            aria-label=""
        >
            Summary
        </a>
    </div>
    
        
            <a
                class="header-right-picture "
                href="#about"
                aria-label="Open the link: /#about"
            >
        
        
            <img class="header-picture" src="/assets/images/avatar.jpg" alt="Author&#39;s picture"/>
        
        </a>
    
</header>

            <!-- Define author's picture -->



        
    

<nav id="sidebar" data-behavior="1">
    <div class="sidebar-container">
        
            <div class="sidebar-profile">
                <a
                    href="/#about"
                    aria-label="Read more about the author"
                >
                    <img class="sidebar-profile-picture" src="/assets/images/avatar.jpg" alt="Author&#39;s picture"/>
                </a>
                <h4 class="sidebar-profile-name">Topsion</h4>
                
                    <h5 class="sidebar-profile-bio"><p>Fullstack Developer</p>
</h5>
                
            </div>
        
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/"
                            
                            rel="noopener"
                            title="Home"
                        >
                        <i class="sidebar-button-icon fa fa-home" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Home</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/all-categories"
                            
                            rel="noopener"
                            title="Categories"
                        >
                        <i class="sidebar-button-icon fa fa-bookmark" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Categories</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/all-tags"
                            
                            rel="noopener"
                            title="Tags"
                        >
                        <i class="sidebar-button-icon fa fa-tags" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Tags</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/all-archives"
                            
                            rel="noopener"
                            title="Archives"
                        >
                        <i class="sidebar-button-icon fa fa-archive" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Archives</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link open-algolia-search"
                            href="#search"
                            
                            rel="noopener"
                            title="Search"
                        >
                        <i class="sidebar-button-icon fa fa-search" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Search</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="#about"
                            
                            rel="noopener"
                            title="About"
                        >
                        <i class="sidebar-button-icon fa fa-question" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">About</span>
                    </a>
            </li>
            
        </ul>
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="https://github.com/wenPKtalk"
                            
                                target="_blank"
                            
                            rel="noopener"
                            title="GitHub"
                        >
                        <i class="sidebar-button-icon fab fa-github" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">GitHub</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="https://stackoverflow.com/users/15967860/topsion"
                            
                                target="_blank"
                            
                            rel="noopener"
                            title="Stack Overflow"
                        >
                        <i class="sidebar-button-icon fab fa-stack-overflow" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Stack Overflow</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="https://www.linkedin.com/feed/"
                            
                                target="_blank"
                            
                            rel="noopener"
                            title="LinkedIn"
                        >
                        <i class="sidebar-button-icon fab fa-linkedin" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">LinkedIn</span>
                    </a>
            </li>
            
        </ul>
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/atom.xml"
                            
                            rel="noopener"
                            title="RSS"
                        >
                        <i class="sidebar-button-icon fa fa-rss" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">RSS</span>
                    </a>
            </li>
            
        </ul>
        
    </div>
</nav>

            
            <div id="main" data-behavior="1"
                 class="
                        hasCoverMetaIn
                        ">
                <section class="postShorten-group main-content-wrap">
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title">
                    
                        <a
                            class="link-unstyled"
                            href="/2022/04/15/%E5%A6%82%E4%BD%95%E5%86%99%E5%A5%BD%E5%87%BD%E6%95%B0/"
                            aria-label=": 如何写好函数"
                        >
                            如何写好函数
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time datetime="2022-04-15T08:50:24+00:00">
	
		    Apr 15, 2022
    	
    </time>
    
        <span>in </span>
        
    <a class="category-link" href="/categories/Clean-Code/">Clean Code</a>


    
</div>

            </div>
            
                <div class="postShorten-content">
                    <h3 id="1-给函数起个好名字"><a href="#1-给函数起个好名字" class="headerlink" title="1. 给函数起个好名字"></a>1. 给函数起个好名字</h3><p>动词 + 关键词 ： 例如把JUnit中的assertEquals改成 assertExpectedEqualsActual(expected, actual)可能会更好些，大大减轻了记忆参数顺序的负担</p>
<h3 id="2-函数参数"><a href="#2-函数参数" class="headerlink" title="2. 函数参数"></a>2. 函数参数</h3><p>最理想的参数数量是 0（零参函数）–》其次是1（单参函数）–》 再次是2 （双参函数）–》 应该尽量避免3（三参函数）</p>
<p>如果函数看起来需要2个，3个或者3个以上参数，那说明其中一些需要封装成为类了。</p>
<p>例如：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Circle <span class="title function_">makeCircle</span><span class="params">(<span class="type">double</span> x, <span class="type">double</span> y, <span class="type">double</span> radius)</span>;</span><br><span class="line">Circle <span class="title function_">makeCircle</span><span class="params">(Point center, <span class="type">double</span> radius)</span>;</span><br></pre></td></tr></table></figure>

<p>当一组参数被传递，就像上例中的x和y，往往就是该有自己名称的某个概念的一部分（学会将一组基本变量抽象成为对象）</p>
<h3 id="3-改变输入参数，从而导致参数成为了输出参数"><a href="#3-改变输入参数，从而导致参数成为了输出参数" class="headerlink" title="3. 改变输入参数，从而导致参数成为了输出参数"></a>3. 改变输入参数，从而导致参数成为了输出参数</h3><p><em>这一点在java在写业务代码时经常会碰到，改变了输入参数，造成很多迷惑行为</em></p>
<p>例如：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//给字符串添加Report添加footer</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">appendFooter</span><span class="params">(StringBuffer report)</span>;</span><br></pre></td></tr></table></figure>
<p>如果不添加注释会产生疑惑：是给report追加东西还是，把report添加到其它东西上？所以写成如下会比较好理解</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">report.appendFooter();</span><br></pre></td></tr></table></figure>

<h3 id="4-杜绝标识参数"><a href="#4-杜绝标识参数" class="headerlink" title="4. 杜绝标识参数"></a>4. 杜绝标识参数</h3><p>标识参数(True|False)非常丑陋。使用标记参数做了两件事情，则应该拆分它。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">render(<span class="type">boolean</span> isSuite) =&gt; renderForSuite() , renderForSingleTest()</span><br></pre></td></tr></table></figure>

<h3 id="5-提取try-catch块"><a href="#5-提取try-catch块" class="headerlink" title="5. 提取try/catch块"></a>5. 提取try/catch块</h3><p>try/catch块在函数中很丑陋，将包裹在try/catch中的代码提取出来，减少try/catch的臃肿程度。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">writeToClient</span><span class="params">(HttpServletResponse response, String filePath)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> (<span class="type">ServletOutputStream</span> <span class="variable">os</span> <span class="operator">=</span> response.getOutputStream();</span><br><span class="line">             <span class="type">InputStream</span> <span class="variable">stream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileInputStream</span>(file))&#123;</span><br><span class="line">             <span class="type">File</span> <span class="variable">file</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(filePath);</span><br><span class="line">             response.setContentLength((<span class="type">int</span>)file.length());</span><br><span class="line">            <span class="type">int</span> <span class="variable">length</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">            <span class="type">byte</span>[] buff = <span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">1024</span>];</span><br><span class="line">            <span class="keyword">while</span> ((length = stream.read(buff)) &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                os.write(buff, <span class="number">0</span>, length);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            log.error(<span class="string">&quot;Download happened error&quot;</span>, e);</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (!file.delete()) &#123;</span><br><span class="line">                log.error(<span class="string">&quot;The file &#123;&#125; is failed to be deleted!&quot;</span>, filePath);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>提取try中的业务代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">writeToClient</span><span class="params">(HttpServletResponse response, String filePath)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> (<span class="type">ServletOutputStream</span> <span class="variable">os</span> <span class="operator">=</span> response.getOutputStream();</span><br><span class="line">             <span class="type">InputStream</span> <span class="variable">stream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileInputStream</span>(file))&#123;</span><br><span class="line">          </span><br><span class="line">            doWrite(os, stream, reponse, filePath)</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            log.error(<span class="string">&quot;Download happened error&quot;</span>, e);</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (!file.delete()) &#123;</span><br><span class="line">                log.error(<span class="string">&quot;The file &#123;&#125; is failed to be deleted!&quot;</span>, filePath);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">doWrite</span><span class="params">(ServletOutputStream os, </span></span><br><span class="line"><span class="params">                     InputStream stream, </span></span><br><span class="line"><span class="params">                     HttpServletResponse response,</span></span><br><span class="line"><span class="params">                     String filePath)</span>&#123;</span><br><span class="line">   <span class="type">File</span> <span class="variable">file</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(filePath);</span><br><span class="line">   response.setContentLength((<span class="type">int</span>)file.length());</span><br><span class="line">   <span class="type">int</span> <span class="variable">length</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">   <span class="type">byte</span>[] buff = <span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">1024</span>];</span><br><span class="line">   <span class="keyword">while</span> ((length = stream.read(buff)) &gt; <span class="number">0</span>) &#123;</span><br><span class="line">     os.write(buff, <span class="number">0</span>, length);</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="4-理解OO"><a href="#4-理解OO" class="headerlink" title="4. 理解OO"></a>4. 理解OO</h3><p>面向对象的设计有一个原则（我最初是从 Grady Booch 那里听到的）：“如果觉得设计太复杂，那就生成更多对象。”这种说法既违反直觉，又简单得可笑，但我发现它很有用（“生成更多对象”通常等同于“再增加一层抽象”）。总的来说，如果发现有些地方代码很乱，就要考虑用哪种类可以清理代码。通常清理代码带来的副作用是使系统更灵活并且结构更好。</p>
<h3 id="5-清理火车代码"><a href="#5-清理火车代码" class="headerlink" title="5. 清理火车代码"></a>5. 清理火车代码</h3><p>杜绝过长的调用链如：</p>
<p>隐藏委托关系（Hide Delegate）</p>
<p>迪米特法则（Law of Demeter），这个原则是这样说的：</p>
<ol>
<li>每个单元对其它单元只拥有有限的知识，而且这些单元是与当前单元有紧密联系的；</li>
<li>每个单元只能与其朋友交谈，不与陌生人交谈；</li>
<li>只与自己最直接的朋友交谈。</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">book.getAuthor().getName();</span><br><span class="line"></span><br><span class="line"><span class="comment">//重构后：</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Book</span> &#123; </span><br><span class="line">  ... </span><br><span class="line">  <span class="keyword">public</span> String <span class="title function_">getAuthorName</span><span class="params">()</span> &#123; </span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>.author.getName(); </span><br><span class="line">  &#125; </span><br><span class="line">  ...&#125;</span><br><span class="line"><span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> book.getAuthorName();</span><br></pre></td></tr></table></figure>

<p>要想摆脱初级程序员的水平，就要先从少暴露细节开始。声明完一个类的字段之后，请停下生成 getter 的手，转而让大脑开始工作，思考这个类应该提供的行为。</p>
<p><strong>基本类型偏执</strong></p>
<p>对于返回值，和参数能封装为类就封装为类；</p>
<p>比如：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">double</span> <span class="title function_">getPrice</span><span class="params">()</span> &#123; ...&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">double</span> <span class="variable">price</span> <span class="operator">=</span> <span class="built_in">this</span>.getPrice();</span><br><span class="line"><span class="keyword">if</span>(price &lt;= <span class="number">0</span>)&#123;</span><br><span class="line">  <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;价格不能为0&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//重构：封装为对象后</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Price</span>&#123;</span><br><span class="line">  <span class="type">double</span> price;</span><br><span class="line">  <span class="keyword">public</span> <span class="title function_">Price</span><span class="params">(<span class="keyword">final</span> <span class="type">double</span> price)</span> &#123; </span><br><span class="line">    <span class="keyword">if</span> (price &lt;= <span class="number">0</span>) &#123; </span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;价格不能为0&quot;</span>);</span><br><span class="line">    &#125; </span><br><span class="line">    <span class="built_in">this</span>.price = price; </span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


                    
                        


                    
                    
                        <p>
                            <a
                                href="/2022/04/15/%E5%A6%82%E4%BD%95%E5%86%99%E5%A5%BD%E5%87%BD%E6%95%B0/#post-footer"
                                class="postShorten-excerpt_link link"
                                aria-label=""
                            >
                                Comment and share
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title">
                    
                        <a
                            class="link-unstyled"
                            href="/2022/04/11/%E8%AE%A4%E8%AF%86JUnit-5/"
                            aria-label=": 认识JUnit 5"
                        >
                            认识JUnit 5
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time datetime="2022-04-11T18:51:36+00:00">
	
		    Apr 11, 2022
    	
    </time>
    
        <span>in </span>
        
    <a class="category-link" href="/categories/Unit-Test/">Unit Test</a>


    
</div>

            </div>
            
                <div class="postShorten-content">
                    <h3 id="JUnit-核心组件"><a href="#JUnit-核心组件" class="headerlink" title="JUnit 核心组件"></a>JUnit 核心组件</h3><p>JUnit框架主要有三个核心组件：</p>
<h4 id="JUnit-Platform"><a href="#JUnit-Platform" class="headerlink" title="JUnit Platform"></a>JUnit Platform</h4><blockquote>
<p>提供在Jvm上启动测试框架的核心基础，是JUnit和客户端（包含构建工具Maven 或者Gradle或者Eclipse和IntelliJ）之间的接口。它采用了一种可以让外部工具发现，过滤和执行测试的称为“Launcher”的概念。</p>
</blockquote>
<p>它还提供了用于开发在JUnit平台上运行测试框架的TestEngine API。使用TestEngine API，Spock,Cucumber和FitNesse第三方测试库可以直接植入和提供他们自定义的TestEngine。</p>
<h4 id="JUnit-Jupiter"><a href="#JUnit-Jupiter" class="headerlink" title="JUnit Jupiter"></a>JUnit Jupiter</h4><p>它为在 JUnit 5 中编写测试和扩展提供了新的编程模型和扩展模型。它有一个全新的注解，用于在 JUnit 5 中编写测试用例。其中一些注解是<code>@BeforeEach</code>、<code>@AfterEach</code>、<code>@AfterAll</code>、<code>@BeforeAll</code> 等。它实现了 JUnit Platform 提供的 TestEngine API，以便可以运行 JUnit 5 测试。</p>
<h4 id="JUnit-Vintage"><a href="#JUnit-Vintage" class="headerlink" title="JUnit Vintage"></a>JUnit Vintage</h4><p>“Vintage”一词的基本意思是<strong>经典</strong>。因此，该子项目为在 JUnit 4 和 JUnit 3 中编写测试用例提供了广泛的支持。因此，该项目提供了向后兼容性。</p>
<p><img src="https://cdn.jsdelivr.net/gh/wenPKtalk/pictures@master/blog/20220411/20_42/image-20220411204229226.png" alt="image-20220411204229226"></p>
<p>原文链接： <a target="_blank" rel="noopener" href="https://www.educative.io/courses/java-unit-testing-with-junit-5/xV9mMjj74gE">https://www.educative.io/courses/java-unit-testing-with-junit-5/xV9mMjj74gE</a></p>

                    
                        


                    
                    
                        <p>
                            <a
                                href="/2022/04/11/%E8%AE%A4%E8%AF%86JUnit-5/#post-footer"
                                class="postShorten-excerpt_link link"
                                aria-label=""
                            >
                                Comment and share
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title">
                    
                        <a
                            class="link-unstyled"
                            href="/2022/04/11/DDD-%E5%88%9D%E6%8E%A2%E4%B9%8B%E7%9B%B8%E5%85%B3%E6%A6%82%E5%BF%B5/"
                            aria-label=": DDD 初探之相关概念"
                        >
                            DDD 初探之相关概念
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time datetime="2022-04-11T17:59:10+00:00">
	
		    Apr 11, 2022
    	
    </time>
    
        <span>in </span>
        
    <a class="category-link" href="/categories/Architecture/">Architecture</a>


    
</div>

            </div>
            
                <div class="postShorten-content">
                    <h3 id="DDD是什么"><a href="#DDD是什么" class="headerlink" title="DDD是什么"></a>DDD是什么</h3><ol>
<li>DDD并不是一种技术架构，而是一种划分业务领域范围的方法论。</li>
<li>DDD不是一种架构，<strong>而是一种架构方法论</strong>，目的就是将复杂问题领域简单化，帮助我们设计出清晰的领域和边界，可以很好的实现技术架构的演进。</li>
</ol>
<p><strong>DDD 包括战略设计和战术设计两部分。</strong></p>
<ol>
<li><strong>DDD战略部分</strong>：<strong>战略设计主要从业务视角出发</strong>，建立业务领域模型，划分领域边界，建立通用语言的限界上下文，限界上下文可以作为微服务设计的参考边界。</li>
<li><strong>DDD战术部分</strong>：<strong>战术设计则从技术视角出发</strong>，侧重于领域模型的技术实现，完成软件开发和落地，包括：聚合根、实体、值对象、领域服务、应用服务和资源库等代码逻辑的设计和实现。</li>
</ol>
<h3 id="DDD与微服务"><a href="#DDD与微服务" class="headerlink" title="DDD与微服务"></a>DDD与微服务</h3><p><strong>DDD 是一种架构设计方法，微服务是一种架构风格</strong>，两者从本质上都是为了追求高响应力，而从 <strong>业务视角</strong> 去分离应用系统建设复杂度的手段。两者都强调从业务出发，其核心要义是强调根据业务发展，合理划分领域边界，持续调整现有架构，优化现有代码，以保持架构和代码的生命力，也就是我们常说的演进式架构。</p>
<ul>
<li>DDD 主要关注：从业务领域视角划分领域边界，构建通用语言进行高效沟通，通过业务抽象，建立领域模型，维持业务和代码的逻辑一致性。</li>
<li>微服务主要关注：运行时的进程间通信、容错和故障隔离，实现去中心化数据管理和去中心化服务治理，关注微服务的独立开发、测试、构建和部署。</li>
</ul>
<h3 id="实践步骤："><a href="#实践步骤：" class="headerlink" title="实践步骤："></a>实践步骤：</h3><p>第一步：在事件风暴中梳理业务过程中的用户操作、事件以及外部依赖关系等，根据这些要素梳理出领域实体等领域对象。</p>
<p>第二步：根据领域实体之间的业务关联性，将业务紧密相关的实体进行组合形成聚合，同时确定聚合中的聚合根、值对象和实体。在这个图里，聚合之间的边界是第一层边界，它们在同一个微服务实例中运行，这个边界是逻辑边界，所以用虚线表示。</p>
<p>第三步：根据业务及语义边界等因素，将一个或者多个聚合划定在一个限界上下文内，形成领域模型。在这个图里，限界上下文之间的边界是第二层边界，这一层边界可能就是未来微服务的边界，不同限界上下文内的领域逻辑被隔离在不同的微服务实例中运行，物理上相互隔离，所以是物理边界，边界之间用实线来表示。</p>
<p><img src="https://cdn.jsdelivr.net/gh/wenPKtalk/pictures@master/blog/20220411/18_31/image-20220411183114240.png" alt="image-20220411183114240"></p>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>DDD可以理解为：ddd 是一个事件风暴 （分类划分），进而知道组织划分（也就是中台）、系统划分（微服务）、代码划分/设计的思想方法</p>

                    
                        


                    
                    
                        <p>
                            <a
                                href="/2022/04/11/DDD-%E5%88%9D%E6%8E%A2%E4%B9%8B%E7%9B%B8%E5%85%B3%E6%A6%82%E5%BF%B5/#post-footer"
                                class="postShorten-excerpt_link link"
                                aria-label=""
                            >
                                Comment and share
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title">
                    
                        <a
                            class="link-unstyled"
                            href="/2022/04/07/Java%E5%A6%82%E4%BD%95%E7%BB%99%E6%96%AD%E8%A8%80%E9%9B%86%E5%90%88%E7%BB%93%E6%9E%9C%E9%9B%86/"
                            aria-label=": Java如何断言集合结果集"
                        >
                            Java如何断言集合结果集
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time datetime="2022-04-07T10:46:27+00:00">
	
		    Apr 07, 2022
    	
    </time>
    
        <span>in </span>
        
    <a class="category-link" href="/categories/Unit-Test/">Unit Test</a>


    
</div>

            </div>
            
                <div class="postShorten-content">
                    <h3 id="场景"><a href="#场景" class="headerlink" title="场景"></a>场景</h3><p>当被测试方法返回结果是集合，我们应该使用哪个断言，如果一个一个元素比较会比较麻烦。所以使用其他包下的断言。</p>
<h3 id="代码示例"><a href="#代码示例" class="headerlink" title="代码示例"></a>代码示例</h3><p>被测试代码如下，是一组经典的合并两个Map&lt;String, List<Object>&gt;的代码(可以直接使用当成工具方法，注意引入Guava包)：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> Map&lt;String, List&lt;Object&gt;&gt; <span class="title function_">mergeTwoGroupedMapCollection</span><span class="params">(Map&lt;String, List&lt;Object&gt;&gt; groupedCollectionOne,</span></span><br><span class="line"><span class="params">                                                     Map&lt;String, List&lt;Object&gt;&gt; groupedCollectionTwo)</span> &#123;</span><br><span class="line">        Map&lt;String, List&lt;Object&gt;&gt; mapGlobal = Maps.newHashMap();</span><br><span class="line">        mapGlobal.putAll(groupedCollectionOne);</span><br><span class="line">        groupedCollectionTwo.forEach((k, v) -&gt; mapGlobal.merge(k, v, (v1, v2) -&gt; &#123;</span><br><span class="line">            List&lt;Object&gt; data = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;(v1);</span><br><span class="line">            data.addAll(v2);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;(data);</span><br><span class="line">        &#125;));</span><br><span class="line">        <span class="keyword">return</span> mapGlobal;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>



<p>测试如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.junit.jupiter.api.Assertions.assertAll;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.junit.jupiter.api.Assertions.assertIterableEquals;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="meta">@DisplayName(&quot;should merge multiple map when given two map has grouped by&quot;)</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">mergeTwoGroupedMapCollection</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">MergedCollection</span> <span class="variable">mergedCollection</span> <span class="operator">=</span> MergedCollection.builder().build();</span><br><span class="line">        Map&lt;String, List&lt;Object&gt;&gt; groupedOne = Maps.newHashMap();</span><br><span class="line">        groupedOne.put(<span class="string">&quot;a&quot;</span>, Lists.newArrayList(<span class="string">&quot;a1&quot;</span>, <span class="string">&quot;a2&quot;</span>, <span class="string">&quot;a3&quot;</span>));</span><br><span class="line">        groupedOne.put(<span class="string">&quot;b&quot;</span>, Lists.newArrayList(<span class="string">&quot;b1&quot;</span>, <span class="string">&quot;b2&quot;</span>, <span class="string">&quot;b3&quot;</span>));</span><br><span class="line">        groupedOne.put(<span class="string">&quot;c&quot;</span>, Lists.newArrayList(<span class="string">&quot;c1&quot;</span>, <span class="string">&quot;c2&quot;</span>, <span class="string">&quot;c3&quot;</span>));</span><br><span class="line"></span><br><span class="line">        Map&lt;String, List&lt;Object&gt;&gt; groupedTwo = Maps.newHashMap();</span><br><span class="line">        groupedTwo.put(<span class="string">&quot;c&quot;</span>, Lists.newArrayList(<span class="string">&quot;c3&quot;</span>, <span class="string">&quot;c4&quot;</span>, <span class="string">&quot;c5&quot;</span>, <span class="string">&quot;c6&quot;</span>, <span class="string">&quot;c7&quot;</span>));</span><br><span class="line"></span><br><span class="line">        Map&lt;String, List&lt;Object&gt;&gt; newGrouped = mergedCollection.mergeTwoGroupedMapCollection(groupedOne, groupedTwo);</span><br><span class="line">        List&lt;Object&gt; except_a = ImmutableList.of(<span class="string">&quot;a1&quot;</span>, <span class="string">&quot;a2&quot;</span>, <span class="string">&quot;a3&quot;</span>);</span><br><span class="line">        List&lt;Object&gt; except_b = ImmutableList.of(<span class="string">&quot;b1&quot;</span>, <span class="string">&quot;b2&quot;</span>, <span class="string">&quot;b3&quot;</span>);</span><br><span class="line">        List&lt;Object&gt; except_c = ImmutableList.of(<span class="string">&quot;c1&quot;</span>, <span class="string">&quot;c2&quot;</span>, <span class="string">&quot;c3&quot;</span>, <span class="string">&quot;c3&quot;</span>, <span class="string">&quot;c4&quot;</span>, <span class="string">&quot;c5&quot;</span>, <span class="string">&quot;c6&quot;</span>, <span class="string">&quot;c7&quot;</span>);</span><br><span class="line">        assertAll(<span class="string">&quot;all elements&quot;</span>,</span><br><span class="line">                ()-&gt;assertIterableEquals(except_a, newGrouped.get(<span class="string">&quot;a&quot;</span>)),</span><br><span class="line">                ()-&gt;assertIterableEquals(except_b, newGrouped.get(<span class="string">&quot;b&quot;</span>)),</span><br><span class="line">                ()-&gt;assertIterableEquals(except_c, newGrouped.get(<span class="string">&quot;c&quot;</span>))</span><br><span class="line">        );</span><br></pre></td></tr></table></figure>



<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>对于这种工具性的方法，必须添加更小粒度的测试。以便于在重构的时候能够保证代码正确性，和理解上下文逻辑。哪如果是私有方法呢？<strong>测试大于封装</strong></p>

                    
                        


                    
                    
                        <p>
                            <a
                                href="/2022/04/07/Java%E5%A6%82%E4%BD%95%E7%BB%99%E6%96%AD%E8%A8%80%E9%9B%86%E5%90%88%E7%BB%93%E6%9E%9C%E9%9B%86/#post-footer"
                                class="postShorten-excerpt_link link"
                                aria-label=""
                            >
                                Comment and share
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title">
                    
                        <a
                            class="link-unstyled"
                            href="/2022/04/04/java%E5%A6%82%E4%BD%95%E5%88%A9%E7%94%A8Mockito%E5%86%99%E5%A5%BD%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95/"
                            aria-label=": java如何利用Mockito写好单元测试"
                        >
                            java如何利用Mockito写好单元测试
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time datetime="2022-04-04T23:31:48+00:00">
	
		    Apr 04, 2022
    	
    </time>
    
        <span>in </span>
        
    <a class="category-link" href="/categories/Unit-Test/">Unit Test</a>


    
</div>

            </div>
            
                <div class="postShorten-content">
                    <h3 id="老生常谈之什么是单元测试"><a href="#老生常谈之什么是单元测试" class="headerlink" title="老生常谈之什么是单元测试"></a>老生常谈之什么是单元测试</h3><ol>
<li>单元测试是低级的，专注于软件系统的最小部分。</li>
<li>单元测试是程序员自己使用某种测试框架来编写的。</li>
<li>对于单元测试的期望是运行速度比其它的测试要更快。<br><a target="_blank" rel="noopener" href="https://martinfowler.com/bliki/UnitTest.html">原文参照Martin Fowler博文</a></li>
</ol>
<h3 id="Unit-Test和TDD的关系"><a href="#Unit-Test和TDD的关系" class="headerlink" title="Unit Test和TDD的关系"></a>Unit Test和TDD的关系</h3><ol>
<li><p>TDD中的T到底是不是Unit Test 存争议，有的人说也可以是集成测试。以下是google测试经理的一段话：</p>
<blockquote>
<p><strong>段念</strong>：把 TDD 等同于单元测试，认为 TDD 只是“提前写单元测试”这种想法应该是很多不太了解 TDD 的人容易犯的错误吧。如果把 TDD 放到敏捷开发的大背景下，我倒不觉得 TDD 有什么明显的不足，但如果单独考量 TDD 在企业中的实践，TDD 技术本身不关注代码的质量应该是一个明显的问题。应用 TDD 的企业通常需要采用持续的 Code Review 和 Refactory 方法保证通过 TDD 产生的代码的质量。</p>
</blockquote>
</li>
</ol>
<p>原文链接：<a target="_blank" rel="noopener" href="https://www.infoq.cn/article/virtual-panel-tdd/">https://www.infoq.cn/article/virtual-panel-tdd/</a></p>
<ol start="2">
<li>还有一段话我觉得比较好，下来总结下。<ul>
<li>TDD 并不是石头里蹦出来的孙悟空，DBC（Design By Contract）可以看作是 TDD 的前身。在 DBC 的观点里，设计应该以规约（Contract）的形势体现，规约定义了被开发对象的行为。</li>
<li>TDD 中的 T，在表现形式上是“测试”，但其实，它更应该被理解为“对被实现对象”的行为限定，也就是 DBC 中的规约。</li>
<li>“测试”只是用来体现规约的形式。 单元测试通常被定义为“对应用最小组成单位的测试”，它的测试对象通常是函数或是类，在对类的设计和实现应用 TDD 时，为类建立的测试通常与类的单元测试相当类似，因此 TDD 中的 T 往往被误认为是单元测试本身。</li>
<li>TDD 中的 T 描述的是规约，是设计的一部分；</li>
<li>其次，TDD 中的 T 并不明确要求 T 对实现代码的覆盖率；</li>
<li>第三，TDD 的 T 的侧重点是“描述被实现对象应该具有的行为”，而不仅仅是“验证该类的行为是否正确”。</li>
<li>第三，TDD 的 T 的侧重点是“描述被实现对象应该具有的行为”，而不仅仅是“验证该类的行为是否正确”。当然，TDD 中的 T 在形式上是测试，在重构中也可以作为被实现对象的行为验证框架。</li>
<li>单元测试、集成测试、系统测试、用户验收测试是基于传统软件开发过程的划分，在传统软件开发观点中，这几类测试不仅意味这测试对象的不同，同样也以为着不同的测试在开发周期中处于不同的位置。但在敏捷开发中，如果继续使用这几个名词，最多也只能保留它们在测试对象方面的含义。对于 TDD 来说（ATDD 和 BDD 可以认为是 TDD 的变体），在不同的测试类别中都可以应用之，唯一的区别在于 T 面向的对象不同。</li>
</ul>
</li>
</ol>
<h3 id="测试框架Mockito-和-PowerMock介绍"><a href="#测试框架Mockito-和-PowerMock介绍" class="headerlink" title="测试框架Mockito 和 PowerMock介绍"></a>测试框架Mockito 和 PowerMock介绍</h3><ol>
<li>Mockito可以让你写出优雅、简洁的单元测试代码。Mockito采用了模拟技术，模拟了一些在应用中依赖的复杂对象，从而把测试对象和依赖对象隔离开来。</li>
<li>PowerMock是在其他单元测试框架的基础上做了增强。<strong>PowerMock实现了对静态方法、构造方法、私有方法以及final方法的模拟支持等强大功能。</strong> 但是实现方式是通过提供定制的类加载器以及一些字节码篡改技术，会导致部分单元测试用例不会被覆盖率检测工具检测到，所以迫不得已不推荐使用。</li>
</ol>
<h3 id="利用Spring-搭配-Mockito-编写单元测试"><a href="#利用Spring-搭配-Mockito-编写单元测试" class="headerlink" title="利用Spring 搭配 Mockito 编写单元测试"></a>利用Spring 搭配 Mockito 编写单元测试</h3><ol>
<li><p>如下一个典型的用户service服务。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserDao userDao;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*Id 生成器*/</span></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> IdGenerator idGenerator;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 配置参数</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;userService.canModify&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Boolean canModify;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 创建用户</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> userCreate 用户创建</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 用户标识</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> Long <span class="title function_">createUser</span><span class="params">(UserVO userCreate)</span> &#123;</span><br><span class="line">        <span class="comment">// 获取用户标识</span></span><br><span class="line">        <span class="type">Long</span> <span class="variable">userId</span> <span class="operator">=</span> userDAO.getIdByName(userCreate.getName());</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 根据存在处理</span></span><br><span class="line">        <span class="comment">// 根据存在处理: 不存在则创建</span></span><br><span class="line">        <span class="keyword">if</span> (Objects.isNull(userId)) &#123;</span><br><span class="line">            userId = idGenerator.next();</span><br><span class="line">            <span class="type">UserDO</span> <span class="variable">create</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UserDO</span>();</span><br><span class="line">            create.setId(userId);</span><br><span class="line">            create.setName(userCreate.getName());</span><br><span class="line">            userDAO.create(create);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 根据存在处理: 已存在可修改</span></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (Boolean.TRUE.equals(canModify)) &#123;</span><br><span class="line">            <span class="type">UserDO</span> <span class="variable">modify</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UserDO</span>();</span><br><span class="line">            modify.setId(userId);</span><br><span class="line">            modify.setName(userCreate.getName());</span><br><span class="line">            userDAO.modify(modify);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 根据存在处理: 已存在禁修改</span></span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">UnsupportedOperationException</span>(<span class="string">&quot;不支持修改&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 返回用户标识</span></span><br><span class="line">        <span class="keyword">return</span> userId;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><p>针对以上service服务在编写单元测试时，针对它的依赖userDao, idGenerator, canModify我们采用stub来预设存根。这样可以保证我们service只测试自己的逻辑。</p>
</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ExtendWith(MockitoExtension.class)</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">UserServiceTest</span> &#123;</span><br><span class="line">     <span class="comment">/** 模拟依赖对象 */</span></span><br><span class="line">    <span class="comment">/** 用户DAO */</span></span><br><span class="line">    <span class="meta">@Mock</span></span><br><span class="line">    <span class="keyword">private</span> UserDAO userDAO;</span><br><span class="line">    <span class="comment">/** 标识生成器 */</span></span><br><span class="line">    <span class="meta">@Mock</span></span><br><span class="line">    <span class="keyword">private</span> IdGenerator idGenerator;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** 定义被测对象 */</span></span><br><span class="line">    <span class="comment">/** 用户服务 */</span></span><br><span class="line">    <span class="meta">@InjectMocks</span></span><br><span class="line">    <span class="keyword">private</span> UserService userService;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 在测试之前</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Before</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">beforeTest</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// 注入依赖对象</span></span><br><span class="line">        ReflectionTestUtils.setField(Boolean.class, <span class="string">&quot;canModify&quot;</span>, <span class="literal">false</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">  *测试方法</span></span><br><span class="line"><span class="comment">  *也可以使用 <span class="doctag">@Display</span> 来标注测试方法名称。保证从测试方法名称中能读懂测试的目的，和简单的上下文。</span></span><br><span class="line"><span class="comment">  * 注意此处的Test引用jupiter提供的注解。不然会有注入的空指针</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line">  <span class="meta">@Test</span>  </span><br><span class="line">  <span class="keyword">void</span> <span class="title function_">should_createUserWithNew_givenInfo_WhenNotExisted</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="comment">//given data; stub</span></span><br><span class="line">    <span class="keyword">when</span>(userDAO).getIdByName(any()).thenReturn(<span class="literal">null</span>);</span><br><span class="line">    <span class="type">Long</span> <span class="variable">userId</span> <span class="operator">=</span> <span class="number">1L</span>;</span><br><span class="line">    <span class="keyword">when</span>(idGenerator).next().thenReturn(userId);</span><br><span class="line">    <span class="type">UserVO</span> <span class="variable">userCreate</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UserVo</span>(***,***,***);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//when</span></span><br><span class="line">    <span class="type">Long</span> <span class="variable">acturalUserId</span> <span class="operator">=</span> userService.createUser(userCreate);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//then</span></span><br><span class="line">    assertEquals(userId, acturalUserId);</span><br><span class="line">    <span class="comment">// 验证依赖方法</span></span><br><span class="line">    <span class="comment">// 验证依赖方法: userDAO.getByName</span></span><br><span class="line">   Mockito.verify(userDAO).getIdByName(userCreate.getName());</span><br><span class="line">   <span class="comment">// 验证依赖方法: idGenerator.next</span></span><br><span class="line">   Mockito.verify(idGenerator).next();</span><br><span class="line">   <span class="comment">// 验证依赖方法: userDAO.create</span></span><br><span class="line">   ArgumentCaptor &lt;UserDO&gt; userCreateCaptor = ArgumentCaptor.forClass(UserDO.class);</span><br><span class="line">   Mockito.verify(userDAO).create(userCreateCaptor.capture());</span><br><span class="line">   <span class="comment">// 验证依赖对象</span></span><br><span class="line">   Mockito.verifyNoMoreInteractions(idGenerator, userDAO);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">should_updateUser_givenUser_whenHasExisted</span><span class="params">()</span>&#123;</span><br><span class="line">  <span class="comment">//只需要stub此处修改，然后进行已存在断言</span></span><br><span class="line">  <span class="type">Long</span> <span class="variable">userId</span> <span class="operator">=</span> <span class="number">1L</span>;</span><br><span class="line">  <span class="keyword">when</span>(userDAO).getIdByName(any()).thenReturn(userId);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">//then</span></span><br><span class="line">  ....</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">should_exception_givenInvalid</span><span class="params">()</span>&#123;</span><br><span class="line">  <span class="comment">//then 断言采用Junit 5提供的</span></span><br><span class="line">  Assert.assertThrows(<span class="string">&quot;返回异常不一致&quot;</span>,</span><br><span class="line">            UnsupportedOperationException.class, () -&gt; userService.createUser(userCreate))</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="如何测试Controller"><a href="#如何测试Controller" class="headerlink" title="如何测试Controller"></a>如何测试Controller</h3><ol>
<li>保证Api层的访问状态是成功的</li>
<li>保证入参校验逻辑是可通过的。</li>
<li>与Service测试不同的是我们要启动web服务，所以必须启动spring容器。但是为了可测service服务我们还是利用Stub技术给出预期返回值。</li>
<li>利用Spring 提供的@Import({*****.class}}指定我们容器中需要的类，可以方便的避免容器需要加载所有bean很慢的尴尬。</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@WebMvcTest(controllers = UserController.class, useDefaultFilters = false)</span></span><br><span class="line"><span class="meta">@Import(&#123;UserController.class,</span></span><br><span class="line"><span class="meta">        AopAutoConfiguration.class,</span></span><br><span class="line"><span class="meta">        DependenceService.class&#125;)</span></span><br><span class="line"><span class="meta">@ActiveProfiles(&quot;test&quot;)</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">UserControllerTest</span> <span class="keyword">extends</span> <span class="title class_">ControllerBaseTest</span> &#123;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">  *利用Import和Autowired可以将真是的bean在运行测试的时候注入进来。会调用真是的方法。</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line">    <span class="meta">@Autowired</span> </span><br><span class="line">    <span class="keyword">private</span> MockMvc mvc;</span><br><span class="line">  </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> DependenceService service;</span><br><span class="line">  </span><br><span class="line">    <span class="meta">@MockBean</span></span><br><span class="line">    <span class="keyword">private</span> UserService service;</span><br><span class="line">  </span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">should_200_when_create</span><span class="params">()</span> &#123;</span><br><span class="line">      <span class="type">Long</span> <span class="variable">userId</span> <span class="operator">=</span> <span class="number">1L</span>;</span><br><span class="line">      <span class="keyword">when</span>(service.createUser(any())).thenReturn(userId);</span><br><span class="line">      </span><br><span class="line">      <span class="comment">//when</span></span><br><span class="line">      mvc.perform(MockMvcRequestBuilders.post(<span class="string">&quot;/user&quot;</span>)</span><br><span class="line">                        .content(jsonString) <span class="comment">//given data</span></span><br><span class="line">                        .header(<span class="string">&quot;X-TIME-ZONE&quot;</span>, <span class="string">&quot;Asia/Shanghai&quot;</span>)</span><br><span class="line">                        .with(csrf())</span><br><span class="line">                        .contentType(MediaType.APPLICATION_JSON))</span><br><span class="line">                .andExpect(status().isOk());<span class="comment">//then</span></span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="5">
<li><p>使用ArgumentCaptor验证代码中间被stub掉方法的参数.</p>
<p>存在一种情况我们给serviceA中的methodA写单元测试的过程中，发现调用了serviceB的methodB方法，并且为serviceB方法new 了一个ObjectA对象作为调用serviceB.methodB的参数，如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ServiceA</span> &#123;</span><br><span class="line">  <span class="meta">@Autowired</span></span><br><span class="line">  <span class="keyword">public</span> ServiceB serviceB</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">methodA</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    * 其它业务代码 </span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">3</span>; i++ )&#123;</span><br><span class="line">    	<span class="type">ObjectA</span> <span class="variable">objA</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectA</span>();</span><br><span class="line">      <span class="type">ObjcetB</span> <span class="variable">objB</span> <span class="operator">=</span> serviceB.methodB(<span class="string">&quot;hello&quot;</span>, objA);  </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    * 其它业务代码 </span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    </span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>此时在测试 methodA的时候，需要使用测试替身代替真实的serviceB.methodB(objA);调用，这个时候我们不能使用 Mockito.when(serviceB.methodB(eq(“hello”), eq(new ObjectA())))来进行替换，因为new出来的对象是不同的对象所以stub不住。这个时候应该使用使用ArgumentCaptor进行捕获后验证，如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">ArgumentCaptor&lt;ObjectA&gt; objACaptor = ArgumentCaptor.forClass(ObjectA.class);</span><br><span class="line"><span class="comment">//利用mockito.when().thenReturn()返回多个对象来stub循环中的三方调用</span></span><br><span class="line">Mockito.<span class="keyword">when</span>(serviceB.methodB(eq(<span class="string">&quot;hello&quot;</span>), objACaptor.caputre())).thenReturn(objB1, obj2, obj3);</span><br><span class="line"><span class="comment">//然后获取三次captor捕获的三个参数进行验证。</span></span><br><span class="line">List&lt;ObjectA&gt; objAs = objACaptor.getValues();</span><br><span class="line"><span class="comment">//验证三次参数</span></span><br><span class="line">Assertions.assertEquals(objAs(<span class="number">0</span>), objB1);</span><br><span class="line">Assertions.assertEquals(objAs(<span class="number">1</span>), objB2);</span><br><span class="line">Assertions.assertEquals(objAs(<span class="number">2</span>), objB2);</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ol>
<h3 id="相关链接"><a href="#相关链接" class="headerlink" title="相关链接"></a>相关链接</h3><p>Java编程技巧之单元测试用例编写流程：<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/371759603">https://zhuanlan.zhihu.com/p/371759603</a></p>
<p>谈一谈单元测试：<a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/ioya1kzdTGPB0oOZ3DUmig">https://mp.weixin.qq.com/s/ioya1kzdTGPB0oOZ3DUmig</a></p>

                    
                        


                    
                    
                        <p>
                            <a
                                href="/2022/04/04/java%E5%A6%82%E4%BD%95%E5%88%A9%E7%94%A8Mockito%E5%86%99%E5%A5%BD%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95/#post-footer"
                                class="postShorten-excerpt_link link"
                                aria-label=""
                            >
                                Comment and share
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title">
                    
                        <a
                            class="link-unstyled"
                            href="/2022/02/11/Remove-if-else-by-Enum/"
                            aria-label=": Remove if...else...by Enum"
                        >
                            Remove if...else...by Enum
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time datetime="2022-02-11T14:42:27+00:00">
	
		    Feb 11, 2022
    	
    </time>
    
        <span>in </span>
        
    <a class="category-link" href="/categories/Clean-Code/">Clean Code</a>


    
</div>

            </div>
            
                <div class="postShorten-content">
                    <h1 id="消除if-else之为Enum添加行为"><a href="#消除if-else之为Enum添加行为" class="headerlink" title=" 消除if-else之为Enum添加行为 "></a><center> 消除if-else之为Enum添加行为 </center></h1><h2 id="场景描述"><a href="#场景描述" class="headerlink" title="场景描述"></a>场景描述</h2><p>Java提供枚举类给了开发者更可读的代码实现，我们可以将很多字段作为枚举类型。并且赋予枚举类行为，可以省略掉根据枚举类判断而实现不同行为的众多if…else…</p>
<blockquote>
<p>如下是根据参数而下载不同类型的文件的枚举代码，给每个枚举类型添加了响应的代码</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> <span class="title class_">DownloadFileType</span> &#123;</span><br><span class="line">    CSV &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">writeToLocal</span><span class="params">()</span> &#123;</span><br><span class="line">            exportUtil.writeCsv();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    EXCEL &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">writeToLocal</span><span class="params">()</span> &#123;</span><br><span class="line">            exportUtil.writeExcel();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title function_">writeToLocal</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> DownloadFileType <span class="title function_">of</span><span class="params">(String fileType)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> Arrays.stream(DownloadFileType.values())</span><br><span class="line">                .filter(type -&gt; type.toString().equals(fileType.toUpperCase(Locale.ROOT)))</span><br><span class="line">                .findFirst()</span><br><span class="line">                .orElse(EXCEL);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>调用方可以免除掉if…else  只需要获取到下载的类型来执行不同的写入。</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//write to local tmp dir</span></span><br><span class="line"><span class="comment">//fileType: &quot;excel&quot; or &quot;csv&quot;</span></span><br><span class="line">DownloadFileType.of(fileType).writeToLocal();</span><br><span class="line">    </span><br></pre></td></tr></table></figure>

<h3 id="代码训练"><a href="#代码训练" class="headerlink" title="代码训练"></a>代码训练</h3><p>附上我之前实现一个case的代码链接</p>
<p><a target="_blank" rel="noopener" href="https://github.com/wenPKtalk/loofah">https://github.com/wenPKtalk/loofah</a></p>

                    
                        


                    
                    
                        <p>
                            <a
                                href="/2022/02/11/Remove-if-else-by-Enum/#post-footer"
                                class="postShorten-excerpt_link link"
                                aria-label=""
                            >
                                Comment and share
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title">
                    
                        <a
                            class="link-unstyled"
                            href="/2022/01/11/read-me/"
                            aria-label=": About this blog"
                        >
                            About this blog
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time datetime="2022-01-11T14:42:27+00:00">
	
		    Jan 11, 2022
    	
    </time>
    
        <span>in </span>
        
    <a class="category-link" href="/categories/Tools/">Tools</a>


    
</div>

            </div>
            
                <div class="postShorten-content">
                    <p>Welcome to <a target="_blank" rel="noopener" href="https://hexo.io/">Hexo</a>! This is your very first post. Check <a target="_blank" rel="noopener" href="https://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a target="_blank" rel="noopener" href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a target="_blank" rel="noopener" href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p>
<h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Manage-branches"><a href="#Manage-branches" class="headerlink" title="Manage branches"></a>Manage branches</h3><ul>
<li><p>Just update view</p>
</li>
<li><p>Code source: main</p>
</li>
<li><p>Static file: gh-pages</p>
</li>
</ul>
<h3 id="Install-all-dependents"><a href="#Install-all-dependents" class="headerlink" title="Install all dependents"></a>Install all dependents</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ npm install</span><br><span class="line">$ <span class="built_in">cd</span> themes/tranquilpeak</span><br><span class="line">$ npm install &amp;&amp; npm run prod</span><br></pre></td></tr></table></figure>

<h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">&quot;My New Post&quot;</span></span><br></pre></td></tr></table></figure>

<p>More info: <a target="_blank" rel="noopener" href="https://hexo.io/docs/writing.html">Writing</a></p>
<h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure>

<p>More info: <a target="_blank" rel="noopener" href="https://hexo.io/docs/server.html">Server</a></p>
<h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ hexo clean</span><br><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure>

<p>More info: <a target="_blank" rel="noopener" href="https://hexo.io/docs/generating.html">Generating</a></p>
<h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure>

<p>More info: <a target="_blank" rel="noopener" href="https://hexo.io/docs/one-command-deployment.html">Deployment</a></p>

                    
                        


                    
                    
                        <p>
                            <a
                                href="/2022/01/11/read-me/#post-footer"
                                class="postShorten-excerpt_link link"
                                aria-label=""
                            >
                                Comment and share
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title">
                    
                        <a
                            class="link-unstyled"
                            href="/2021/11/28/%E4%B8%BA%E4%BB%80%E4%B9%88SOLID%E4%BB%8D%E7%84%B6%E6%98%AF%E7%8E%B0%E4%BB%A3%E8%BD%AF%E4%BB%B6%E6%9E%B6%E6%9E%84%E7%9A%84%E5%9F%BA%E7%9F%B3/"
                            aria-label=": 为什么SOLID仍然是现代软件架构的基石"
                        >
                            为什么SOLID仍然是现代软件架构的基石
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time datetime="2021-11-28T11:26:13+00:00">
	
		    Nov 28, 2021
    	
    </time>
    
        <span>in </span>
        
    <a class="category-link" href="/categories/Architecture/">Architecture</a>


    
</div>

            </div>
            
                <div class="postShorten-content">
                    <h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><p>最近20年软件设计发生了天翻地覆的变化，但是SOLID原则至今仍然是软件设计的最佳实践。</p>
<p>SOLID 原则对于对于创建高质量软件是久经测试的标题。但是在现代多范式编程（函数式编程等）和云计算兴起的年代，它依然能够坚挺吗？我将通过如下文章解释SOLID代表了什么，为什么它依然适用现代软件，并且分享一些例子来解释。</p>
<h2 id="什么是SOLID"><a href="#什么是SOLID" class="headerlink" title="什么是SOLID"></a>什么是SOLID</h2><p>SOLID是Robert C. Martin在2000年提取出来的一系列原则。它被建议去作为面向对象（OO）编程质量的特殊思考方式。总得来讲SOLID在这几个方面：代码如何切分，代码私有和对外暴露，代码之间如何调用提出了建议。我下面将深入研究每个字母（S.O.L.I.D）的原始含义，并且扩展到面向对象编程之外的使用。</p>
<h2 id="有哪些改变？"><a href="#有哪些改变？" class="headerlink" title="有哪些改变？"></a>有哪些改变？</h2><p>21世纪早期，是Java和C++称霸的时期，理所当然我的大学很多课程都使用Java语言来当作训练。Java的流行催生出来了一些书籍，课程 和其它资料使得人们从写代码过度到写出好的代码。</p>
<p>因此，软件工业发生了深远的影响。有几个值得注意的点：</p>
<ul>
<li>**动态类型语言（Dynamically-typed languages） ** 比如 Python，Ruby, 尤其JavaScript 变的和Java一样流行—甚至在某些行业和某类公司已经超过了Java</li>
<li><strong>非面向对象范式（Non-object-oriented paradigms）</strong> 最值得注意的是函数式编程（FP），在这些新语言中也比较常见。甚至Java本身也引入了lambdas！元编程技术（增加和改变对象的方法和特性）等技术也越来越流行。还有拥有“软面向对象”特征的Go语言，它具有静态类型但是没有继承。所有的这些都表明了现代软件中类和集成没有过去重要。</li>
<li><strong>开源软件（Open-source software）</strong> 的扩散。早期，更多的通用软件是闭源（closed-source）人们使用的都是编译后的软件，现在通常人们依赖的软件都是开源的。因此，在编写库是曾经对必不可少的逻辑和数据隐藏不再哪么重要。</li>
<li><strong>微服务和软件即服务（Saas)</strong> 爆炸式地出现。与其将应用程序部署为将所有依赖项链接在一起的大型可执行文件，不如部署一个与其他服务（自己的活第三方提供支持的服务）调用的小型服务。</li>
</ul>
<p>整体来看，SOLID真正关心的许多事情——例如类和接口，数据隐藏性和多态——不再是程序员每天都要处理的事情。</p>
<h2 id="有什么没发生变化？"><a href="#有什么没发生变化？" class="headerlink" title="有什么没发生变化？"></a>有什么没发生变化？</h2><p>现在工业界有很多不一样了，但是也还有一些东西未发生改变。包括：</p>
<ul>
<li><strong>代码是由人类编写和修改的</strong> 。代码被编写一次并且被读很多很多次。所以对内部和外部需要很好的代码说明文档，尤其很好的API文档。</li>
<li><strong>代码被组织成模块</strong>。在某些语言中，这些是类。在其他情况下，他们可能是单独的源文件。在JavaScript中，它们可能是导出对象。无论如何，总是存在某种方式去隔离和组织代码成为独立，有界的单元。因此，总是需要决定如何最好的将代码组织在一起。</li>
<li><strong>代码可以是内部的或者外部的</strong>。一些编写出来的代码是被你自己或者你的团队使用，一些可能会被其它团队甚至其他顾客通过API的方式使用。这也意味着需要某种方式来决定哪些代码是“可见的”哪些是隐藏的。</li>
</ul>
<h2 id="“现代”SOLID"><a href="#“现代”SOLID" class="headerlink" title="“现代”SOLID"></a>“现代”SOLID</h2><p>在接下来的文章中，我将把SOLID中的每一项原则都表述为更一般的描述，并且说明是如何应用在OO，FP，多范式编程中的，并距离说明。在许多情况下，这些原则甚至可以应用在整个服务或者系统中。</p>
<p>需要注意的是我将使用“模块”代指一组代码，可以是类，包，文件等等。</p>
<h2 id="单一职责-（Single-responsibility-principle）"><a href="#单一职责-（Single-responsibility-principle）" class="headerlink" title="单一职责 （Single responsibility principle）"></a>单一职责 （Single responsibility principle）</h2><p><strong>原始定义：</strong>  “一个类改变的原因不会超过一个”</p>
<p>如果您编写的类有很多关注点或“更改的原因”，那么这些关注点中任何一个需要更改，您就需要更改相同的代码。这增加了对一个特性功能的修改就会破坏另外一个特性功能的可能性。</p>
<p>一个例子，如下是一个永远不应该应用在生产环境的Franken-class:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">FrankenClass</span> &#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">savaUserDetail</span><span class="params">(User user)</span> &#123;</span><br><span class="line">    <span class="comment">//...</span></span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">performOrder</span><span class="params">(Order order)</span> &#123;</span><br><span class="line">    <span class="comment">//...</span></span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">shipItem</span><span class="params">(Item item, String address)</span> &#123;</span><br><span class="line">    <span class="comment">//...</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>新的定义：</strong> “每个模块应该做一件事，并且做好”。</p>
<p>这个原则和高内聚（high cohesion）话题紧密联系。本质上，您的代码不应该将很多角色或者用途混在一起。</p>
<p>如下是使用JavaScript的同一示例的函数式编程（FP）版本：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">saveUserDetails</span> = (<span class="params">user</span>) =&gt; &#123;...&#125;</span><br><span class="line"><span class="keyword">const</span> <span class="title function_">performOrder</span> = (<span class="params">order</span>) =&gt; &#123; ...&#125;</span><br><span class="line"><span class="keyword">const</span> <span class="title function_">shipItem</span> = (<span class="params">item, address</span>) =&gt; &#123; ... &#125;</span><br><span class="line"><span class="keyword">export</span> &#123; saveUserDetails, performOrder, shipItem &#125;;</span><br><span class="line"><span class="keyword">import</span> &#123; saveUserDetails, performOrder, shipItem &#125; <span class="keyword">from</span> <span class="string">&quot;allActions&quot;</span>;                   </span><br></pre></td></tr></table></figure>

<p>这也适用在微服务设计；如果你有一个单独服务来处理所有这三个功能，它就会尝试做太多事情。</p>
<h2 id="开闭原则（Open-closed-principle）"><a href="#开闭原则（Open-closed-principle）" class="headerlink" title="开闭原则（Open-closed principle）"></a>开闭原则（Open-closed principle）</h2><p><strong>原始定义：</strong> “软件实体应该对扩展开放，对修改关闭。”</p>
<p>这也是Java语言设计的一部分—你可以创建一个子类来继承一个类，但是不能去修改原始的类。</p>
<p>“对扩展开放”的原因之一是限制了对类作者的依赖——如果你需要改动一个类，你不得不去等待类的原始作者去修改，或者你深入研究这个类后再去修改。更重要的是这个类承担了太多的关注点这将打破单一职责原则。</p>
<p>“对修改关闭”的原因是我们不相信下游的使用者能够完全理解我们所有的“private”私有代码，我们希望保护它免收不熟练的人的修改带来的损害。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Notifier</span> &#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">notify</span><span class="params">(String message)</span> &#123;</span><br><span class="line">    <span class="comment">//send an e-mail</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">LoggingNotifier</span> <span class="keyword">extends</span> <span class="title class_">Notifier</span> &#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">notify</span><span class="params">(String message)</span> &#123;</span><br><span class="line">    <span class="built_in">super</span>.notify(message);<span class="comment">//keep parent behaiver</span></span><br><span class="line">    <span class="comment">//also log the message;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>新定义：</strong> “应该能够在不重写模块的情况下使用和添加模块”。</p>
<p>这在面向对象领域是免费的（AOP）。在函数式编程代码必须明确定义Hook point以允许修改。这事一个示例，其中不仅仅允许使用前后hooks，而且甚至可以通过将函数传递给您的函数来覆盖其基本行为：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//library code</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">saveRecord</span> = (<span class="params">record, save, beforeSave, afterSave</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">defaultSave</span> = (<span class="params">record</span>) =&gt; &#123;</span><br><span class="line">    <span class="comment">//default save function;</span></span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">if</span> (beforeSave) <span class="title function_">beforeSave</span>(record);</span><br><span class="line">  <span class="keyword">if</span> (save) &#123;</span><br><span class="line">    <span class="title function_">save</span>(record);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="title function_">defaultSave</span>(record);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span>(afterSave) <span class="title function_">afterSave</span>(record);</span><br><span class="line">  <span class="comment">//calling code</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//calling code</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">customSave</span> = (<span class="params">record</span>) =&gt; &#123;...&#125;</span><br><span class="line"><span class="title function_">saveRecord</span>(myRecord, customSave);</span><br></pre></td></tr></table></figure>

<h2 id="里氏替换原则"><a href="#里氏替换原则" class="headerlink" title="里氏替换原则"></a>里氏替换原则</h2><p><strong>原始定义：</strong> “如果类型S是T的子类型，那么类型T可以被替换为S类型而不用修改程序的任何所需属性”。</p>
<p>这也是面向对象语言的基础属性。它意味着你可以使用任意子类替换它们的父类。所以你可以对这一个约定充满信心：你可以安全的使用任何 “is a” type T的对象而像T一样去使用。如下例子：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Vehicle</span> &#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getNumberOfWheels</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">4</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Bicycle</span> <span class="keyword">extends</span> <span class="title class_">Vehicle</span> &#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getNumberOfWheels</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">2</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// calling code</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="variable">COST_PER_TIRE</span> <span class="operator">=</span> <span class="number">50</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">tireCost</span><span class="params">(Vehicle vehicle)</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> COST_PER_TIRE * vehicle.getNumberOfWheels();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">Bicycle</span> <span class="variable">bicycle</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Bicycle</span>();</span><br><span class="line">System.out.println(tireCost(bicycle)); <span class="comment">//100</span></span><br></pre></td></tr></table></figure>

<p> <strong>新定义：</strong> 你可以使用一个东西代替另一个东西只要它们声明的行为方式一样。</p>
<p>在动态语言中，重要的是如果你的程序“promises”去做某些事情（例如实现一个接口或者函数），你需要遵守你的“promises”不要给客户端不符合“promises”的东西。</p>
<p>许多动态语言使用“duck typing”（不知道什么意思 <a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Duck_typing">戳这儿</a> ）去达到这一点。本质上，你的function正式或者非正式的声明它期望其输入以特定方式运行并根据该假设运行。</p>
<p>例如Ruby:</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># <span class="doctag">@param</span> input [#to_s]</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">split_lines</span>(<span class="params">input</span>)</span><br><span class="line">  input.to_s.split(<span class="string">&quot;\n&quot;</span>)</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>

<p>在这个例子中，这个function并不在乎输入类型——只关心它有一个to_s函数，它的行为方式与所有to_s函数的行为方式相同：即把输入变成字符串。许多动态语言没有办法去强制这种行为，因此这更像一种纪律问题而不是一种形式化技术。</p>
<p>接下来是函数式编程TypeScript例子，在这个例子中高阶函数引入了一个过滤器输入一个数字返回一个boolean值：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> isEven = (<span class="attr">x</span>: <span class="built_in">number</span>) : <span class="function"><span class="params">boolean</span> =&gt;</span> x % <span class="number">2</span> == <span class="number">0</span>;</span><br><span class="line"><span class="keyword">const</span> isOdd = (<span class="attr">x</span>: <span class="built_in">number</span>) : <span class="function"><span class="params">boolean</span> =&gt;</span> x % <span class="number">2</span> == <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">printFiltered</span> = (<span class="params"><span class="attr">arr</span>: <span class="built_in">number</span>[], <span class="attr">filterFunc</span>: (int) =&gt; <span class="built_in">boolean</span></span>) =&gt; &#123;</span><br><span class="line">  arr.<span class="title function_">forEach</span>(<span class="function">(<span class="params">item</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_">filterFunc</span>(item)) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(item);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> array = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>];</span><br><span class="line"><span class="title function_">printFiltered</span>(array, isEven);</span><br><span class="line"><span class="title function_">printFiltered</span>(array, isOdd);</span><br></pre></td></tr></table></figure>

<h2 id="接口隔离原则（Interface-segregation-principle）"><a href="#接口隔离原则（Interface-segregation-principle）" class="headerlink" title="接口隔离原则（Interface segregation principle）"></a>接口隔离原则（Interface segregation principle）</h2><p><strong>原始定义：</strong> “许多客户端（client-specific）接口要好于一个通用的（general-purpose）接口。”</p>
<p>在面向对象语言中，你可以理解为是为你的类提供了一个“视图”（view）。与其提供给你一个大而全的实现给你的客户端，而是仅使用与该客户端相关的方法在它们之上创建接口，并要求您的客户端使用这些接口。</p>
<p>正如单一职责原则一样，接口隔离原则隔离了系统之间的耦合，并且确保客户端不需要了解它所依赖的无关功能。</p>
<p>如下例子通过SPR测试：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">PrintRequest</span> &#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">createRequest</span><span class="params">()</span> &#123;&#125;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">deleteRequest</span><span class="params">()</span> &#123;&#125;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">workOnRequest</span><span class="params">()</span> &#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这段代码通常只有一个“原因去更改”——它都与打印请求有关，它们都是同一个域的一部分，并且所有三种方法都可能会更改相同的状态。但是，创建请求的客户端不太可能是处理请求的客户端。将这些接口隔离开会更有意义：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> <span class="title class_">PrintRequestModifier</span> &#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">createRequest</span><span class="params">()</span>;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">deleteRequest</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">PrintRequestWorker</span> &#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">workOnRequest</span><span class="params">()</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">PrintRequest</span> <span class="keyword">implements</span> <span class="title class_">PrintRequestModifier</span>, PrintRequestWorker &#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">createRequest</span><span class="params">()</span> &#123;&#125;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">deleteRequest</span><span class="params">()</span> &#123;&#125;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">workOnRequest</span><span class="params">()</span> &#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>新的定义：</strong> “不要向客户端展示它不需要看到的东西。”</p>
<p>只记录你客户端需要知道的内容。这意味着使用文档生成器只输入“public”function 或路由，而“private”没必要输出。</p>
<p>在微服务时代，你可以使用文档或者真正的隔离增加清晰度。例如，你外部客户可能只能以用户身份登录，但你的内部服务可能获取用户列表或者其他属性。你也可以创建一个单独的“仅限外部”用户服务来调用你的主服务，或者你可以只为隐藏内部路由的外部用户输出特定文档。</p>
<h2 id="依赖倒置原则（Dependency-inversion-principle）"><a href="#依赖倒置原则（Dependency-inversion-principle）" class="headerlink" title="依赖倒置原则（Dependency inversion principle）"></a>依赖倒置原则（Dependency inversion principle）</h2><p><strong>原始定义：</strong> “依赖抽象，而不是依赖具体实现”</p>
<p>在面向对象语言中，这意味着客户端应该尽可能依赖接口而不是具体实现类。这确保了代码应该依赖尽可能小的面积——事实上，客户端不必要依赖所有的代码，只需要依赖一个定义代码应该如何表现的契约。和其它原则一样这降低了修改一处而导致破坏了其它功能的风险。下面的例子：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> <span class="title class_">Logger</span> &#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">write</span><span class="params">(String message)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">FileLogger</span> <span class="keyword">implements</span> <span class="title class_">Logger</span> &#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">write</span><span class="params">(String message)</span> &#123;</span><br><span class="line">    <span class="comment">//write to file</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">StandardOutLogger</span> <span class="keyword">implements</span> <span class="title class_">Logger</span> &#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">write</span><span class="params">(String message)</span> &#123;</span><br><span class="line">    <span class="comment">//write to standard out</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// call</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doStuff</span><span class="params">(Logger logger)</span> &#123;</span><br><span class="line">  <span class="comment">//do stuff</span></span><br><span class="line">  logger.write(<span class="string">&quot;some message&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>如果你正在写的代码需要一个logger， 你不想去限制自己仅仅只是去写入文件中，因为你不在乎。你仅仅只需要调用 write方法而让具体实现去输出。</p>
<p><strong>新的定义：</strong> “依赖抽象，而不是具体实现。”</p>
<p>对的，这个例子我将定义保留原样！保持东西依赖抽象依然是重要的，即使现代代码中的抽象机制不像严格的面向对象世界那样强大。</p>
<p>尤其，这和上面讨论的里氏替换原则是一样的。主要的区别是它没有默认实现。因此，该部分中涉及鸭子类型和钩子函数的讨论通用适用于依赖倒置。</p>
<p>你也可以使用抽象对于微服务。比如，你可以将服务之间的直接通信替换为消息总线活队列平台，例如Kafka或者其他消息中间件。这样允许服务将消息发送到单个通用位置，而无需关心哪个特定服务将接收这些消息并执行其任务。</p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>再次重新梳理“现代SOLID”一次：</p>
<ul>
<li>不要惊讶别人读到你的代码。</li>
<li>不要惊讶别人使用你的代码。</li>
<li>不要让阅读你代码的人感到迷惑。</li>
<li>为你的代码使用合理的边界。</li>
<li>使用正确的耦合级别——尘归尘，土归土。</li>
</ul>
<p>好的代码就是好的代码——从未改变，SOLID也是，实践是坚实的基础。</p>
<p><strong>原文连接：</strong>  <a target="_blank" rel="noopener" href="https://stackoverflow.blog/2021/11/01/why-solid-principles-are-still-the-foundation-for-modern-software-architecture/?utm_source=programmingdigest&amp;utm_medium=web&amp;utm_campaign=447">https://stackoverflow.blog/2021/11/01/why-solid-principles-are-still-the-foundation-for-modern-software-architecture/?utm_source=programmingdigest&amp;utm_medium=web&amp;utm_campaign=447</a></p>

                    
                        


                    
                    
                        <p>
                            <a
                                href="/2021/11/28/%E4%B8%BA%E4%BB%80%E4%B9%88SOLID%E4%BB%8D%E7%84%B6%E6%98%AF%E7%8E%B0%E4%BB%A3%E8%BD%AF%E4%BB%B6%E6%9E%B6%E6%9E%84%E7%9A%84%E5%9F%BA%E7%9F%B3/#post-footer"
                                class="postShorten-excerpt_link link"
                                aria-label=""
                            >
                                Comment and share
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title">
                    
                        <a
                            class="link-unstyled"
                            href="/2021/05/22/%E7%BC%85%E6%80%80%E8%A2%81%E8%80%81/"
                            aria-label=": 缅怀袁老"
                        >
                            缅怀袁老
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time datetime="2021-05-22T20:26:00+00:00">
	
		    May 22, 2021
    	
    </time>
    
        <span>in </span>
        
    <a class="category-link" href="/categories/Daily-Life/">Daily Life</a>


    
</div>

            </div>
            
                <div class="postShorten-content">
                    <p>  今天听闻噩耗，袁隆平院士我们称之为袁老去世了享年 91 岁，随之朋友圈也炸锅了，大家都在缅怀，悼念。</p>
<p>  不得不说袁老对人类的贡献是伟大的，他是一个高尚的人，纯粹的人，脱离了低级趣味的人。找到了能够为之奋斗一生的事业，并在历史的篇章中留下了属于自己的篇章。</p>
<p>  我虽然还在自己家的一亩三分地上挣扎，但是偶尔还是会仰望星空，怎么说呢保持激情，不要锤头丧气就是很好的生活状态。</p>

                    
                        


                    
                    
                        <p>
                            <a
                                href="/2021/05/22/%E7%BC%85%E6%80%80%E8%A2%81%E8%80%81/#post-footer"
                                class="postShorten-excerpt_link link"
                                aria-label=""
                            >
                                Comment and share
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title">
                    
                        <a
                            class="link-unstyled"
                            href="/2021/05/16/2-Netty%E4%B8%AD%E6%98%AF%E5%A6%82%E4%BD%95%E4%BC%98%E5%8C%96%E5%86%85%E5%AD%98%E7%9A%84/"
                            aria-label=": 2.Netty中是如何优化内存的"
                        >
                            2.Netty中是如何优化内存的
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time datetime="2021-05-16T22:11:11+00:00">
	
		    May 16, 2021
    	
    </time>
    
        <span>in </span>
        
    <a class="category-link" href="/categories/Netty/">Netty</a>


    
</div>

            </div>
            
                <div class="postShorten-content">
                    <p>Netty减少内存使用技巧：</p>
<ol>
<li><p>能使用基本类型就不使用包装类型</p>
</li>
<li><p>减少对象本身大小 -&gt; 应该定义成类变量的不要定义为实例变量</p>
</li>
<li><p>Zero-copy</p>
</li>
<li><p>Netty内存池使用</p>
<ul>
<li><p>内存池/非内存池的默认选择及切换方式</p>
<p>io.netty.channel.defaultChannelConfig#allocator</p>
</li>
<li><p>内存池实现 io.netty.buffer.pooledDirectByteBuf</p>
</li>
<li><p>对外内存/堆内内存的默认选择及切换方式</p>
</li>
<li><p>对外内存的分配本质</p>
</li>
</ul>
</li>
</ol>

                    
                        


                    
                    
                        <p>
                            <a
                                href="/2021/05/16/2-Netty%E4%B8%AD%E6%98%AF%E5%A6%82%E4%BD%95%E4%BC%98%E5%8C%96%E5%86%85%E5%AD%98%E7%9A%84/#post-footer"
                                class="postShorten-excerpt_link link"
                                aria-label=""
                            >
                                Comment and share
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    <div class="pagination-bar">
    <ul class="pagination">
        
          <li class="pagination-prev">
            <a
                class="btn btn--default btn--small"
                href="/page/2/"
                aria-label="NEWER POSTS"
            >
              <i class="fa fa-angle-left text-base icon-mr"></i>
              <span>NEWER POSTS</span>
            </a>
          </li>
        
        
          <li class="pagination-next">
            <a
                class="btn btn--default btn--small"
                href="/page/4/"
                aria-label="OLDER POSTS"
            >
              <span>OLDER POSTS</span>
              <i class="fa fa-angle-right text-base icon-ml"></i>
            </a>
          </li>
        
        <li class="pagination-number">page 3 of 5</li>
    </ul>
</div>

</section>


                <footer id="footer" class="main-content-wrap">
    <span class="copyrights">
        Copyrights &copy; 2025 Topsion. All Rights Reserved.
    </span>
</footer>

            </div>
            
        </div>
        


    
        
    

<div id="about">
    <div id="about-card">
        <div id="about-btn-close">
            <i class="fa fa-times"></i>
        </div>
        
            <img id="about-card-picture" src="/assets/images/avatar.jpg" alt="Author&#39;s picture"/>
        
            <h4 id="about-card-name">Topsion</h4>
        
            <div id="about-card-bio"><p>Fullstack Developer</p>
</div>
        
        
            <div id="about-card-job">
                <i class="fa fa-briefcase"></i>
                <br/>
                <p>Coder</p>

            </div>
        
        
            <div id="about-card-location">
                <i class="fa fa-map-marker-alt"></i>
                <br/>
                Xi&#39;an China
            </div>
        
    </div>
</div>

        
        
<div id="cover" style="background-image:url('/assets/images/cover.jpg');"></div>
        <!--SCRIPTS-->

<script src="/assets/js/script-q2wtdh1f7oaxzdmuuvsc1uyl8fnwcg5dz7kgztdayssvj6qd6o7u5zwralwk.min.js"></script>

<!--SCRIPTS END-->





    </body>
</html>
